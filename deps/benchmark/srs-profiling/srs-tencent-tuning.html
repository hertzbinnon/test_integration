<!DOCTYPE html>
<!-- saved from url=(0051)https://cloud.tencent.com/developer/article/1958592 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云</title><meta name="keywords" content=""><meta name="description" content="性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战..."><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"><meta name="format-detection" content="telephone=no"><link rel="canonical" href="https://cloud.tencent.com/developer/article/1958592"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/global-201911291451.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/AskDialog-202204021635.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/base-202207011151.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/Column-202205071102.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/Packs-202206241506.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/markdown-201810241044.css"><link rel="stylesheet" href="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/draft-master-v1.4.50.d4s2ddo9sb.css"><script async="" src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/gtm.js.下载"></script><script async="" src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/analytics.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/sentry.0fafaa00.js.下载" integrity="sha384-3iFRt4utFh4KiHasPNezd3tScPXZADqNmL7+0hD3vv8a1AfDdaWSN88AtAtGOoeM" crossorigin="anonymous"></script><style media="screen">@supports (padding:max(0px)){.set-safe-area .com-main{bottom:calc(max(12px,constant(safe-area-inset-bottom)) + 50px);bottom:calc(max(12px,env(safe-area-inset-bottom)) + 50px)}.set-safe-area .com-main-simple-sec,.set-safe-area .com-main.without-tab-ft,.set-safe-area .com-main.without-ft{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-m-footer,.set-safe-area .sa-fixed-btns{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-mobile-body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}@supports (padding:max(0px)){.set-safe-area .support-wrap,.set-safe-area div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-responsive-no-ft div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}.doc-con .J-docShareModal{display: none;} .doc-con .J-docShareCopyTipModalMB{display: none}</style><style id="menu">.pg-2-article .com-nav-bar::-webkit-scrollbar {
              display: none; /* Chrome Safari */
            }
            .pg-2-article .com-nav-bar {
              scrollbar-width: none; /* firefox */
              -ms-overflow-style: none; /* IE 10+ */
              overflow-y: auto;
            }</style><style id="dynamic-inserted-css-ask-pop-menu">
	.ask-pop-menu .com-correction-bubble {
		box-shadow: none;
		border: none;
		position: inherit;
    padding: 0;
	}
	.ask-pop-menu .com-correction-bubble::before {
		border:none;
	}
	</style><style id="dynamic-inserted-css-avatar-upload-loading">
.com-user-avatar .uploading {
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	position: absolute;
	opacity: 0;
	background-size: cover;
	background-position: center;
	border-radius: 100%;
	transition: opacity 2s ease;
}
.com-user-avatar .uploading.spin {
	top: -2px;
	left: -2px;
	border: 2px solid #056ce5;
	border-left-color: transparent;
	animation: upload-rotate 4s linear infinite;
}
.com-user-avatar .uploading.active {
	transition: opacity 0.6s ease;
	opacity: 1;
}
.com-user-avatar .uploading.active.holder {
	opacity: 0.6;
}
@keyframes upload-rotate {
	from { transform: rotateZ(0) }
	to { transform: rotateZ(360deg) }
}
</style><style id="dynamic-inserted-css-transition-slide391298858">
.transition-slide391298858-enter {
	opacity: 0 !important;
	transform: translate3d(0px, -44px, 0);
}
.transition-slide391298858-enter-active {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
.transition-slide391298858-leave {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
}
.transition-slide391298858-leave-active {
	opacity: 0 !important;
	transform: translate3d(0px, -44px, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
</style><style id="dynamic-inserted-css-transition-fade-312660078">
.transition-fade-312660078-enter {
	opacity: 0 !important;
}
.transition-fade-312660078-enter-active {
	opacity: 0.7 !important;
	transition: opacity 300ms ease;
}
.transition-fade-312660078-leave {
	opacity: 0.7 !important;
}
.transition-fade-312660078-leave-active {
	opacity: 0 !important;
	transition: opacity 300.0001ms ease;
}
</style><style id="dynamic-inserted-css-transition-slide-1496561436">
.transition-slide-1496561436-enter {
	opacity: 0 !important;
	transform: translate3d(0px, -30px, 0);
}
.transition-slide-1496561436-enter-active {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
.transition-slide-1496561436-leave {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
}
.transition-slide-1496561436-leave-active {
	opacity: 0 !important;
	transform: translate3d(0px, -30px, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
</style><style id="dynamic-inserted-css-article-sharing!.extra-cnt">.extra-cnt .com-share-options .qr-img img {
					width: 130px;
					height: 130px;
				}</style><script type="text/javascript" async="" src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/MathJax.js.下载"></script><style id="dynamic-inserted-css-transition-slide-1218967474">
.transition-slide-1218967474-enter {
	opacity: 0 !important;
	transform: translate3d(20px, 0px, 0);
}
.transition-slide-1218967474-enter-active {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
.transition-slide-1218967474-leave {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
}
.transition-slide-1218967474-leave-active {
	opacity: 0 !important;
	transform: translate3d(20px, 0px, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style></head><body class="bg-color"><div id="MathJax_Message" style="display: none;"></div><div id="react-root"><div class=""><div class="J-header c-nav-wrap c-nav com-2-nav fixed"><div class="c-nav-mod c-nav-mod-pc c-nav-white"><div id="qcTopNavFstLevel" class="J-headerTop c-nav-top" data-nosearch="1" data-nolang="1"><a href="https://cloud.tencent.com/" class="c-nav-bg-logo" hotrep="community.header.cloud_portal"><i>腾讯云</i></a><div class="c-nav-top-operation"><div class="c-nav-top-ctrl"><div class="c-nav-top-links"><a href="https://cloud.tencent.com/product/ba" class="link-item" hotrep="community.header.ba">备案</a><a href="https://console.cloud.tencent.com/" class="link-item" role="button" hotrep="community.header.console">控制台</a></div></div></div></div><div class="J-headerBottom c-nav-bottom responsive" style="width: 1690.67px; left: 0px;"><a href="https://cloud.tencent.com/developer" class="c-nav-project-logo" hotrep="community.header.logo.community"><i class="c-nav-project-bg-logo">腾讯云开发者社区</i></a><div class="c-nav-bm-categories"><ul class="c-nav-list"><li class="presentation curr"><a href="https://cloud.tencent.com/developer/column" role="button" hotrep="community.header.nav.column">专栏</a></li><li class="presentation"><a href="https://cloud.tencent.com/developer/ask" role="button" hotrep="community.header.nav.ask">问答</a></li><li class="presentation"><a href="https://cloud.tencent.com/developer/salon" role="button" hotrep="community.header.nav.salon">沙龙</a></li><li class="presentation"><a href="https://cloud.tencent.com/developer/teams" role="button" hotrep="community.header.nav.teams">团队主页</a></li><li class="presentation split-item"></li><li class="presentation"><a href="https://cloud.tencent.com/tvp" target="_blank" role="button" hotrep="community.header.nav.tvp">TVP</a></li></ul></div><div class="c-nav-bm-advertising-wrap J-headerAdvertising"><a href="javascript:;" class="c-nav-advertising"><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/28c8kjds5a.png"><div class="c-nav-advertising-text">【玩转 Cloud Studio】有奖调研征文，千元豪礼等你拿！</div></a></div><div class="J-headerBottomRight c-nav-bm-right"><div class="c-nav-bm-search-wrap"><a href="javascript:;" class="c-nav-bm-search-btn" id="c-nav-bm-search-btn-header" role="button" hotrep="community.header.opensearch.search_icon"><i class="nav-search-icon"></i> 搜索</a><div class="c-nav-bm-search search-icon-rt" role="button" hotrep="community.header.opensearch.search_bar"><input type="text" placeholder="找文章 / 找答案 / 找技术大牛" readonly="" style="cursor:pointer"><i class="nav-search-icon"></i></div><div class="com-3-nav-search-wrap"><div class="com-search-bar"><label class="com-search"><input type="text" class="search-input" value="" placeholder="找文章 / 找答案 / 找技术大牛" autocomplete="off"><button type="submit" class="search-btn" hotrep="community.header.search.search_btn">搜索</button><button type="button" class="close-btn" hotrep="community.header.search.close_btn">关闭</button></label></div></div></div><div class="c-nav-bm-btns"><div class="c-nav-dropdown-btn nav-dropdown-creation"><a href="javascript:;" class="c-nav-bm-btn c-btn" hotrep="community.header.bm_btns.write_article">创作</a><div class="c-bubble c-bubble-top nav-creation-bubble-l nav-creation-bubble"><div class="c-bubble-inner"><div class="nav-dropdown-mini"><div class="dropdown-mini-inner dropdown-mini-data"><div class="dropdown-mini-list"><ul class="nav-drop-action"><li class="dropdown-mini-item"><a href="javascript:;" hotrep="community.header.msg_dropdown.drop_action.write_paper">写文章</a></li><li class="dropdown-mini-item"><a href="javascript:;" hotrep="community.header.msg_dropdown.drop_action.send_video">发视频</a></li></ul></div></div></div></div></div></div><a href="javascript:;" class="c-btn c-nav-bm-btn-hole" hotrep="community.header.bm_btns.ask">提问</a></div><div class="c-nav-bm-text-btns"><a href="javascript:;" class="c-nav-bm-text-btn" hotrep="community.header.login">登录</a><i class="c-nav-divider-dot"></i><a href="https://cloud.tencent.com/register" target="_blank" class="c-nav-bm-text-btn" hotrep="community.header.register">注册</a></div></div><div class="c-nav-pro-mask" style="display:none"></div></div></div></div><div class="com-header subsite"><div class="header-main"><a href="javascript:;" class="header-menu-trigger" hotrep="community.header.menu_trigger">展开</a><h1 class="header-main-title"></h1></div><div class="header-logo-wrap"><div class="header-logo"><i class="logo-icon logo-community"></i><h1 class="header-title">腾讯云·社区</h1></div></div><nav class="header-extra"><a href="https://cloud.tencent.com/developer/search" class="header-extra-icon search-entry" hotrep="community.header.search_btn"></a><a href="javascript:;" hotrep="community.header.login">登录</a></nav></div><div class="com-m-side-mask hidden"></div><section class="com-m-side com-2-m-side hidden"><header class="com-m-side-hd"><div class="header-logo-wrap"><a href="https://cloud.tencent.com/developer" class="header-logo" hotrep="community.header.drawer.home"><i class="logo-icon logo-community"></i><h1 class="header-title">腾讯云开发者社区</h1></a></div><div class="com-m-side-hd-extra"><a href="javascript:;" class="com-m-side-link only-icon"><div class="icon-back"></div></a></div></header><div class="com-m-side-bd"><ul class="com-m-side-nav"><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/developer" class="com-m-side-nav-link"><i class="icon-home"></i>首页</a></li><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/developer/column" class="com-m-side-nav-link"><i class="icon-column"></i>专栏</a></li><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/developer/ask" class="com-m-side-nav-link"><i class="icon-ask"></i>问答</a></li><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/developer/salon" class="com-m-side-nav-link"><i class="icon-salon"></i>沙龙</a></li><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/developer/teams" class="com-m-side-nav-link"><i class="icon-nonstop"></i>团队主页</a></li><li class="com-m-side-nav-item split"></li><li class="com-m-side-nav-item"><a href="https://cloud.tencent.com/tvp" class="com-m-side-nav-link"><i class="icon-tvp"></i>TVP</a></li></ul><div class="com-m-side-idx-link-wrap"><a href="https://cloud.tencent.com/" class="com-m-side-idx-link">返回腾讯云官网</a></div></div></section><div class="com-sticky-header col-2-sticky-header hidden" style=""><div class="com-inner"><div class="com-sticky-header-main"><div class="com-media author-media"><div class="com-media-object"><a href="https://cloud.tencent.com/developer/user/8722662" class="author-media-avatar" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/80)"></a></div><div class="com-media-body"><h3 class="author-media-name" title="Winlin"><a href="https://cloud.tencent.com/developer/user/8722662" class="author-media-name-inner">Winlin</a><div class="c-bubble-trigger com-verification"><i class="verified"></i><div class="c-bubble c-bubble-top"><div class="c-bubble-inner" style="padding:8px 10px"><p>腾讯云 · 工程师 (已认证)</p></div></div></div></h3><a href="https://cloud.tencent.com/developer/column/94785" class="com-arrow-link author-media-link gray">99<!-- --> 篇文章</a></div></div><span class="header-split"></span><h3 class="header-title" title="性能优化：SRS为何能做到同类的三倍">性能优化：SRS为何能做到同类的三倍</h3></div><div class="com-sticky-header-extra"><button type="button" class="l c-btn"><span class="text">转到我的清单</span></button></div></div></div><div class="J-body col-body pg-2-article" style="min-height: 112px;"><div class="com-crumb theme2 no-pd"><div class="com-inner"><a href="https://cloud.tencent.com/developer/column" class="crumb-item" hotrep="community.column.article2.crumb.0">专栏首页</a><span class="crumb-split"></span><a href="https://cloud.tencent.com/developer/column/94785" class="crumb-item" hotrep="community.column.article2.crumb.2" title="SRS开源服务器">SRS开源服务器</a><span class="crumb-split"></span><span class="crumb-item current" title="性能优化：SRS为何能做到同类的三倍">性能优化：SRS为何能做到同类的三倍</span></div></div><div class="com-3-layout"><div class="layout-main"><div class="com-widget-operations2 theme2 J-sharingBar" style="top: 150px;"><div class="main-cnt"><a href="javascript:;" class="com-opt-link link-add is-actived"><i class="com-i-add"></i></a><a href="javascript:;" class="com-opt-link link-like"><i class="com-i-like"></i><span class="text">1</span></a><a href="javascript:;" class="com-opt-link link-bookmark"><i class="com-i-bookmark"></i><span class="text">0</span></a><div><a href="javascript:;" class="com-opt-link link-share"><i class="com-i-share"></i></a><div class="extra-cnt" style="visibility: hidden;"><span class="com-opt-text share-text">分享</span><ul class="com-share-options"><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon wechat"></i></a><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img" title="https://cloud.tencent.com/developer/article/1958592#undefined"><canvas width="130" height="130" style="display: none;"></canvas><img alt="Scan me!" style="display: block;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAAAXNSR0IArs4c6QAACqVJREFUeF7tndF6nDoMhJP3f+icbxfcACt5/rFNcrpVL4ux5dFoJBmWfH58fHx9LPz39dWf7vPzM1zteB8Zo0w+zpHZlI1R67v3KVsf1yMb71gns+XhlSLCxRH/NBFUJPdYraJPXScR8xijHHScx10zmzuyLVMvV9VUxLtKRnFs447r/1GEIkKcsooIBr1U9KnrdKlShA2pO/AMFYHIJJHHyMFKDrPC6TqXsnFG4dKCai90iWRncxC72t7IOiQdHW3JxhcRqBwdIpE4qIhgtI+jqtIrHJsDSOQZHDhJchHhgJzjRCe391LA6jXdXBtJNtkbGZN1PBGxSXoliiS7BpV/r3lcAeoCQdrAFWuqOTJSkrzsjikiCH0m7FencqRYIqmkFCFwFpFpoiwqT5N1VHei1uhdj9YftcntfFwCE7x/pWsghiknjYK+Yu0sBY7aVERQ3u5cHwW9iBCDaimC6ze36FLzk+IyGkPaOqcWIIqQ7WW0tlHYPK6vwlt2DcQYUtm787TxRYQ+ckWEw2FVKcJGFqJwRLVufR9BtVsk/zsS64ztSayaZ7XdmS3KjlHFDbusO19MKSK8Ri1xbiMaGbuKDKUIO5JOlDtjs4KT/P+PEuFrJskIOqoWjlT52aFKKG+H9yGJs0jujMYQu8n6Ch9n77PK8FlEeIVQOaiIYNJuBaBOVBApJQK4wu63UATSx2fnCEpKibMI35wHTWS+bAx5irhiz3euQ/YfpoYiwjd0dzpoRVAQ5bGIQIwiizoHPchA8IMYVTiS9EJO61TKIPshGLZ5SEC6dqfPGlqxWET4fp2dFIPE6aMpo4gQIEeiohRhQ4AQWCqCU/z1okHlVCKNxPlKppUdPeCc8wUCvluIks4mUo0ZW6xikcihckARQReiRYQdo1IE/rtkt1hM1a49dFKRPJMOiDQ6cnyVdZUmSNeQpUYHF2fsdb9KBYjD3T2c7C0ivFKQdFBOR+CmVFX8KtI87id7KCIIzxAQ/2kizEgfiYo2ZrT6Hb3PsY22aSQdqpRGIp+kVFSgO6mhiLDBPkM4B8MiQvJD2tEIUveVInx8yC+mkHypWL6K2Vn1r55vuERQ9s5gQmRaFYukCyIt+KnLiFLDVBsSPCRSwPYikmyoiNDvfBBxigivICrivqUiRE8fHQnuHYw4karAd/M4URJX+UZbRpU6rwWogxuJdoLdn2cNBDiSa9WmR3Mk2UzmWAIWifIiwo5AEaGfRmaCaTSACMlJEIWKMCPTiiykB58Z0zat7OidByjgXIcrJ2epgdynbKXXiwgUqcO4IgIATUXiTLQ7T+CUHaUIZ2dKRRgtoo5Au04ha0ay6aY0sk6Ug4kirCpc2zyrAijtCFe8vJoJRTO+iKD/NIEiThEh+SZCKcJGHZIuiYJZ5wigRJBDiByPSrxbZbvj1eaI3UQdVTpQdlwJgsY7J4tkQjWmiDD25wAUrtfrDuGexIl+De1O4tQI5GSRrK9SAyFcWjglP69v42fmVrWAwpKmA5s4RYQNMkLQIoJLr3181DUQwEsRXgEnuA26aSs6nQ9luBWq0z66m4gKsxnJRpW1+MMdmey7RaTa22hK69URRYQdnSICoWsAlnPAQaS+FKH/a2yHqNeaJ8P2OKdUhBVOJFwjG3XIssJuCmhkl5tGI7lftYcslZxSmaoRVhhTRIh/y6jIvwL7K0lTJS8i9HWGkPitFMGVMgJQm5O0PndU/JGDHLt75wttbrI3kqPVcbdrd7Zmto58DL2iJSJgFRG+00eUEooI4GNaTi51AXUilagqCaxfJQKpyEnUqmcAGRCoshWkGLWPpICsg1AF3/PUDnwaWOHvqio5dLK6BpfBRYQNsRnHqdrGJZZStSdZVddQRPhGYPXR72hK+zEikIWcXOtGBxlPUoyKrNFqnkSYW7Urkjl407MDmRqKCPFxr2qHVZ6nKaPNM1N8kpqriCA8pgLhrRWBsM/JaaRqdR5ckeqbzEeilsh6FLXOfdf9RHiN4n1VHpJGhw+UHEBncj65N5JssnlnDxm4xFkuQdt4Mvcq8hURDDaogm6VU36FCNFfeXOikMjQzHwqXxPwV6e90Qgn6YB0Mu6eSeEY/pW3GcdFkjwzXxFhQ5SkCVLEpiQuReBAN5K/pSKo19ndgwzCSiMtn4YqB7i2jkqssqOXLsneVfHrFsJIkYsIr65RZH5rIri5mERfxH7ytM6JmqwQcnMqiTJVzROCOPaS+cgYsqZsH1c5rhmzaj71zL6IoH+Kf8SoiBDIjyKrun6dkoxXxM4Ua5kiOB/cJBIT5VeSRkhqcjetUgyx68522LGPKJya71rEnhShiEDgO7eYqAq/8a0kbjEvhK2PcpcibHn3LYmw4g0lVXGrduz/3Her1EByN0l7Kspn0iK5d8mrakWEc+oYUY0iwo6AW7g5kaqIenWCiiB1/a8kgioWZ0Bc8WoXqUvaGJK7VeSR6+7TTJIas30qe2bSzsmuIoKC+vV6ESH5gYmKWjciMteoeUoR+j+b66XAsH0kjCdx9FNP0ZQtbv2h9u/KsVtTqP2QTsWZ4zG2iBAgVkTYQVFAULaVImxI/RWKoN5HINWsOgcnQJB1VAfj1gjKbkp41bWQvUXBtzoguzVCEcF1dz5eFbOuOhQRkr8EW4owRlr0GHzF32tQVTmpslekD7Rh8Z3lK9TqPQE3ah0b3VSnAuWqSMMvpowaVkT4dlERYcfCJRMBrsFMxq6IYHcPo5H6U+s8zxFWPIYerb5JcZVlxSiVECcTdRrLxHmbSA6AlO0uyd1OpYgQnJ0UEQQCq6OpFCF+NqDULot2ohqZOsm/6eRI8zPXBFW5mzpWdBAkLxNAVztlVG3IfVM1hfqbTkWE1+8ok8hzyU8crcZMEUG9j3Dnpknkk/ThRK0C83qdrN/ucfejbFlFJrKH5W8xq8251SzZRBGhjzrBsIggmEtAfAtFcM4RnGg/Fo7qCDorMnvrrei7s/lVOlRrU5ycLuwODE8FdRHh1W1FBEplOK4BegebVVQqZ1K1iWoatTaEx/pY9x0YnhQh+nQO3Ug0bkVOJWcAqkAkrRSRZrUOKX5/ez/En+HHtMiN2ZgiQh89R6lcos4oVRFh9xtRkOZix5lXWjj3/goRSA4iVbaSUgL46EEKUSOyT+UAcnCUpQwStdH+XbuJqp/wUieLZEK1OQXsYw3iRGULmcMFNJqziJB4ooiwAUNkX2GVzeMSWAXNS/BFikCkmUg8MSYa81MKMmof6RQIhmoed46Z/chfOrndAWGuMriI0FcYhd/I9SLCCGqHe9x6gQSW6k4mTQ5vv5UIjrSRQs8B8TiWKAwBd3VHpNIrqTkyu91apIhAGLCPKSIEYCk296roCPtShNc/KPZ2ikBIQ6TcGeOmA6fIdVLetU0jUm6IFPqltepOnkF7Z/sYPX10cxcpxkYlmwAUOaWIkFTLKvpKEV5fgL0SzCVXu58ECiG8fFWNyBSJcqclIvWCc/SbpZTVXYiTuq411ApVIw7PbCwiiEJYpQYSkaNjlNL2gpTUPMf5iwhFhCcCt76PEKUDIvujkr1KmlUkkmhzU6oj68q+EaUoIuyokYI26oKIw92WURGtiAA+qaNUiKiGAlo5ipJj9MBI2TeiCP8BQ+EBW/kZfBoAAAAASUVORK5CYII="></div><p class="qr-txt">分享文章到朋友圈</p></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon qq"></i></a><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><span>分享文章到 QQ</span></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon weibo"></i></a><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><span>分享文章到微博</span></div></div></div></li><li><div class="c-bubble-trigger"><a class="opt-item" href="javascript:;"><i class="opt-icon copy"></i></a><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><span>复制文章链接到剪贴板</span></div></div></div></li></ul><div class="c-bubble-trigger com-widget-poster"><button class="scan-btn">海报分享</button><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img" title="https://cloud.tencent.com/developer/article-sharing/1958592"><canvas width="130" height="130" style="display: none;"></canvas><img alt="Scan me!" style="display: block;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAAAXNSR0IArs4c6QAAClxJREFUeF7tndF6ozoMhNP3f+ieLwlsgEjMP7aSnqbay8XI8mg0kg2hX5fL5ftS+O/7+2Hu6+vrZjn6v+P/Zy6sNuj41c72vq3tzBcHghkb23vVnNnas7Upe2fXr5FqIpgIfjQRHKYecVPMJcAR1SBZrhSBxFz5QlSKZG2GeaSkW7/J/GSdWzv/FKGJ8ICuiUBoFIxpRXgG5SMUwV2EI1WKNEdIVXbONJmk1ERjZtST5NpoaZiJW1gaZgwqkJoImgpNhACjVoTzskMacbJ9fqkiEGVZnXQDrmwrZbrO66qTymWyhopyNON35mMTYYmum1kRKZoIywni2SliRTZle2kVFLehVGqT2WsiFBBBEYXuJlSpcedRJHNJM6o8MyT7VT2CGyAFqLruzkfAJDZH/WoiJOgqQNV1EjS3BBCbo379CBHIgrJ67SyUdPZkHuWvc+B1tptY5yH2yBjlt9vbuPbe/qyBZBZZxCi47n1qvLpOyETW20RIECABiG5171Pj1fVfTYQZhqpGyq1vo+PJQcuo7W1wK2xc7Sk7ZD1VcfvfvJhCFl0BnLJxls3RM4AKv7M5ie0mQnB2QYBrIsTU+fp2W/cqCr7grF+VqKMck2YssxntINRY2jv8yKPvJsIzHciDoSZCK8IOAYc0v1oRqrdKpI6PSrxre5TTpJoSgih/Z+YhGG7HyB6hifBMl5kAOc3qzDzDRCABdzMo2m7tWJg8tczGkGbM9TGq9VkAqps4B3Nn7BGDTJ1CRZiZSHXfBFgypolwR4AoBUmmJkLAXJIIf04RSH1xnjK69kj5UHJH/HNVaPXLtf1KkqmG80xBtvf+axYrulxSn0mz1ETgJaCJsGk0IwK6WevUVNf2r1CE6NfQrmSqLFcyfgwkaYYicEcBP1OyyBeShZlNgq2a01VeQvLw6SNx1qn7TYQHWgTbJsKCVyvC8ycrqpIps2P9LN6VxDWgM4sgc6p5CLGcBlWVQnqgo9RBXScl4rhraCJQ1MDj8SaC+UMWlamkoWpFeEapSmHlyaLTCJ7JoCKCK9mk+40OfYgYODuOVyiCmp8kBFln5nvJgZKqr+SwiiyiifB80FSlDk2EhV0qI6/D1jF/XhGcjCT1n9hzykeV8lTIMDl9zEpwhB3J/Jk5LUUggVMS726Jmgh3RJsImy+5KpK1Ijx/9fYMs52COM8aVCDoQUpkp6LuEhuu7I8e987I9IqP66tTao4qYz1raCK8R6abCAMdfJYFJJtI1v4ZRVA/cCF1l2y9lJr8hA13bWoNZKc0us4ZYpOG23qd3c0+B7hRgLKdDFp88nILUQpnbaR3UfaaCAqhzXWXTK0ID/AsRXCzLHrWQM4RSAZFQST+uWchkS/uPAaXd2cGBCvXdqrqTo9AAIiykmTqjPStiyP+NREeCOxIrohAajA59VLMJXVZZQixQfbahLjRFq+qWXTUjpS3zK/tvbI0NBHO/9IRSQJS6pRSqSQ4BpuoYxNhQY2AqwD9aCKQxbkSq0oDsafUyZH0oz+OxJKxpOdx1kzsKdKexSAsDU2EuKFSfQEpAYREUcCaCAmNR3cnpHFSmUqCSQKn5lEKeL0+o4I7+87TR1cpnG2dC64qNe4OQtm7XlfSS4JP+hLiixpD5tlh1ERQkJ6XiaqsHU0ysmVFPjYRmgi3ErMSwZVSJZPH+hXBTeQrq6NObXTGEr9JbSelTlFwxm8X2yZCEA1Hpl3ASQJFuxNyHyFOtrYmQhPhhsDwR7mdPfMMm4nErmNIeXP8fvVOQTVx7i5kZnwTYYkGIUhU013ws77AORdx5yTjmwhNhHtpqHgMTVi+jiHyrbrpo2RXNHdKpolPThk72ovKJ2n+Mr/JzmZ3bxPhOcRuAKIun2x7VbBcPwgR06RtIjQRdqWBsMmR4Ix5o03Z0V7ki7unJ3IfjSHljfiidlMzeCvbT3iuitBE4LRoIoiPXBIoWxGuG7X7P5W1b1WEiodORAbp4m/1CnyrSWWlApmUGtLZk90GWU9F40iIk+Fm/QiWlA+1nSEBIsA1Ec6bXLdHayIsiLnZFAFdQeCsZJCtpLuG7fiSdxbdPXNUJtxFqH6EBIVkTaRwRNWUf2elyTlcIiqNSBSdI5CgEBCVHSXvbo126zVZw58jgsss1dxsmz6yUyDzq0ATFXB9UWRV18+Ugfiy3u/iQxQpLA1kIjJGZRAJlkOybU0ltgn4xM5oeSNlVJUGgk8TYUGgKuAq49X1X6MI0TkCYa1bXxVDVT+RddPbEkT8JoEbPRdBTRk4lFPN6AxWWXmV7yMQ4CqkamZx0b2uIpA1jM6TgT+aTDNYNRFEyWgiXC7nv/veIKQk6yjT6/gqyfyJDFK+kwZa2cjWRZpWEhNVlm9xUz0CyZRMbpoId2SaCMvncwkQpO61IswR60wZrCPm0caREEGpykxmkWaNNJcRkK58u1iMzknKwQ4X54i5ifAMbxPB2A+7WeCC67C/urlzfXWxeJsiqBdTCHBEetcxRIJdcFfbpM+o6rJVgLIm21mbM/ZYOkmTv7Uv30doInC9IVg5wXXGNhE2cWpFeLwPaStCdbOoGkoizW4m8JxlfxLHsTe6pT3ep46vSfkl2Gb+lm8fmwh3qN2gNBECirYinJOJ9CKuqoV/5Y109qnEJK+iR529Ug93MVV+j8o96VGIbWXnFetsIiyRUeATuSc2mggB4K0ID1o4WLxUEYgMu7XbyRDyVpBqwEjtJGtQWy/XRoUKkPgQDK1dg1v/K4Ahi2ginNOBYNhEGCxNEbgVxD/2HI56EoUh5w67Mepn8dWTklrojlE7EiKrRAXXMUqZruNImaqYkxCIKIX8I+FNhOdj248kQvQJXiIrr8xaN5vW8cSnGXVQilBdMki2k/WQXUb45dUmwnxTNkPK9d4mAvgLrRFZZ8AnmfXRiuB8Vc0B66xhigCtklXHNmnWInK5hEPSLN74cvsSd7z1wc0mwr1xbCKYTFA1riJTyK4mU5tWhMeOyPqBC+GBOoAZtXG8b/T5/SvJt/WxSjWcUqcS74jhzkfnl06jQZxxkGRtRRPnBk5h4dpT419B4CbCEsXqBvUjFIF0mSQ7R+2QoKisIMpD/FN2yJGtyvAzmV6vVfU2Sr1uOzx1soiMiLeSZmw4BFEBPHb8hNjRmCZCgpzL3MiME/AbgwPyNRH4532fmu+KP/eniEACROqrKg1bG+6c7jbU6eaJX24pUSrrlsCSv/LWRLiHReFwHEPIrwJOCExKYBNBIK0y1VGpP0sEdehD5FsFImsAZ2yTOaPSMJq9JGNnbKMy8coeoYkwE766n+c1EQZlvxVhAa5KVtc4zGwNR5sh0riNdvPuOcLoPGTtJFakKX17s0iaK7I4JXdNhJhGGf5NBKGCEXB/RhHcFkdln1sayPyqEc3k+BVBHD1cUutUuKr7netvedbQRMAft93FrokAqNyKAEAyhrz9DSW3WVRNYXZaN3rf8YBKES5rbMkWlJQpFUuCJymTTYQAaRVEdZ2Q6TiGbDEjUjQRNqiorM2yajSbP5EI/wH+JYxtNaiBtgAAAABJRU5ErkJggg=="></div><p class="qr-txt">海报分享</p></div></div></div></div></div></div></div><section class="com-2-panel col-2-article J-articlePanel"><div class="col-2-article-header"><h1 class="article-title J-articleTitle"><span>性能优化：SRS为何能做到同类的三倍</span></h1><div class="article-infos-wrap"><div class="article-infos"><span class="article-info">发布于2022-03-18 17:13:15</span><span class="article-info">阅读 <!-- -->207</span>0</div><div class="article-infos-extra"></div></div></div><div class="com-markdown-collpase"><div class="com-markdown-collpase-main" style="max-height: 1e+07px;"><div><div class="rno-markdown J-articleContent rno-"><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/64de5c86c154afa7dda1880494189bc4.png" class="" style="cursor: zoom-in;"></span></div></figure><p>性能无疑是<a data-text-link="375_1958592" data-from="10680" href="https://cloud.tencent.com/product/cvm?from=10680" target="_blank">服务器</a>的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战的难点。</p><p>为何性能很重要？完备的功能需要用性能交换，安全性需要用性能交换，成本需要用性能交换，产品体验需要用性能交换，甚至系统弹性都需要性能交换。有了基础性能，就有了竞争力的资本；基础性能若有问题，举步维艰，想要干点啥都不容易，就像天生羸弱的身子板。</p><p>SRS虽然是单进程单线程模型，性能一直都很高，比如：</p><p>•单进程能跑满千兆或万兆网卡，一般的场景完全能覆盖。•性能是NginxRTMP或Janus的三倍左右，目前还没有更高性能的开源同类产品。•提供集群能力，水平扩展性能，在开源项目中也不多见。</p><p>这并不是终点，这个性能基准只够5年左右，随着业务发展一定会有更高性能的需求。目前服务器属于第二代高并发架构，也就是单线程架构：</p><p>•第一代高并发架构，1990～2010年，多线程架构，一般比较老的服务器都是这种架构，一般无法解决C10K[1]问题，比如Adobe AMS[2]，Apache HTTP Server[3]，Janus WebRTC Server[4]。核心问题是多线程的水平扩展性问题，并发越多，线程之间的同步和竞争开销就越大（这个问题也是现代语言Go在性能方面的硬伤，特别是在超多CPU比如64核或128核时，多线程的损耗会更大）。•第二代高并发架构，2010～2020年，单线程架构，多进程或单进程单线程都是这种架构，C10K问题得到比较好的解决，比如Nginx[5]，SRS[6]，MediaSoup[7]。核心问题是单线程引入的异步回调问题[8]，新的语言比如Go引入轻量线程goroutine（协程）解决这个问题，老的语言比如C++20、JS await等都有对应的机制。另外多进程的进程间通信也会引入额外复杂性，比如<a data-text-link="850_1958592" data-from="10680" href="https://cloud.tencent.com/product/css?from=10680" target="_blank">直播</a>和RTC的流的跨进程回源和拉流问题。•第三代高并发架构，隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[9]，还有比Nginx更高性能的反向代理么，这就是Envoy[10]了，如下图所示。其实Envoy和Nginx都是事件驱动，但是Envoy是完全非阻塞[11]。而Envoy的多线程实际上和第一代的多线程也不同，线程之间几乎没有交互，可以看作是隔离的进程。由于是线程，所以它们之间的（少量）通信也很容易。同样，多线程也可以和轻量线程结合使用。</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/bc60db00c82d9b63b2cb3a4b96222eb9.jpeg" class="" style="cursor: zoom-in;"></span></div></figure><p>SRS目前还属于第二代架构，第三代架构验证过是可行的(#2188[12])，由于目前SRS性能还不是短板，所以没有合并到主干分支，有需要可以自己合并feature/threads[13]。目前SRS的性能数据如下：</p><div class="table-wrapper"><table><thead><tr><th style="text-align:left"><div><div class="table-header"><p>SFU</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Clients</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>CPU</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Memory</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>线程</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>VM</p></div></div></th></tr></thead><tbody><tr><td style="text-align:left"><div><div class="table-cell"><p>SRS</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>4000 players</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~94% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>419MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 8CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>NginxRTMP</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>2400 players</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~92% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>173MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 8CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>SRS</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>2300 publishers</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~89% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1.1GB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 8CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>NginxRTMP</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1300 publishers</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~84% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>198MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 8CPU</p></div></div></td></tr></tbody></table></div><div class="table-wrapper"><table><thead><tr><th style="text-align:left"><div><div class="table-header"><p>SFU</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Clients</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>CPU</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Memory</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>线程</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>VM</p></div></div></th></tr></thead><tbody><tr><td style="text-align:left"><div><div class="table-cell"><p>SRS</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1000 players</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~90% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>180MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 2CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>Janus</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>700 players</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~93% x2</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>430MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>24</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 2CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>SRS</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>950 publishers</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~92% x1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>132MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 2CPU</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>Janus</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>350 publishers</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>~93% x2</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>405MB</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>23</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>G5 2CPU</p></div></div></td></tr></tbody></table></div><blockquote><p>Note: CentOS7, 600Kbps,&nbsp;ECS/G5-2.5GHZ(SkyLake)[14],&nbsp;SRS/v4.0.105[15],&nbsp;NginxRTMP/v1.2.1[16]。虽然系统有8CPU但只能使用单个CPU，选择8CPU是因为只有8CPU的内网带宽才能到10Gbps。</p></blockquote><p>当我们提到性能，一般隐含条件是“<strong>满足业务场景的体验</strong>”下的性能优化，比如直播要求卡顿率低、延迟在3秒之内，比如WebRTC要求端到端延迟400ms之内（服务器0延迟），一般现在服务器的内存可以是4GB、8GB、16GB、32GB或64GB，这意味着我们可以尽量用内存Cache来降低CPU运算。</p><div class="table-wrapper"><table><thead><tr><th style="text-align:left"><div><div class="table-header"><p>SRS</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Protocol</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>VP6</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>H.264</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>VP6+MP3</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>H.264+MP3</p></div></div></th></tr></thead><tbody><tr><td style="text-align:left"><div><div class="table-cell"><p>2.0.72</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>RTMP</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.1s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.4s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.8s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.6s</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>2.0.70</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>RTMP</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.1s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.4s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1.0s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.9s</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>1.0.10</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>RTMP</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.4s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.4s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>0.9s</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1.2s</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>4.0.87</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>WebRTC</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>x</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>80ms</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>x</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>x</p></div></div></td></tr></tbody></table></div><blockquote><p>Note: 在音视频服务器的性能优化中，延迟是必须要考虑的一个因素，特别是在RTC服务器，性能优化不能以增大延迟为方法。</p></blockquote><h2 id="%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86" name="%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86">性能基准</h2><p>如果没有压测能力，就无法优化性能。</p><p>SRS的基准是<strong>并发流</strong>，比如使用srs-bench[17]推流可以获得支持的最高推流（发布）并发，和最高拉流（播放）并发。压测工具一般读取文件，可以选择典型的业务场景，录制成样本文件，这样压测可以尽量模拟线上场景。</p><p>性能优化前，必须使用压测获得目前的性能基准，分析目前的性能瓶颈和优化思路，然后修改代码获得新的性能基准，如此反复不断提升性能。如下图所示：</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/f384f7c60b4839f8529094462fb66cb8.jpeg" class="" style="cursor: zoom-in;"></span></div></figure><p>上图就是性能分析的主面板，左三右二加一个浏览器：</p><p>•左上：服务器的top图，命令是&nbsp;<code>top -H -p $(cat objs/srs.pid)</code>&nbsp;，看CPU和内存。还有每个CPU的消耗情况（进入top后按数字1），比如us是用户空间函数，sy是内核函数，si是网卡软中断。•左中：系统的网络带宽图，命令是&nbsp;<code>dstat</code>&nbsp;，看出入口带宽。比如视频平均码率是600kbps，那么900个推流时，网卡的recv流量应该是<code>600*900/8000.0KBps</code>也就是<code>67.5MBps</code>，如果网卡吞吐率达不到预期，那么肯定会出现卡顿等问题，比如可能是系统的网卡队列缓冲区[18]太小导致丢包。•左下：服务器关键日志，命令是&nbsp;<code>tail -f objs/srs.log |grep -e 'RTC: Server' -e Hybrid</code>&nbsp;，查看RTC的连接数和关键日志，以及进程的CPU等信息。如果连接数达不到预期，或者CPU接近100%，也是有问题的。•右上：服务器热点函数列表，命令是&nbsp;<code>perf top -p $(cat objs/srs.pid)</code>&nbsp;，可以看到当前主要的热点函数列表，以及每个函数所占用的百分比。性能优化一般的思路，就是根据这个表，优化掉排名在前面的热点函数。•右下：压测客户端的top图，如果压测服务器的CPU满载，也一样达不到预期，会出现卡顿等情况。同样也需要先检查系统的网卡队列缓冲区[19]，避免系统丢包。•浏览器：在浏览器中播放流，比如webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13[20]，可以通过eip指定外网ip，这样压测工具可以推内网地址，而浏览器观看可以看外网的地址。浏览器观看可以随机抽查某个流，判断是否播放流畅，声音和画面是否正常等。</p><blockquote><p>Note: 我们在左上的图中，截图时加上了标注，可以更快的看出这个性能图的摘要，比如<code>ECS/C5 2CPU</code>说明是ECS的C5机型一共是2个CPU，<code>900 publish streams</code>是RTC推流一共900个并发流。</p></blockquote><h2 id="%E5%B7%A5%E5%85%B7%E9%93%BE" name="%E5%B7%A5%E5%85%B7%E9%93%BE">工具链</h2><p>没有工具链就无法做性能优化，前一章我们分享了压测工具srs-bench[21]，查看网络带宽工具<code>dstat</code>，查看热点函数工具<code>perf</code>，查看CPU工具<code>top</code>。</p><p>还有一些工具链，总结在SRS性能(CPU)、内存优化工具用法[22]，我们挑一些和性能优化相关的工具重点介绍。包括：</p><p>•<code>sysctl</code>：修改内核UDP缓冲区，防止内核丢包。•<code>GPERF: GCP</code>：使用GCP分析热点函数的调用链，图形化展示。•<code>taskset</code>：进程绑核后，避免软中断干扰，便于查看数据。</p><p>对于RTC，很重要的是需要把内核协议栈的缓冲区改大，默认只有200KB，必须改成16MB以上，否则会导致丢包：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">sysctl net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>rmem_max<span class="token operator">=</span><span class="token number">16777216</span>
sysctl net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>rmem_default<span class="token operator">=</span><span class="token number">16777216</span>
sysctl net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wmem_max<span class="token operator">=</span><span class="token number">16777216</span>
sysctl net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wmem_default<span class="token operator">=</span><span class="token number">16777216</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>可以直接修改文件<code>/etc/sysctl.conf</code>，重启也能生效：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># vi <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>conf
net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>rmem_max<span class="token operator">=</span><span class="token number">16777216</span>
net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>rmem_default<span class="token operator">=</span><span class="token number">16777216</span>
net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wmem_max<span class="token operator">=</span><span class="token number">16777216</span>
net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wmem_default<span class="token operator">=</span><span class="token number">16777216</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>如果perf热点函数比较通用，比如是<code>malloc</code>，那我们可能需要分析调用链路，看是哪个执行分支导致<code>malloc</code>热点，由于SRS使用的协程，<code>perf</code>无法正确获取堆栈，我们可以用<code>GPERF: GCP</code>工具：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># Build <span class="token constant">SRS</span> <span class="token keyword">with</span> <span class="token constant">GCP</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>gperf <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>gcp <span class="token operator">&amp;&amp;</span> make

# Start <span class="token constant">SRS</span> <span class="token keyword">with</span> <span class="token constant">GCP</span>
<span class="token punctuation">.</span><span class="token operator">/</span>objs<span class="token operator">/</span>srs <span class="token operator">-</span>c conf<span class="token operator">/</span>console<span class="token punctuation">.</span>conf

# Or <span class="token constant">CTRL</span><span class="token operator">+</span><span class="token constant">C</span> to stop <span class="token constant">GCP</span>
killall <span class="token operator">-</span><span class="token number">2</span> srs

# To analysis cpu profile
<span class="token punctuation">.</span><span class="token operator">/</span>objs<span class="token operator">/</span>pprof <span class="token operator">--</span>text objs<span class="token operator">/</span>srs gperf<span class="token punctuation">.</span>srs<span class="token punctuation">.</span>gcp<span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>图形化展示时，需要安装依赖<code>graphviz</code>：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">yum install <span class="token operator">-</span>y graphviz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>然后就可以生成SVG图，用浏览器打开就可以看了：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span><span class="token operator">/</span>objs<span class="token operator">/</span>pprof <span class="token operator">--</span>svg <span class="token punctuation">.</span><span class="token operator">/</span>objs<span class="token operator">/</span>srs gperf<span class="token punctuation">.</span>srs<span class="token punctuation">.</span>gcp <span class="token operator">&gt;</span>t<span class="token punctuation">.</span>svg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/0f44a5cdb994e379898ed61534af6e5c.jpeg" class="" style="cursor: zoom-in;"></span></div></figure><p>还可以使用<code>taskset</code>绑定进程到某个核，这样避免在不同的核跳动，和软中断跑在一个核后干扰性能，比如一般软中断会在CPU0，我们绑定SRS到CPU1：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">taskset <span class="token operator">-</span>pc <span class="token number">1</span> <span class="token function">$</span><span class="token punctuation">(</span>cat objs<span class="token operator">/</span>srs<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p>Note：如果是多线程模式，可以增加参数<code>-a</code>绑定所有线程到某个核，或者在配置文件中，配置<code>cpu_affinity</code>指定线程的核。</p></blockquote><h2 id="%E5%86%85%E5%AD%98%E4%BA%A4%E6%8D%A2%E6%80%A7%E8%83%BD" name="%E5%86%85%E5%AD%98%E4%BA%A4%E6%8D%A2%E6%80%A7%E8%83%BD">内存交换性能</h2><p>现代服务器的内存都很大，平均每个核有2GB内存，比如：</p><p>•ECS ecs.c5.large[23], 2CPU 4GB 内存，1Gbps内网带宽。•ECS ecs.c5.xlarge[24], 4CPU 8GB 内存，1.5Gbps内网带宽。•ECS ecs.c5.2xlarge[25], 8CPU 16GB 内存，2.5Gbps内网带宽。</p><p>还有其他型号的，比如G5[26]每个核是4GB内存，比如R5[27]更是每个核高达8GB内存。这么多内存，对于无磁盘缓存型的网络服务器，直播转发或者SFU转发，一般内存是用不了这么多的，收包然后转发，几乎不需要缓存很久的数据。</p><p>因此，线上的视频服务器一般内存都是很充足的，有些情况下可以用内存来优化性能的地方，就可以果断的上内存缓存（Cache）策略。</p><p>比如，在直播播放时，SRS有个配置项叫合并写入（发送）：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">vhost __defaultVhost__ <span class="token punctuation">{</span>
    play <span class="token punctuation">{</span>
        # Set the <span class="token constant">MW</span><span class="token punctuation">(</span>merged<span class="token operator">-</span>write<span class="token punctuation">)</span> min messages<span class="token punctuation">.</span>
        # <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">(</span>For Real<span class="token operator">-</span>Time<span class="token punctuation">,</span> min_latency on<span class="token punctuation">)</span>
        # <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">(</span>For WebRTC<span class="token punctuation">,</span> min_latency off<span class="token punctuation">)</span>
        # <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">(</span>For <span class="token constant">RTMP</span><span class="token operator">/</span><span class="token constant">HTTP</span><span class="token operator">-</span><span class="token constant">FLV</span><span class="token punctuation">,</span> min_latency off<span class="token punctuation">)</span><span class="token punctuation">.</span>
        mw_msgs         <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>如果是非低延迟（默认）模式是8，也就是收到了8个音视频包后，才会转发给播放器。关键代码如下：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">srs_error_t SrsRtmpConn<span class="token operator">:</span><span class="token operator">:</span><span class="token function">do_playing</span><span class="token punctuation">(</span><span class="token parameter">SrsLiveSource<span class="token operator">*</span> source<span class="token punctuation">,</span> SrsLiveConsumer<span class="token operator">*</span> consumer<span class="token punctuation">,</span> SrsQueueRecvThread<span class="token operator">*</span> rtrd</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    mw_msgs <span class="token operator">=</span> _srs_config<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_mw_msgs</span><span class="token punctuation">(</span>req<span class="token operator">-</span><span class="token operator">&gt;</span>vhost<span class="token punctuation">,</span> realtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mw_sleep <span class="token operator">=</span> _srs_config<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_mw_sleep</span><span class="token punctuation">(</span>req<span class="token operator">-</span><span class="token operator">&gt;</span>vhost<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        consumer<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span>mw_msgs<span class="token punctuation">,</span> mw_sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>err <span class="token operator">=</span> consumer<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">dump_packets</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msgs<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> srs_success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">srs_error_wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"rtmp: consumer dump packets"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>err <span class="token operator">=</span> rtmp<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">send_and_free_messages</span><span class="token punctuation">(</span>msgs<span class="token punctuation">.</span>msgs<span class="token punctuation">,</span> count<span class="token punctuation">,</span> info<span class="token operator">-</span><span class="token operator">&gt;</span>res<span class="token operator">-</span><span class="token operator">&gt;</span>stream_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> srs_success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">srs_error_wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"rtmp: send %d messages"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>如果是25fps，那么8个包大约是在320ms，考虑音频包大约是160ms延迟，这个队列的额外延迟在直播中也是可以接受的。</p><p>如果是8个包一次发送，按照平均码率1Mbps，差不多是300Mb也就是40KB的数据。如果按照峰值5Mbps码率计算，那就是一次发送200KB的数据。我们可以用writev一次发送这些数据，就可以极大的提高分发的性能了。</p><p>每个连接我们需要的内存按照1MB来计算，那么4000个连接需要4GB内存。如果是7000个连接，需要7GB的内存。可以认为<a data-text-link="855_1958592" data-from="10680" href="https://cloud.tencent.com/product/lvb?from=10680" target="_blank">直播分发</a>的性能优化，是典型的内存（加少量延迟）来换更低的CPU使用。</p><blockquote><p>Note: 当然服务器引入额外的160ms延迟对于RTC场景就是不可以接受的，只能在直播中使用这种优化。</p><p>Note: RTC的UDP发送是否能使用类似的优化？我们调研过UDP/sendmmsg[28]和UDP/GSO[29]是可以提升一部分，但是由于UDP每个连接可合并发送的数据很少，目前压测分析热点也不在这里，所以优化有限，目前SRS并没有做这两个优化。</p></blockquote><h2 id="%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96" name="%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96">查找优化</h2><p>STL的vector和map的查找算法，已经优化得很好了，实际上还是会成为性能瓶颈。</p><p>比如，RTC由于实现了端口复用，需要根据每个UDP包的五元组（或其他信息），查找到对应的Session处理包；Session需要根据SSRC找到对应的track，让track处理这个包。</p><p>比如，SRS的日志是可追溯的，打印时会打印出上下文ID，可以将多个会话的日志分离。这个Context ID是存储在全局的map中的，每次切换上下文需要根据协程ID查找出对应的上下文ID。</p><p>如果每个包都需要这么运算一次，那开销也是相当可观的。考虑根据UDP包查找Session，如下图：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">int SrsUdpMuxSocket<span class="token operator">:</span><span class="token operator">:</span><span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token parameter">srs_utime_t timeout</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    nread <span class="token operator">=</span> <span class="token function">srs_recvfrom</span><span class="token punctuation">(</span>lfd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> nb_buf<span class="token punctuation">,</span> <span class="token punctuation">(</span>sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>from<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fromlen<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getnameinfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>from<span class="token punctuation">,</span> fromlen<span class="token punctuation">,</span>  <span class="token punctuation">(</span>char<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>address_string<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>char<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>port_string
    peer_ip <span class="token operator">=</span> std<span class="token operator">:</span><span class="token operator">:</span><span class="token function">string</span><span class="token punctuation">(</span>address_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    peer_port <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>port_string<span class="token punctuation">)</span><span class="token punctuation">;</span> 

srs_error_t SrsUdpMuxListener<span class="token operator">:</span><span class="token operator">:</span><span class="token function">cycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SrsUdpMuxSocket <span class="token function">skt</span><span class="token punctuation">(</span>lfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        int nread <span class="token operator">=</span> skt<span class="token punctuation">.</span><span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token constant">SRS_UTIME_NO_TIMEOUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        err <span class="token operator">=</span> handler<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">on_udp_packet</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>skt<span class="token punctuation">)</span><span class="token punctuation">;</span>

srs_error_t SrsRtcServer<span class="token operator">:</span><span class="token operator">:</span><span class="token function">on_udp_packet</span><span class="token punctuation">(</span><span class="token parameter">SrsUdpMuxSocket<span class="token operator">*</span> skt</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    string peer_id <span class="token operator">=</span> skt<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">peer_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ISrsResource<span class="token operator">*</span> conn <span class="token operator">=</span> _srs_rtc_manager<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find_by_id</span><span class="token punctuation">(</span>peer_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    session <span class="token operator">=</span> dynamic_cast<span class="token operator">&lt;</span>SrsRtcConnection<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

ISrsResource<span class="token operator">*</span> SrsResourceManager<span class="token operator">:</span><span class="token operator">:</span><span class="token function">find_by_id</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">std</span><span class="token operator">:</span><span class="token operator">:</span>string id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> ISrsResource<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token operator">:</span>iterator it <span class="token operator">=</span> conns_id_<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> conns_id_<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> it<span class="token operator">-</span><span class="token operator">&gt;</span>second <span class="token operator">:</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>这个逻辑有几个地方会有热点，通过压测可以在perf上看到：</p><p>•每个UDP包都调用<code>getnameinfo</code>将sockaddr转成字符串的<code>ip:port</code>，也就是地址标识，会有大量的string开辟和释放。•每个UDP包都需要根据<code>ip:port</code>，在map中查找出对应的Session（Resource或Conneciton），字符串查找的速度是很慢的。</p><p>改进其实也容易，查找时不转成string，而是生成uint64_t的地址，目前支持的是IPv4地址只需要6字节就可以表达<code>ip:port</code>（如果是IPv6则需要两个uint64_t），如下所示：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">int SrsUdpMuxSocket<span class="token operator">:</span><span class="token operator">:</span><span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token parameter">srs_utime_t timeout</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    nread <span class="token operator">=</span> <span class="token function">srs_recvfrom</span><span class="token punctuation">(</span>lfd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> nb_buf<span class="token punctuation">,</span> <span class="token punctuation">(</span>sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>from<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fromlen<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sockaddr_in<span class="token operator">*</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>sockaddr_in<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>from<span class="token punctuation">;</span>
    fast_id_ <span class="token operator">=</span> <span class="token function">uint64_t</span><span class="token punctuation">(</span>addr<span class="token operator">-</span><span class="token operator">&gt;</span>sin_port<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">48</span> <span class="token operator">|</span> <span class="token function">uint64_t</span><span class="token punctuation">(</span>addr<span class="token operator">-</span><span class="token operator">&gt;</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

srs_error_t SrsRtcServer<span class="token operator">:</span><span class="token operator">:</span><span class="token function">on_udp_packet</span><span class="token punctuation">(</span><span class="token parameter">SrsUdpMuxSocket<span class="token operator">*</span> skt</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uint64_t fast_id <span class="token operator">=</span> skt<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fast_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session <span class="token operator">=</span> <span class="token punctuation">(</span>SrsRtcConnection<span class="token operator">*</span><span class="token punctuation">)</span>_srs_rtc_manager<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find_by_fast_id</span><span class="token punctuation">(</span>fast_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>虽然解决了string查找的热点，随着并发的提升，<code>map&lt;key: uint64_t&gt;</code>的查找也变成了热点，在perf上可以看到map的不断平衡，我们还可以改成vector查找：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">ISrsResource<span class="token operator">*</span> SrsResourceManager<span class="token operator">:</span><span class="token operator">:</span><span class="token function">find_by_fast_id</span><span class="token punctuation">(</span><span class="token parameter">uint64_t id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SrsResourceFastIdItem<span class="token operator">*</span> item <span class="token operator">=</span> <span class="token operator">&amp;</span>conns_level0_cache_<span class="token punctuation">[</span><span class="token punctuation">(</span>id <span class="token operator">|</span> id<span class="token operator">&gt;&gt;</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">%</span> nn_level0_cache_<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token operator">-</span><span class="token operator">&gt;</span>available <span class="token operator">&amp;&amp;</span> item<span class="token operator">-</span><span class="token operator">&gt;</span>fast_id <span class="token operator">==</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token operator">-</span><span class="token operator">&gt;</span>impl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    map<span class="token operator">&lt;</span>uint64_t<span class="token punctuation">,</span> ISrsResource<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token operator">:</span>iterator it <span class="token operator">=</span> conns_fast_id_<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> conns_fast_id_<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> it<span class="token operator">-</span><span class="token operator">&gt;</span>second <span class="token operator">:</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p>Note: 首先我们在vector中取余查找，如果取余碰撞了（两个不同id但是取余后一样，比如1001%1000和2001%1000是一样的），那么就用map查找。</p></blockquote><p>通过不同的查找方式，string变uint64_t优化了查找速度，而更快的优化是不用map查找，直接使用数组取余就是无查找了。</p><p>当然，这样的优化，让逻辑变得复杂了。</p><h2 id="%E6%97%A0%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96" name="%E6%97%A0%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96">无代码优化</h2><p>当我们优化完明显的热点，优化完头部热点，会发现perf显示已经没有明显的热点，有时候有些不太明显的函数也会排在前头，比如拷贝RTP Packet：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">SrsRtpPacket<span class="token operator">*</span> SrsRtpPacket<span class="token operator">:</span><span class="token operator">:</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SrsRtpPacket<span class="token operator">*</span> cp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SrsRtpPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cp<span class="token operator">-</span><span class="token operator">&gt;</span>header <span class="token operator">=</span> header<span class="token punctuation">;</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>payload_ <span class="token operator">=</span> payload_<span class="token operator">?</span> payload_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>payload_type_ <span class="token operator">=</span> payload_type_<span class="token punctuation">;</span>

    cp<span class="token operator">-</span><span class="token operator">&gt;</span>nalu_type <span class="token operator">=</span> nalu_type<span class="token punctuation">;</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>shared_buffer_ <span class="token operator">=</span> shared_buffer_<span class="token operator">?</span> shared_buffer_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">copy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>actual_buffer_size_ <span class="token operator">=</span> actual_buffer_size_<span class="token punctuation">;</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>frame_type <span class="token operator">=</span> frame_type<span class="token punctuation">;</span>

    cp<span class="token operator">-</span><span class="token operator">&gt;</span>cached_payload_size <span class="token operator">=</span> cached_payload_size<span class="token punctuation">;</span>
    <span class="token comment">// For performance issue, do not copy the unused field.</span>
    cp<span class="token operator">-</span><span class="token operator">&gt;</span>decode_handler <span class="token operator">=</span> decode_handler<span class="token punctuation">;</span>

    <span class="token keyword">return</span> cp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>这个函数有啥可以优化的么？没有什么可以优化的，全都是赋值和拷贝（无深拷贝），但是在perf上它就是排名在前头。</p><blockquote><p>Note: 这时候千万别怀疑perf有问题，确实热点是这个拷贝是没有错的，perf不会出错，perf不会出错，perf不会出错，千万不要把焦点挪开去优化其他函数。</p></blockquote><p>并不是函数性能高，就不会成为瓶颈，有个公式如下：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">性能热点 <span class="token operator">=</span> 函数执行效率 x 函数执行次数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>一般我们会优先优化函数执行效率，让函数更高效。但是我们也不能忽略了函数的执行次数，如果一个高效的函数被反复的执行，一样也会变成性能热点。这时候我们的优化思路就是：<code>如何让代码不执行，或明显减少执行次数</code>。</p><p>通过分析可以发现，这个<code>SrsRtpPacket::copy</code>调用点有：</p><p>•从Publisher拷贝到每个Consumer，函数是<code>SrsRtcSource::on_rtp</code>。•包发送后，放到Track的NACK队列，函数是<code>SrsRtcRecvTrack::on_nack</code>和<code>SrsRtcSendTrack::on_nack</code>。</p><p>上面第二个拷贝可以省略，由于每个Player都有NACK，所以可以减少一倍的调用，优化后这个热点也就不排在前头了：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">srs_error_t SrsRtcRecvTrack<span class="token operator">:</span><span class="token operator">:</span><span class="token function">on_nack</span><span class="token punctuation">(</span><span class="token parameter">SrsRtpPacket<span class="token operator">**</span> ppkt</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    rtp_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">set</span><span class="token punctuation">(</span>seq<span class="token punctuation">,</span> pkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>ppkt <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>同样的，这个优化的代价就是增加了风险，参数也从指针，变成了指针的指针，一路都改成了指针的指针，可以犯错的概率就大太多了。</p><h2 id="UDP%E5%8D%8F%E8%AE%AE%E6%A0%88" name="UDP%E5%8D%8F%E8%AE%AE%E6%A0%88">UDP协议栈</h2><p>在直播优化中，我们使用<code>writev</code>一次写入大量的数据，大幅提高了播放的性能。</p><p>其实UDP也有类似的函数，UDP的<code>sendto</code>对应TCP的<code>write</code>，UDP的<code>sendmmsg</code>对应TCP的<code>writev</code>，我们调研过UDP/sendmmsg[30]是可以提升一部分性能，不过它的前提是：</p><p>•在Perf中必须看到UDP的相关函数成为热点，如果有其他的热点比UDP更耗性能，那么上sendmmsg也不会有改善。•一般并发要到2000以上，UDP协议栈才可能出现在perf的热点，较低并发时收发的包，还不足以让UDP的函数成为热点。•由于不能增加延迟，需要改发送结构，集中发给多个地址的UDP包统一发送。这对可维护性上是比较大的影响。</p><p>还有一种优化是GSO，延迟分包。我们调研过UDP/GSO[31]，比<code>sendmmsg</code>提升还要大一些，它的前提是：</p><p>•和<code>sendmmsg</code>一样，只有当UDP相关函数成为perf的热点，优化才有效。•GSO只能对一个客户端的包延迟组包，所以他的作用取决于要发给某个客户端的包数目，由于RTC的实时性要求，一般2到3个比较常见。</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/b096a1900bdf04179aba2152ee831fbe.png" class="" style="cursor: zoom-in;"></span></div></figure><blockquote><p>Note: 从上图可见，开启Padding后，UDP组包效能可以提升10%左右。GSO虽然不能减少实际网络上UDP包的数目，但是可以让内核延迟到最后才组UDP包，可以把GSO发送的多个包认为是一个包，相当于减少了发送UDP包的次数。</p></blockquote><p>还有一种优化的可能，就是ZERO_COPY，其实TCP的零拷贝支持得比较早，但是UDP的支持得比较晚一些。收发数据时，需要从用户空间到内核空间不断拷贝，不过之前测试没有明显收益，参考ZERO-COPY[32]。</p><h2 id="%E5%A4%9A%E7%BA%BF%E7%A8%8B" name="%E5%A4%9A%E7%BA%BF%E7%A8%8B">多线程</h2><p>文章开头我们提到，第三代高并发架构，将是隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[33]。</p><p>我们也调研过SRS可能的多线程架构，参考#2188[34]。和Envoy不同，SRS涉及到了TCP和UDP，API和媒体服务，级联和QoS等问题，可能的架构也比较多。</p><p>SRS 1/2/3/4一直都是单线程（第二代架构），如下图所示：</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/e4018665c7ca57220560ff6b4295e89a.png" class="" style="cursor: zoom-in;"></span></div></figure><blockquote><p>Note：这个架构的风险一直都存在，写磁盘可能是阻塞的，DNS解析可能是阻塞的，RTC无法使用多CPU的能力（直播可以用<a data-from="10680" href="https://mp.weixin.qq.com/s?__biz=MzA4NTQ3MzQ5OA==&amp;mid=2649003831&amp;idx=1&amp;sn=6626766960d3edd930af0eef5321e416&amp;scene=21#wechat_redirect" target="_blank" rel="nofollow noopener noreferrer">集群或REUSE_PORT扩展多核能力</a>）。</p></blockquote><p>很显然，写磁盘应该由单独线程完成，可以避免阻塞，这就是SRS 5.0使用的架构：</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/9cf41b6aad1303bd0310ee18c9516817.png" class="" style="cursor: zoom-in;"></span></div></figure><blockquote><p>Note: 其实DVR和HLS也是写磁盘操作，未来也会由写磁盘的线程实现，目前还没有实现。</p><p>Note: DNS解析也是阻塞的，和写磁盘不同，DNS解析本质上是UDP请求，是可以自己实现协议解析，不需要用多线程做。</p></blockquote><p>针对RTC的多核扩展能力，有一种很自然（也是改动较小）的思路，就是将更多的能力拆分到线程中。比如SRTP加解密，占用了30%的CPU，如果能拆分到独立线程肯定对并发能力有提升。比如UDP收发也可以放到独立线程，也可以避免内核UDP收发效率不高的问题。如下图所示：</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/e9037161161b0c73a50180f56d400780.png" class="" style="cursor: zoom-in;"></span></div></figure><blockquote><p>Note: 这个架构是被标记为<code>废弃</code>，原因就是SRTP和UDP确实效率不高，但是Hybrid里面的QoS算法是瓶颈所在，而这部分不方便拆分多线程。</p><p>Note: 另外，就算QoS拆分成多线程，这个架构最多用到大约3～4CPU，并不能用到32或64核CPU，也就是并发能力还是受限。</p><p>Note: 最后，这种多线程架构，线程之间交互较多，所以会有锁的开销，也不算第三代服务器架构。</p></blockquote><p>最终的多线程架构，是能水平扩展的多线程架构，实现的原型参考feature/threads[35]分支，如下图所示：</p><figure class=""><div class="image-block"><span><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/0ce825559c0265e733eb2ffa23fc3f9f.png" class="" style="cursor: zoom-in;"></span></div></figure><blockquote><p>Note: 我们实现的一个版本是多端口模型，通过端口分割不同的Hybrid线程，Hybrid线程之间独立不需要交互。实际上多线程之间也是可以复用同样端口的，只是切网时需要考虑新五元组的绑定。</p><p>Note: 这个架构完全解决了水平扩展的问题，也避免了线程之间需要交互数据，压测在32核C5机器上，能跑到10K左右并发（可以在更多核的机器上扩展）。</p></blockquote><p>当然，最后这个架构也并非没有问题，目前看还需要解决以下问题，才能在线上使用：</p><p>•API必须非常简单，如果是Janus那种复杂的API，就无法使用这种结构。SRS目前的API是比较合适实现这种架构。API实际上承担了调度的能力。•直播需要改进，适配这种多线程结构。直播Edge相对比较容易改造，可以用REUSE_PORT，相当于多个进程。而直播Origin改造比较麻烦。•统计和API需要改造，系统的CPU使用率，告警和水位统计，限流策略，都会因为多线程有所不同。比如在线人数，需要汇总每个线程的连接数。•全局变量和局部静态变量，必须仔细Check，保障是线程安全(thread-safe)，或者是线程局部(thread-local)，虽然我们在原型中已经改造得差不多，但还是需要更多确认。</p><p>由于多线程本质上和集群的能力是有一部分重合的，只是多线程的效率更高。比如直播其实可以用多个Edge部署在一台机器上（Edge后面挂一堆Edge），实现多核的扩展。RTC如果实现了级联，也一样是可以扩展多核能力，比如单核支持800个并发，每个SRS跑在一个Pod中，也可以用级联扩展能力（当然会造成进程之间的带宽比多线程要高，多线程是不走带宽）。</p><h2 id="%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F" name="%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F">硬件加速</h2><p>SRS没有使用硬件加速，但这个是一个很不错的思路，包括：</p><p>•CPU指令集优化：加解密和编解码的算法，有些可以用到CPU的特殊指令，增加批处理的能力，比如AVX512[36]。•专用加解密硬件卡，加解密是比较通用的算法，有专门硬件，可以调研看看。•UDP收发优化，不经过内核协议栈，直接从用户空间和网卡交互：DPDK[37]。</p><h2 id="%E6%80%BB%E7%BB%93" name="%E6%80%BB%E7%BB%93">总结</h2><p>性能优化，是全面的和持续的工程能力，涉及到了对系统的理解、对业务的认知、对编程语言的熟悉、对硬件和软件框架的挖掘、性能分析工具链的使用，心肝脾肺肾只有全面提升，最终才能获得性能的提升。</p><h3 id="References" name="References"><strong>References</strong></h3><p><code>[1]</code>&nbsp;C10K:&nbsp;<em style="font-style:italic">http://www.kegel.com/c10k.html</em>
<code>[2]</code>&nbsp;Adobe AMS:&nbsp;<em style="font-style:italic">https://helpx.adobe.com/adobe-media-server/tech-overview/introduction-ams.html</em>
<code>[3]</code>&nbsp;Apache HTTP Server:&nbsp;<em style="font-style:italic">https://httpd.apache.org/</em>
<code>[4]</code>&nbsp;Janus WebRTC Server:&nbsp;<em style="font-style:italic">https://github.com/meetecho/janus-gateway</em>
<code>[5]</code>&nbsp;Nginx:&nbsp;<em style="font-style:italic">https://nginx.org/</em>
<code>[6]</code>&nbsp;SRS:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs</em>
<code>[7]</code>&nbsp;MediaSoup:&nbsp;<em style="font-style:italic">https://github.com/versatica/mediasoup</em>
<code>[8]</code>&nbsp;异步回调问题:&nbsp;<em style="font-style:italic">http://callbackhell.com/</em>
<code>[9]</code>&nbsp;Envoy线程模型:&nbsp;<em style="font-style:italic">https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310</em>
<code>[10]</code>&nbsp;Envoy:&nbsp;<em style="font-style:italic">https://www.loggly.com/blog/benchmarking-5-popular-load-balancers-nginx-haproxy-envoy-traefik-and-alb/</em>
<code>[11]</code>&nbsp;完全非阻塞:&nbsp;<em style="font-style:italic">https://dropbox.tech/infrastructure/how-we-migrated-dropbox-from-nginx-to-envoy</em>
<code>[12]</code>&nbsp;#2188:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/2188</em>
<code>[13]</code>&nbsp;feature/threads:&nbsp;<em style="font-style:italic">https://github.com/winlinvip/srs/tree/feature/threads</em>
<code>[14]</code>&nbsp;ECS/G5-2.5GHZ(SkyLake):&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html</em>
<code>[15]</code>&nbsp;SRS/v4.0.105:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/commit/2ad24b2313e88a85801deaea370204f225555939</em>
<code>[16]</code>&nbsp;NginxRTMP/v1.2.1:&nbsp;<em style="font-style:italic">https://github.com/arut/nginx-rtmp-module/releases/tag/v1.2.1</em>
<code>[17]</code>&nbsp;srs-bench:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs-bench/tree/feature/rtc#usage</em>
<code>[18]</code>&nbsp;网卡队列缓冲区:&nbsp;<em style="font-style:italic">https://www.jianshu.com/p/6d4a89359352</em>
<code>[19]</code>&nbsp;网卡队列缓冲区:&nbsp;<em style="font-style:italic">https://www.jianshu.com/p/6d4a89359352</em>
<code>[20]</code>&nbsp;webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13:&nbsp;<em style="font-style:italic">http://localhost/players/rtc_player.html?autostart=true&amp;api=1985&amp;eip=8.126.115.13&amp;server=8.126.115.13&amp;vhost=8.126.115.13&amp;stream=livestream100</em>
<code>[21]</code>&nbsp;srs-bench:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs-bench/tree/feature/rtc#usage</em>
<code>[22]</code>&nbsp;SRS性能(CPU)、内存优化工具用法:&nbsp;<em style="font-style:italic">https://www.jianshu.com/p/6d4a89359352</em>
<code>[23]</code>&nbsp;ECS ecs.c5.large:&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html#c5</em>
<code>[24]</code>&nbsp;ECS ecs.c5.xlarge:&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html#c5</em>
<code>[25]</code>&nbsp;ECS ecs.c5.2xlarge:&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html#c5</em>
<code>[26]</code>&nbsp;G5:&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html#g5</em>
<code>[27]</code>&nbsp;R5:&nbsp;<em style="font-style:italic">https://help.aliyun.com/document_detail/25378.html#r5</em>
<code>[28]</code>&nbsp;UDP/sendmmsg:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/307#issuecomment-609020985</em>
<code>[29]</code>&nbsp;UDP/GSO:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/307#issuecomment-612953502</em>
<code>[30]</code>&nbsp;UDP/sendmmsg:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/307#issuecomment-609020985</em>
<code>[31]</code>&nbsp;UDP/GSO:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/307#issuecomment-612953502</em>
<code>[32]</code>&nbsp;ZERO-COPY:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/307#issuecomment-615884074</em>
<code>[33]</code>&nbsp;Envoy线程模型:&nbsp;<em style="font-style:italic">https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310</em>
<code>[34]</code>&nbsp;#2188:&nbsp;<em style="font-style:italic">https://github.com/ossrs/srs/issues/2188</em>
<code>[35]</code>&nbsp;feature/threads:&nbsp;<em style="font-style:italic">https://github.com/winlinvip/srs/tree/feature/threads</em>
<code>[36]</code>&nbsp;AVX512:&nbsp;<em style="font-style:italic">https://zhuanlan.zhihu.com/p/83399457</em>
<code>[37]</code>&nbsp;DPDK:&nbsp;<em style="font-style:italic">https://www.dpdk.org/</em></p></div></div><div class="col-2-article-source"><div class="col-2-wechat-panel"><div class="col-2-wechat-panel-inner"><div class="col-2-wechat-panel-left"><div class="col-2-wechat-panel-tip">文章分享自微信公众号：</div><div class="col-2-wechat-panel-qr"><div class="qr-code"><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/qrcode_gh_0fe2793e1d87_1.jpg" alt=""></div><div class="qr-desc"><div class="qr-desc-info"><span class="qr-desc-text">SRS开源服务器</span></div><button type="button" class="c-btn c-btn-hole qr-desc-btn" data-clipboard-text="SRS开源服务器">复制公众号名称</button></div></div></div><div class="col-2-wechat-panel-split"></div><div class="col-2-wechat-panel-right"><div class="col-2-wechat-panel-desc"><p>本文参与 <a href="https://cloud.tencent.com/developer/support-plan" target="_blank">腾讯云自媒体分享计划</a> ，欢迎热爱写作的你一起参与！</p><div class="col-2-wechat-panel-tip">作者：<!-- -->ossrs</div><div class="col-2-wechat-panel-tip">原始发表时间：<!-- -->2021-05-26</div><div class="col-2-wechat-panel-tip">如有侵权，请联系 <!-- -->cloudcommunity@tencent.com<!-- --> 删除。</div></div></div></div></div></div></div><div class="com-markdown-collpase-toggle"><a href="javascript:;" class="toggle-link">展开阅读全文</a></div></div><div class="col-2-article-tags"><div class="extra-part"><div class="com-operations"><a href="javascript:;" class="com-opt-link link-warn"><i class="com-i-warn"></i>举报</a></div></div></div><div class="col-2-article-opts"><button type="button" class="c-btn"><span class="text"><i class="opt-icon like"></i>点赞 1</span></button><button type="button" class="c-btn c-btn-weak"><span class="text"><i class="opt-icon share"></i>分享</span></button></div><section class="group-comments"><div class="com-comment-single-edit theme2"><div class="edit-body"><div class="edit-textarea"></div><div class="edit-tip"><a href="javascript:;">登录</a> 后参与评论</div></div></div><div class="col-2-article-filter"><div class="article-filter-main"><em>0</em> 条评论</div></div><section class="com-comment-popup"><div class="popup-bd"><div></div></div></section></section></section><section class="com-2-panel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">相关文章</h3></header><ul class="com-3-article-panels without-padding-top"><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958540?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">比nginx-rtmp高三倍性能的SRS的高性能是个什么球？</h3><p class="com-3-article-panel-desc">SRS单进程能支持9000并发，nginx-rtmp单进程最多支持3000个，单进程的性能SRS是nginx-rtmp的三倍。SRS单进程性能如何做到nginx...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1871237?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">开源圆桌 Q&amp;A 集锦</h3><p class="com-3-article-panel-desc"> 段维伟-使用 Flutter 2.0 开发多平台 VOIP/WebRTC 客户端 
</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/5720403" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg)"></span></span>LiveVideoStack</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-5720403/2924892d2d1002308fccb6aea086710d.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958583?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">LVS分享SRS：从开源到商业服务的万水千山</h3><p class="com-3-article-panel-desc">音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？
  个人...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1871245?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">RTC服务架构演进——边缘云原生方向</h3><p class="com-3-article-panel-desc">音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？本次Liv...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/5720403" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg)"></span></span>LiveVideoStack</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-5720403/bfe59d54da878b3f5d4b4285ad605415.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958544?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">在HLS上花10倍的代码，SRS值得个球吗？</h3><p class="com-3-article-panel-desc">移动端发展速度已经不用科普了，移动端的流媒体用什么分发？SRS为何要重写HLS和HTTP？为什么说SRS才是标准移动端的流媒体服务器？ 移动端是个可以好好装逼的...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958556?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS3 Release experimental MPEG-DASH</h3><p class="com-3-article-panel-desc">SRS3从2017.01月春节开始支持MPEG-DASH，2月份后支持了DVR MP4，3月份支持了MPD和init.mp4，5月份支持了MP4 Parser ...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958615?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS的2021，盐碱地里种西瓜的王婆</h3><p class="com-3-article-panel-desc">本来写了20380个字的年终总结，后来画了一张图差不多就说清楚了，压缩到了4131字，是下图大图哈，不是上面小图哈哈哈：  Note: 我本来准备了一堆的具体数...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/2039719?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS5第一大炮：如何实现SRT协程化</h3><p class="com-3-article-panel-desc">Coroutine Native SRT
Written by&nbsp;John[1],&nbsp;Winlin[2]
协程是现代服务器的核心技术，能极大简化逻辑和提升维护性；S...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/b2bfdc31032f2f2b955d4ac90291bb44.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958593?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">如何选择音视频开源项目，避坑指南，入坑躺平</h3><p class="com-3-article-panel-desc">音视频业务的繁荣，必定造就开源项目的繁荣，反过来说也是一样的，互相成就。遍地都是开源的轮子，如何选择？提供一个有效的角度，可作为避坑指南。如果已经入坑了，您躺平...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958545?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS的Simple架构，如何简化N个数量级？</h3><p class="com-3-article-panel-desc">SRS最关键是Simple，最简单的方案就是最佳方案；这个文章记录了SRS关键的Simple方案，也就是50%代码完成200%功能，100%代码完成400%功能...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/2010293?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS：流媒体服务器如何实现负载均衡</h3><p class="com-3-article-panel-desc">&nbsp;点击上方“LiveVideoStack”关注我们
作者：Winlin、Azusachino、Benjamin
编辑：Alex

▲扫描图中二维码或点击阅读原文...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/5720403" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg)"></span></span>LiveVideoStack</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/5720403/5ac19b382790691990d92e065d882e84.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958546?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">深入浅出看流媒体前世今生，分分钟二逼变牛逼</h3><p class="com-3-article-panel-desc">CDN这几年爆炸式增长，带宽提速是根源，而HTTP始终还是那个屌样，因此目前CDN大多是资本性行业，不用多少知识就能干了；直到流媒体粗现，直播咋这么难搞呢？因为...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958625?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">云SRS：直播转发多平台</h3><p class="com-3-article-panel-desc">在多个平台做直播是一个常用的功能，也有不少平台支持这个功能，体验过一些还是不太好用。简单易用，开箱即用，还是要看SRS云服务器的。 Why 为何要推流到多个直播...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1958586?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">劳动节之一：SRS中RTC基于流的场景应用，RTC和RTMP流互相转换</h3><p class="com-3-article-panel-desc">大约在一年前，SRS开始支持了WebRTC，这一年一直在持续的更新和收集大家的反馈，终于目前达到了基本可以的里程碑了，是时候总结下使用方法，更新Wiki和DEM...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1786233?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS、EasyDarwin、ZLMediaKit、Monibuca对比分析</h3><p class="com-3-article-panel-desc">目前市面上有很多开源的流媒体服务器解决方案，常见的有SRS、EasyDarwin、ZLMediaKit和Monibuca等，我们应该怎么选择呢？</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1678204" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1678204/qqpdn3sxy4.jpeg?imageView2/2/w/64)"></span></span>liuzhen007</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/2001762?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">SRS学习路径</h3><p class="com-3-article-panel-desc">新同学专用的学习路径，请一定按照文档操作。
文章中有较多的链接，链接地址是在文末尾的。也可以点文末尾的阅读原文，查看本文在简书上的版本。
快速预览
先过第一个门...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/64)"></span></span>Winlin</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/8722662/feadd14720d36eb74223d7bcc694283f.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1775831?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">目前直播技术汇总及低延时直播的方案汇总</h3><p class="com-3-article-panel-desc">HLS：延迟主要来自编码解码时产生延迟、网络延迟、CDN 分发延迟。由于它是切片协议，延迟分两大块，一个是服务端有切片缓冲延迟，另一个是在播放端防抖缓冲会有延迟...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/4140184" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/4140184/8t56vpcuxe.jpg)"></span></span>剑行者</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-4140184/kdlht9zbrs.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1198404?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">技术福利：最全实时音视频开发要用到的开源工程汇总</h3><p class="com-3-article-panel-desc">实时音视频的开发学习有很多可以参考的开源项目。一个实时音视频应用共包括几个环节：采集、编码、前后处理、传输、解码、缓冲、渲染等很多环节。每一个细分环节，还有更细...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1037212" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1037212/j9twhirvmn.jpeg?imageView2/2/w/64)"></span></span>JackJiang</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1588116?from=article.detail.1958592" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">在家办公心不慌，运维请收好这几个远程管理软件</h3><p class="com-3-article-panel-desc">分享@央视新闻制作的新型肺炎疫情防护措施线路图。宅在家里，上班路上，返程路上，这些防护措施请牢记↓↓↓</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/6543014" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/random-avatar/6543014/0ncw5gwv5a.png)"></span></span>用户6543014</a></div></div></div></div></div></li></ul><div class="com-list-enter"><a href="https://cloud.tencent.com/developer/column" class="com-arrow-link">更多文章</a></div></section></div><div class="layout-side"><section class="com-2-panel side J-authorPanel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">作者介绍</h3></header><div class="com-2-panel-bd"><div class="com-author-intro"><div class="com-author-intro-object"><a href="https://cloud.tencent.com/developer/user/8722662" class="com-author-intro-avatar" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg?imageView2/2/w/160)" target="_blank"></a></div><h3 class="com-author-intro-name"><a href="https://cloud.tencent.com/developer/user/8722662" class="com-author-intro-name-inner" title="Winlin" target="_blank">Winlin</a></h3><div class="com-author-intro-desc" title="腾讯云工程师">腾讯云工程师<div class="c-bubble-trigger com-verification"><i class="verified"></i><div class="c-bubble c-bubble-bottom"><div class="c-bubble-inner" style="padding:8px 10px"><p>腾讯云 · 工程师 (已认证)</p></div></div></div></div><div class="com-author-intro-btns"><button type="button" class="c-btn c-btn" hotrep="community.column.article2.follow"><span class="text">关注</span></button><a href="https://cloud.tencent.com/developer/column/94785" target="_blank" class="c-btn c-btn-hole" hotrep="community.column.article2.column"><span class="text">专栏</span></a></div><ul class="com-author-intro-infos"><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">文章</div><div class="com-author-intro-info-num">99</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">阅读量</div><div class="com-author-intro-info-num">20.8K</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/8722662" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">获赞</div><div class="com-author-intro-info-num">197</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/rank" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">作者排名</div><div class="com-author-intro-info-num">4098</div></a></li></ul></div></div></section><section class="com-2-panel side J-specialTopicPanel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">精选专题</h3></header><div class="com-2-panel-bd"><ul class="com-2-side-topics without-margin"><li><a href="https://cloud.tencent.com/developer/special/TencentCloudNative" class="com-media com-side-topic" hotrep="community.column.article2.side_topic.0.link"><div class="com-media-object"><span class="com-thumbnail" style="background-image:url(https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/k8pfdhqi7p.jpg?imageView2/2/w/120)"></span></div><div class="com-media-body"><h3 class="com-side-topic-title" title="腾讯云原生专题">腾讯云原生专题</h3><div class="com-side-topic-desc" title="云原生技术干货，业务实践落地。">云原生技术干货，业务实践落地。</div></div></a></li></ul></div></section><section class="com-2-panel side J-activityRecommend"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">活动推荐</h3></header><div class="com-2-panel-bd"><ul class="com-2-side-activities"><li><a href="https://cloud.tencent.com/developer/special/developerclass" class="com-media com-2-side-activity" hotrep="community.column.article2.side_activity.0.link"><div class="com-media-body"><h3 class="com-2-side-activity-title" title="视频公开课上线啦">视频公开课上线啦</h3><div class="com-2-side-activity-desc" title="Vite学习指南，基于腾讯云Webify部署项目">Vite学习指南，基于腾讯云Webify部署项目</div></div><div class="com-media-object"><button type="button" class="s com-2-side-activity-btn c-btn c-btn-hole" hotrep="community.column.article2.side_activity.0.btn"><span class="text">立即查看</span></button></div></a></li><li><a href="https://cloud.tencent.com/developer/support-plan" class="com-media com-2-side-activity" hotrep="community.column.article2.side_activity.1.link"><div class="com-media-body"><h3 class="com-2-side-activity-title" title="腾讯云自媒体分享计划">腾讯云自媒体分享计划</h3><div class="com-2-side-activity-desc" title="入驻云加社区，共享百万资源包。">入驻云加社区，共享百万资源包。</div></div><div class="com-media-object"><button type="button" class="s com-2-side-activity-btn c-btn c-btn-hole" hotrep="community.column.article2.side_activity.1.btn"><span class="text">立即入驻</span></button></div></a></li></ul><header class="com-2-panel-subhd"><h3 class="com-2-panel-subtitle">运营活动</h3></header><div class="com-event-panel com-event-panel-l theme2 without-margin"><div class="com-event-panel-inner"><div class="com-event-panel-object"><a href="https://cloud.tencent.com/act/pro/CDN-?from=11855"><img class="com-event-panel-img" alt="活动名称" src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/tcvok1oxop.png"></a><div class="com-event-panel-sign-wrap"><span class="com-event-panel-sign">广告</span><a href="javascript:;" class="com-event-panel-close">关闭</a></div></div></div></div></div></section><div class="com-nav-bar absolute" style="max-height: none; overflow-y: auto; position: fixed; top: 74px;"><h3 class="com-nav-bar-title">目录</h3><ul class="com-nav-bar-menu"><li data-key="2.1" class="menu-item active"><a href="javascript:;" title="性能基准">性能基准</a></li><li data-key="2.2" class="menu-item"><a href="javascript:;" title="工具链">工具链</a></li><li data-key="2.3" class="menu-item"><a href="javascript:;" title="内存交换性能">内存交换性能</a></li><li data-key="2.4" class="menu-item"><a href="javascript:;" title="查找优化">查找优化</a></li><li data-key="2.5" class="menu-item"><a href="javascript:;" title="无代码优化">无代码优化</a></li><li data-key="2.6" class="menu-item"><a href="javascript:;" title="UDP协议栈">UDP协议栈</a></li><li data-key="2.7" class="menu-item"><a href="javascript:;" title="多线程">多线程</a></li><li data-key="2.8" class="menu-item"><a href="javascript:;" title="硬件加速">硬件加速</a></li><li data-key="2.9" class="menu-item"><a href="javascript:;" title="总结">总结</a><ul class="level-2"><li data-key="3.1" class="menu-item"><a href="javascript:;" title="References">References</a></li></ul></li></ul></div></div></div></div><div class="J-footer com-2-footer"><div class="com-2-footer-inner"><div class="com-2-footer-main"><div class="com-2-footer-main-ctn"><div class="com-2-footer-main-inner"><div class="com-2-footer-website"><ul class="com-2-footer-website-group"><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">社区</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/column" hotrep="community.footer.community.article">专栏文章</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/inventory" hotrep="community.footer.community.inventory">阅读清单</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/ask" hotrep="community.footer.community.ask">互动问答</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/salon" hotrep="community.footer.community.salon">技术沙龙</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/video" hotrep="community.footer.community.video">技术视频</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/teams" hotrep="community.footer.community.teams">团队主页</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/timl" hotrep="community.footer.community.timl">腾讯云TI平台</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">活动</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/support-plan" hotrep="community.footer.activity.support-plan">自媒体分享计划</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/support-plan-invitation" hotrep="community.footer.activity.support-plan-invitation">邀请作者入驻</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1535830" hotrep="community.footer.activity.article-1535830">自荐上首页</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">资源</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/specials" hotrep="community.footer.resource.specials">技术周刊</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/tags" hotrep="community.footer.resource.tags">社区标签</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs" hotrep="community.footer.community.devdocs">开发者手册</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/labs" target="_blank" hotrep="community.footer.resource.labs">开发者实验室</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">关于</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="javascript:;" hotrep="community.footer.about.video">视频介绍</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006434" hotrep="community.footer.about.spec">社区规范</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006435" hotrep="community.footer.about.disclaimer">免责声明</a></li><li class="com-2-footer-website-item"><a href="mailto:cloudcommunity@tencent.com" hotrep="community.footer.about.contact">联系我们</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/friendlink" target="_blank" hotrep="community.footer.about.friendlink">友情链接</a></li></ul></div></li><li class="com-2-footer-website-column com-v-box"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">归档</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/ask/archives.html">问题归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/column/archives.html">专栏文章归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/news/archives.html">快讯文章归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/information/all.html">关键词归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs/archives.html">开发者手册归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs/sections_p1.html">开发者手册 Section 归档</a></li></ul></div></li></ul></div><div class="com-2-footer-copyright"><h3 class="com-2-footer-copyright-title">腾讯云开发者</h3><div class="com-2-footer-qr"><div class="com-2-footer-qr-object"><img class="com-2-footer-qr-image" src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/wechat-qr.jpg" alt=""></div><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">扫码关注腾讯云开发者</span></p><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">领取腾讯云代金券</span></p></div></div></div></div></div></div><div class="com-2-footer-recommend"><div class="com-2-footer-inner"><div class="com-2-footer-recommend-rows"><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">热门产品</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://dnspod.cloud.tencent.com/" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.ymzc">域名注册</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cvm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.cvm">云服务器</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tbaas" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.tbaas">区块链服务</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/mq" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.mq">消息队列</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/dsa" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.dsa"> 网络加速</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tencentdb-catalog" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.tencentdb-catalog">云数据库</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cns" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.rmjx">域名解析</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cos" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.cos">云存储</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/css" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.css">视频直播</a></li></ul></div></div><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">热门推荐</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/facerecognition" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.facerecognition">人脸识别</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.tm">腾讯会议</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/act/pro/enterprise2019" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.enterprise2019">企业云</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdn-scd" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.cdn-scd">CDN 加速</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/trtc" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.trtc">视频通话</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tiia" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.tiia">图像分析</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdb" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.cdb">MySQL 数据库</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/symantecssl" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.symantecssl">SSL 证书</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/asr" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.asr">语音识别</a></li></ul></div></div><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">更多推荐</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/solution/data_protection" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.data_protection">数据安全</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/clb" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.clb">负载均衡</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/sms" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.sms">短信</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/ocr" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.ocr">文字识别</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/vod" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.vod">云点播</a></li><li class="com-2-footer-recommend-item"><a href="https://tm.cloud.tencent.com/" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.tm">商标注册</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/solution/la" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.la">小程序开发</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cat" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.cat">网站监控</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.cdm">数据迁移</a></li></ul></div></div></div></div></div><div class="com-2-footer-copyright-cnt"><div class="com-2-footer-inner"><p>Copyright © 2013 - 2022 Tencent Cloud. All Rights Reserved. 腾讯云 版权所有 <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287" hotrep="community.footer.link.beian" target="_blank">京公网安备 11010802017518 </a><a href="http://beian.miit.gov.cn/" target="_blank" hotrep="community.footer.link.miitbeian">粤B2-20090059-1</a></p></div></div></div></div><div class="com-widget-global"><div style="position:relative;z-index:8088"><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img"><img src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/wechat-qr.jpg" alt=""></div><p class="qr-txt">扫码关注腾讯云开发者</p><p class="qr-txt">领取腾讯云代金券</p></div></div></div></div><button class="widget-btn widget-back2top" title="返回顶部" hotrep="community.edge-widget.back2top" style="outline: none;">返回顶部</button></div><div id="dialog-root"></div><div id="rno-dialog-root" class="rno-modal-wrap"></div></div><script>window.isServerContext = false; window.isClientContext = true;</script><script>window.$serverTime = 1660267250672; window.$clientTime = Date.now();</script><script>window.$ua = {"ua":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36","browser":{"name":"Chrome","version":"104.0.0.0","major":"104"},"engine":{"name":"Blink","version":"104.0.0.0"},"os":{"name":"Windows","version":"10"},"device":{},"cpu":{"architecture":"amd64"}};</script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/polyfill.6.26.min.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/react.16.8.6.min.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/react-dom.16.8.6.min.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/jquery-3.2.1.min.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/base.3a953bd389.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/draft-master-v1.4.50.d4s2ddo9sb.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/api.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/wechatJsSdk.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/common.f9290a319a.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/hls.min.0.13.2m.js.下载"></script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/tcplayer.v4.1.min.js.下载"></script><script>
					window.Sentry && Sentry.init({
						dsn: 'https://b818989a357242579a70606e04e176fe@report.url.cn/sentry/3800',
						tracesSampleRate: 0.5,
						environment: 'production',
						release: '2022-08-10',
						ignoreErrors: [
  "undefined is not an object (evaluating 'window.ucbrowser.smWeather.changecity')",
  "JSON syntax error",
  'Permission denied to access property "unlock"',
  "Unexpected token '<'",
  "this.hostIndex.push is not a function",
  "Block-scoped declarations (let, const, function, class) not yet supported outside strict mode",
  "NetworkError when attempting to fetch resource",
  "Can't find variable: GetHTMLElementsAtPoint",
  "Non-Error promise rejection captured with value: init auth timeout",
  "Can't find variable: UC_NEWS_PAUSE_ALL_VIDEOS",
  "window.bannerNight is not a function",
  "safari-extension",
  "Can't find variable: objectInnerText",
  "moz-extension",
  "window.GM_getTab is not a function",
  "expected expression, got '<'",
  "start_pan is not defined",
  "server_fp is not defined",
  "Can't find variable: GetImageTagSrcFromPointUseNewFun",
  "[native code] in eval",
  "Unexpected identifier 'href'",
  "Network Error",
  "QuotaExceededError",
  "Error: Request aborted",
]
					});
					</script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/article-detail.c5f5922a24.js.下载"></script><script>
window.$render({"articleDetail":{"id":1958592,"articleId":1958592,"title":"性能优化：SRS为何能做到同类的三倍","content":"blocks|key|1379426|text|📷|type|atomic|depth|inlineStyleRanges|entityRanges|offset|length|data|1379428|性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战的难点。|unstyled|1379429|为何性能很重要？完备的功能需要用性能交换，安全性需要用性能交换，成本需要用性能交换，产品体验需要用性能交换，甚至系统弹性都需要性能交换。有了基础性能，就有了竞争力的资本；基础性能若有问题，举步维艰，想要干点啥都不容易，就像天生羸弱的身子板。|1379430|SRS虽然是单进程单线程模型，性能一直都很高，比如：|1379431|•单进程能跑满千兆或万兆网卡，一般的场景完全能覆盖。•性能是NginxRTMP或Janus的三倍左右，目前还没有更高性能的开源同类产品。•提供集群能力，水平扩展性能，在开源项目中也不多见。|1379432|这并不是终点，这个性能基准只够5年左右，随着业务发展一定会有更高性能的需求。目前服务器属于第二代高并发架构，也就是单线程架构：|1379433|•第一代高并发架构，1990～2010年，多线程架构，一般比较老的服务器都是这种架构，一般无法解决C10K[1]问题，比如Adobe+AMS[2]，Apache+HTTP+Server[3]，Janus+WebRTC+Server[4]。核心问题是多线程的水平扩展性问题，并发越多，线程之间的同步和竞争开销就越大（这个问题也是现代语言Go在性能方面的硬伤，特别是在超多CPU比如64核或128核时，多线程的损耗会更大）。•第二代高并发架构，2010～2020年，单线程架构，多进程或单进程单线程都是这种架构，C10K问题得到比较好的解决，比如Nginx[5]，SRS[6]，MediaSoup[7]。核心问题是单线程引入的异步回调问题[8]，新的语言比如Go引入轻量线程goroutine（协程）解决这个问题，老的语言比如C%2B%2B20、JS+await等都有对应的机制。另外多进程的进程间通信也会引入额外复杂性，比如直播和RTC的流的跨进程回源和拉流问题。•第三代高并发架构，隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[9]，还有比Nginx更高性能的反向代理么，这就是Envoy[10]了，如下图所示。其实Envoy和Nginx都是事件驱动，但是Envoy是完全非阻塞[11]。而Envoy的多线程实际上和第一代的多线程也不同，线程之间几乎没有交互，可以看作是隔离的进程。由于是线程，所以它们之间的（少量）通信也很容易。同样，多线程也可以和轻量线程结合使用。|1379435|1379437|SRS目前还属于第二代架构，第三代架构验证过是可行的(#2188[12])，由于目前SRS性能还不是短板，所以没有合并到主干分支，有需要可以自己合并feature/threads[13]。目前SRS的性能数据如下：|1379438|SFUClientsCPUMemory线程VMSRS4000+players~94%25+x1419MB1G5+8CPUNginxRTMP2400+players~92%25+x1173MB1G5+8CPUSRS2300+publishers~89%25+x11.1GB1G5+8CPUNginxRTMP1300+publishers~84%25+x1198MB1G5+8CPU|table|aligns|1379212|align|left|1379213|1379214|1379215|1379216|1379217|rows|1379218|cells|1379219|raw|1379220|SFU|entityMap|1379221|1379222|Clients|1379223|1379224|CPU|1379225|1379226|Memory|1379227|1379228|线程|1379229|1379230|VM|1379231|1379232|1379233|SRS|1379234|1379235|4000+players|1379236|1379237|~94%25+x1|1379238|1379239|419MB|1379240|1379241|1|1379242|1379243|G5+8CPU|1379244|1379245|1379246|NginxRTMP|1379247|1379248|2400+players|1379249|1379250|~92%25+x1|1379251|1379252|173MB|1379253|1379254|1379255|1379256|G5+8CPU|1379257|1379258|1379259|1379260|1379261|2300+publishers|1379262|1379263|~89%25+x1|1379264|1379265|1.1GB|1379266|1379267|1379268|1379269|G5+8CPU|1379270|1379271|1379272|1379273|1379274|1300+publishers|1379275|1379276|~84%25+x1|1379277|1379278|198MB|1379279|1379280|1379281|1379282|G5+8CPU|1379439|SFUClientsCPUMemory线程VMSRS1000+players~90%25+x1180MB1G5+2CPUJanus700+players~93%25+x2430MB24G5+2CPUSRS950+publishers~92%25+x1132MB1G5+2CPUJanus350+publishers~93%25+x2405MB23G5+2CPU|1379283|1379284|1379285|1379286|1379287|1379288|1379289|1379290|1379291|1379292|1379293|1379294|1379295|1379296|1379297|1379298|1379299|1379300|1379301|1379302|1379303|1379304|1379305|1379306|1000+players|1379307|1379308|~90%25+x1|1379309|1379310|180MB|1379311|1379312|1379313|1379314|G5+2CPU|1379315|1379316|1379317|Janus|1379318|1379319|700+players|1379320|1379321|~93%25+x2|1379322|1379323|430MB|1379324|1379325|24|1379326|1379327|G5+2CPU|1379328|1379329|1379330|1379331|1379332|950+publishers|1379333|1379334|~92%25+x1|1379335|1379336|132MB|1379337|1379338|1379339|1379340|G5+2CPU|1379341|1379342|1379343|1379344|1379345|350+publishers|1379346|1379347|~93%25+x2|1379348|1379349|405MB|1379350|1379351|23|1379352|1379353|G5+2CPU|1379440|Note:+CentOS7,+600Kbps, ECS/G5-2.5GHZ(SkyLake)[14], SRS/v4.0.105[15], NginxRTMP/v1.2.1[16]。虽然系统有8CPU但只能使用单个CPU，选择8CPU是因为只有8CPU的内网带宽才能到10Gbps。|blockquote|1379441|当我们提到性能，一般隐含条件是“满足业务场景的体验”下的性能优化，比如直播要求卡顿率低、延迟在3秒之内，比如WebRTC要求端到端延迟400ms之内（服务器0延迟），一般现在服务器的内存可以是4GB、8GB、16GB、32GB或64GB，这意味着我们可以尽量用内存Cache来降低CPU运算。|style|BOLD|1379442|SRSProtocolVP6H.264VP6%2BMP3H.264%2BMP32.0.72RTMP0.1s0.4s0.8s0.6s2.0.70RTMP0.1s0.4s1.0s0.9s1.0.10RTMP0.4s0.4s0.9s1.2s4.0.87WebRTCx80msxx|1379354|1379355|1379356|1379357|1379358|1379359|1379360|1379361|1379362|1379363|1379364|Protocol|1379365|1379366|VP6|1379367|1379368|H.264|1379369|1379370|VP6%2BMP3|1379371|1379372|H.264%2BMP3|1379373|1379374|1379375|2.0.72|1379376|1379377|RTMP|1379378|1379379|0.1s|1379380|1379381|0.4s|1379382|1379383|0.8s|1379384|1379385|0.6s|1379386|1379387|1379388|2.0.70|1379389|1379390|1379391|1379392|1379393|1379394|1379395|1379396|1.0s|1379397|1379398|0.9s|1379399|1379400|1379401|1.0.10|1379402|1379403|1379404|1379405|1379406|1379407|1379408|1379409|1379410|1379411|1.2s|1379412|1379413|1379414|4.0.87|1379415|1379416|WebRTC|1379417|1379418|x|1379419|1379420|80ms|1379421|1379422|1379423|1379424|1379443|Note:+在音视频服务器的性能优化中，延迟是必须要考虑的一个因素，特别是在RTC服务器，性能优化不能以增大延迟为方法。|1379444|性能基准|header-two|1379445|如果没有压测能力，就无法优化性能。|1379446|SRS的基准是并发流，比如使用srs-bench[17]推流可以获得支持的最高推流（发布）并发，和最高拉流（播放）并发。压测工具一般读取文件，可以选择典型的业务场景，录制成样本文件，这样压测可以尽量模拟线上场景。|1379447|性能优化前，必须使用压测获得目前的性能基准，分析目前的性能瓶颈和优化思路，然后修改代码获得新的性能基准，如此反复不断提升性能。如下图所示：|1379449|1379451|上图就是性能分析的主面板，左三右二加一个浏览器：|1379452|•左上：服务器的top图，命令是 top+-H+-p+$(cat+objs/srs.pid) ，看CPU和内存。还有每个CPU的消耗情况（进入top后按数字1），比如us是用户空间函数，sy是内核函数，si是网卡软中断。•左中：系统的网络带宽图，命令是 dstat ，看出入口带宽。比如视频平均码率是600kbps，那么900个推流时，网卡的recv流量应该是600*900/8000.0KBps也就是67.5MBps，如果网卡吞吐率达不到预期，那么肯定会出现卡顿等问题，比如可能是系统的网卡队列缓冲区[18]太小导致丢包。•左下：服务器关键日志，命令是 tail+-f+objs/srs.log+%7Cgrep+-e+'RTC:+Server'+-e+Hybrid ，查看RTC的连接数和关键日志，以及进程的CPU等信息。如果连接数达不到预期，或者CPU接近100%25，也是有问题的。•右上：服务器热点函数列表，命令是 perf+top+-p+$(cat+objs/srs.pid) ，可以看到当前主要的热点函数列表，以及每个函数所占用的百分比。性能优化一般的思路，就是根据这个表，优化掉排名在前面的热点函数。•右下：压测客户端的top图，如果压测服务器的CPU满载，也一样达不到预期，会出现卡顿等情况。同样也需要先检查系统的网卡队列缓冲区[19]，避免系统丢包。•浏览器：在浏览器中播放流，比如webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13[20]，可以通过eip指定外网ip，这样压测工具可以推内网地址，而浏览器观看可以看外网的地址。浏览器观看可以随机抽查某个流，判断是否播放流畅，声音和画面是否正常等。|CODE|1379453|Note:+我们在左上的图中，截图时加上了标注，可以更快的看出这个性能图的摘要，比如ECS/C5+2CPU说明是ECS的C5机型一共是2个CPU，900+publish+streams是RTC推流一共900个并发流。|1379454|工具链|1379455|没有工具链就无法做性能优化，前一章我们分享了压测工具srs-bench[21]，查看网络带宽工具dstat，查看热点函数工具perf，查看CPU工具top。|1379456|还有一些工具链，总结在SRS性能(CPU)、内存优化工具用法[22]，我们挑一些和性能优化相关的工具重点介绍。包括：|1379457|•sysctl：修改内核UDP缓冲区，防止内核丢包。•GPERF:+GCP：使用GCP分析热点函数的调用链，图形化展示。•taskset：进程绑核后，避免软中断干扰，便于查看数据。|1379458|对于RTC，很重要的是需要把内核协议栈的缓冲区改大，默认只有200KB，必须改成16MB以上，否则会导致丢包：|1379460|sysctl+net.core.rmem_max=16777216\nsysctl+net.core.rmem_default=16777216\nsysctl+net.core.wmem_max=16777216\nsysctl+net.core.wmem_default=16777216|code-block|syntax|javascript|1379462|可以直接修改文件/etc/sysctl.conf，重启也能生效：|1379464|#+vi+/etc/sysctl.conf\nnet.core.rmem_max=16777216\nnet.core.rmem_default=16777216\nnet.core.wmem_max=16777216\nnet.core.wmem_default=16777216|1379466|如果perf热点函数比较通用，比如是malloc，那我们可能需要分析调用链路，看是哪个执行分支导致malloc热点，由于SRS使用的协程，perf无法正确获取堆栈，我们可以用GPERF:+GCP工具：|1379468|#+Build+SRS+with+GCP\n./configure+--with-gperf+--with-gcp+&&+make\n\n#+Start+SRS+with+GCP\n./objs/srs+-c+conf/console.conf\n\n#+Or+CTRL%2BC+to+stop+GCP\nkillall+-2+srs\n\n#+To+analysis+cpu+profile\n./objs/pprof+--text+objs/srs+gperf.srs.gcp*|1379470|图形化展示时，需要安装依赖graphviz：|1379472|yum+install+-y+graphviz|1379474|然后就可以生成SVG图，用浏览器打开就可以看了：|1379476|./objs/pprof+--svg+./objs/srs+gperf.srs.gcp+\u003Et.svg|1379479|1379481|还可以使用taskset绑定进程到某个核，这样避免在不同的核跳动，和软中断跑在一个核后干扰性能，比如一般软中断会在CPU0，我们绑定SRS到CPU1：|1379483|taskset+-pc+1+$(cat+objs/srs.pid)|1379485|Note：如果是多线程模式，可以增加参数-a绑定所有线程到某个核，或者在配置文件中，配置cpu_affinity指定线程的核。|1379486|内存交换性能|1379487|现代服务器的内存都很大，平均每个核有2GB内存，比如：|1379488|•ECS+ecs.c5.large[23],+2CPU+4GB+内存，1Gbps内网带宽。•ECS+ecs.c5.xlarge[24],+4CPU+8GB+内存，1.5Gbps内网带宽。•ECS+ecs.c5.2xlarge[25],+8CPU+16GB+内存，2.5Gbps内网带宽。|1379489|还有其他型号的，比如G5[26]每个核是4GB内存，比如R5[27]更是每个核高达8GB内存。这么多内存，对于无磁盘缓存型的网络服务器，直播转发或者SFU转发，一般内存是用不了这么多的，收包然后转发，几乎不需要缓存很久的数据。|1379490|因此，线上的视频服务器一般内存都是很充足的，有些情况下可以用内存来优化性能的地方，就可以果断的上内存缓存（Cache）策略。|1379491|比如，在直播播放时，SRS有个配置项叫合并写入（发送）：|1379493|vhost+__defaultVhost__+{\n++++play+{\n++++++++#+Set+the+MW(merged-write)+min+messages.\n++++++++#+default:+0+(For+Real-Time,+min_latency+on)\n++++++++#+default:+1+(For+WebRTC,+min_latency+off)\n++++++++#+default:+8+(For+RTMP/HTTP-FLV,+min_latency+off).\n++++++++mw_msgs+++++++++8;\n++++}\n}|1379495|如果是非低延迟（默认）模式是8，也就是收到了8个音视频包后，才会转发给播放器。关键代码如下：|1379497|srs_error_t+SrsRtmpConn::do_playing(SrsLiveSource*+source,+SrsLiveConsumer*+consumer,+SrsQueueRecvThread*+rtrd)\n{\n++++mw_msgs+=+_srs_config-\u003Eget_mw_msgs(req-\u003Evhost,+realtime);\n++++mw_sleep+=+_srs_config-\u003Eget_mw_sleep(req-\u003Evhost);\n\n++++while+(true)+{\n++++++++consumer-\u003Ewait(mw_msgs,+mw_sleep);\n\n++++++++if+((err+=+consumer-\u003Edump_packets(&msgs,+count))+!=+srs_success)+{\n++++++++++++return+srs_error_wrap(err,+\"rtmp:+consumer+dump+packets\");\n++++++++}\n\n++++++++if+(count+\u003E+0+&&+(err+=+rtmp-\u003Esend_and_free_messages(msgs.msgs,+count,+info-\u003Eres-\u003Estream_id))+!=+srs_success)+{\n++++++++++++return+srs_error_wrap(err,+\"rtmp:+send+%25d+messages\",+count);\n++++++++}|1379499|如果是25fps，那么8个包大约是在320ms，考虑音频包大约是160ms延迟，这个队列的额外延迟在直播中也是可以接受的。|1379500|如果是8个包一次发送，按照平均码率1Mbps，差不多是300Mb也就是40KB的数据。如果按照峰值5Mbps码率计算，那就是一次发送200KB的数据。我们可以用writev一次发送这些数据，就可以极大的提高分发的性能了。|1379501|每个连接我们需要的内存按照1MB来计算，那么4000个连接需要4GB内存。如果是7000个连接，需要7GB的内存。可以认为直播分发的性能优化，是典型的内存（加少量延迟）来换更低的CPU使用。|1379502|Note:+当然服务器引入额外的160ms延迟对于RTC场景就是不可以接受的，只能在直播中使用这种优化。|1379503|Note:+RTC的UDP发送是否能使用类似的优化？我们调研过UDP/sendmmsg[28]和UDP/GSO[29]是可以提升一部分，但是由于UDP每个连接可合并发送的数据很少，目前压测分析热点也不在这里，所以优化有限，目前SRS并没有做这两个优化。|1379504|查找优化|1379505|STL的vector和map的查找算法，已经优化得很好了，实际上还是会成为性能瓶颈。|1379506|比如，RTC由于实现了端口复用，需要根据每个UDP包的五元组（或其他信息），查找到对应的Session处理包；Session需要根据SSRC找到对应的track，让track处理这个包。|1379507|比如，SRS的日志是可追溯的，打印时会打印出上下文ID，可以将多个会话的日志分离。这个Context+ID是存储在全局的map中的，每次切换上下文需要根据协程ID查找出对应的上下文ID。|1379508|如果每个包都需要这么运算一次，那开销也是相当可观的。考虑根据UDP包查找Session，如下图：|1379510|int+SrsUdpMuxSocket::recvfrom(srs_utime_t+timeout)\n{\n++++nread+=+srs_recvfrom(lfd,+buf,+nb_buf,+(sockaddr*)&from,+&fromlen,+timeout);\n++++getnameinfo((sockaddr*)&from,+fromlen,++(char*)&address_string,+64,+(char*)&port_string\n++++peer_ip+=+std::string(address_string);\n++++peer_port+=+atoi(port_string);+\n\nsrs_error_t+SrsUdpMuxListener::cycle()\n{\n++++while+(true)+{\n++++++++SrsUdpMuxSocket+skt(lfd);\n++++++++int+nread+=+skt.recvfrom(SRS_UTIME_NO_TIMEOUT);\n++++++++err+=+handler-\u003Eon_udp_packet(&skt);\n\nsrs_error_t+SrsRtcServer::on_udp_packet(SrsUdpMuxSocket*+skt)\n{\n++++string+peer_id+=+skt-\u003Epeer_id();\n++++ISrsResource*+conn+=+_srs_rtc_manager-\u003Efind_by_id(peer_id);\n++++session+=+dynamic_cast\u003CSrsRtcConnection*\u003E(conn);\n\nISrsResource*+SrsResourceManager::find_by_id(std::string+id)\n{\n++++map\u003Cstring,+ISrsResource*\u003E::iterator+it+=+conns_id_.find(id);\n++++return+(it+!=+conns_id_.end())?+it-\u003Esecond+:+NULL;\n}|1379512|这个逻辑有几个地方会有热点，通过压测可以在perf上看到：|1379513|•每个UDP包都调用getnameinfo将sockaddr转成字符串的ip:port，也就是地址标识，会有大量的string开辟和释放。•每个UDP包都需要根据ip:port，在map中查找出对应的Session（Resource或Conneciton），字符串查找的速度是很慢的。|1379514|改进其实也容易，查找时不转成string，而是生成uint64_t的地址，目前支持的是IPv4地址只需要6字节就可以表达ip:port（如果是IPv6则需要两个uint64_t），如下所示：|1379516|int+SrsUdpMuxSocket::recvfrom(srs_utime_t+timeout)\n{\n++++nread+=+srs_recvfrom(lfd,+buf,+nb_buf,+(sockaddr*)&from,+&fromlen,+timeout);\n++++sockaddr_in*+addr+=+(sockaddr_in*)&from;\n++++fast_id_+=+uint64_t(addr-\u003Esin_port)\u003C\u003C48+%7C+uint64_t(addr-\u003Esin_addr.s_addr);\n\nsrs_error_t+SrsRtcServer::on_udp_packet(SrsUdpMuxSocket*+skt)\n{\n++++uint64_t+fast_id+=+skt-\u003Efast_id();\n++++session+=+(SrsRtcConnection*)_srs_rtc_manager-\u003Efind_by_fast_id(fast_id);|1379518|虽然解决了string查找的热点，随着并发的提升，map\u003Ckey:+uint64_t\u003E的查找也变成了热点，在perf上可以看到map的不断平衡，我们还可以改成vector查找：|1379520|ISrsResource*+SrsResourceManager::find_by_fast_id(uint64_t+id)\n{\n++++SrsResourceFastIdItem*+item+=+&conns_level0_cache_[(id+%7C+id\u003E\u003E32)+%25+nn_level0_cache_];\n++++if+(item-\u003Eavailable+&&+item-\u003Efast_id+==+id)+{\n++++++++return+item-\u003Eimpl;\n++++}\n\n++++map\u003Cuint64_t,+ISrsResource*\u003E::iterator+it+=+conns_fast_id_.find(id);\n++++return+(it+!=+conns_fast_id_.end())?+it-\u003Esecond+:+NULL;\n}|1379522|Note:+首先我们在vector中取余查找，如果取余碰撞了（两个不同id但是取余后一样，比如1001%251000和2001%251000是一样的），那么就用map查找。|1379523|通过不同的查找方式，string变uint64_t优化了查找速度，而更快的优化是不用map查找，直接使用数组取余就是无查找了。|1379524|当然，这样的优化，让逻辑变得复杂了。|1379525|无代码优化|1379526|当我们优化完明显的热点，优化完头部热点，会发现perf显示已经没有明显的热点，有时候有些不太明显的函数也会排在前头，比如拷贝RTP+Packet：|1379528|SrsRtpPacket*+SrsRtpPacket::copy()\n{\n++++SrsRtpPacket*+cp+=+new+SrsRtpPacket();\n\n++++cp-\u003Eheader+=+header;\n++++cp-\u003Epayload_+=+payload_?+payload_-\u003Ecopy():NULL;\n++++cp-\u003Epayload_type_+=+payload_type_;\n\n++++cp-\u003Enalu_type+=+nalu_type;\n++++cp-\u003Eshared_buffer_+=+shared_buffer_?+shared_buffer_-\u003Ecopy2()+:+NULL;\n++++cp-\u003Eactual_buffer_size_+=+actual_buffer_size_;\n++++cp-\u003Eframe_type+=+frame_type;\n\n++++cp-\u003Ecached_payload_size+=+cached_payload_size;\n++++//+For+performance+issue,+do+not+copy+the+unused+field.\n++++cp-\u003Edecode_handler+=+decode_handler;\n\n++++return+cp;\n}|1379530|这个函数有啥可以优化的么？没有什么可以优化的，全都是赋值和拷贝（无深拷贝），但是在perf上它就是排名在前头。|1379531|Note:+这时候千万别怀疑perf有问题，确实热点是这个拷贝是没有错的，perf不会出错，perf不会出错，perf不会出错，千万不要把焦点挪开去优化其他函数。|1379532|并不是函数性能高，就不会成为瓶颈，有个公式如下：|1379534|性能热点+=+函数执行效率+x+函数执行次数|1379536|一般我们会优先优化函数执行效率，让函数更高效。但是我们也不能忽略了函数的执行次数，如果一个高效的函数被反复的执行，一样也会变成性能热点。这时候我们的优化思路就是：如何让代码不执行，或明显减少执行次数。|1379537|通过分析可以发现，这个SrsRtpPacket::copy调用点有：|1379538|•从Publisher拷贝到每个Consumer，函数是SrsRtcSource::on_rtp。•包发送后，放到Track的NACK队列，函数是SrsRtcRecvTrack::on_nack和SrsRtcSendTrack::on_nack。|1379539|上面第二个拷贝可以省略，由于每个Player都有NACK，所以可以减少一倍的调用，优化后这个热点也就不排在前头了：|1379541|srs_error_t+SrsRtcRecvTrack::on_nack(SrsRtpPacket**+ppkt)\n{\n++++rtp_queue_-\u003Eset(seq,+pkt);\n++++*ppkt+=+NULL;|1379543|同样的，这个优化的代价就是增加了风险，参数也从指针，变成了指针的指针，一路都改成了指针的指针，可以犯错的概率就大太多了。|1379544|UDP协议栈|1379545|在直播优化中，我们使用writev一次写入大量的数据，大幅提高了播放的性能。|1379546|其实UDP也有类似的函数，UDP的sendto对应TCP的write，UDP的sendmmsg对应TCP的writev，我们调研过UDP/sendmmsg[30]是可以提升一部分性能，不过它的前提是：|1379547|•在Perf中必须看到UDP的相关函数成为热点，如果有其他的热点比UDP更耗性能，那么上sendmmsg也不会有改善。•一般并发要到2000以上，UDP协议栈才可能出现在perf的热点，较低并发时收发的包，还不足以让UDP的函数成为热点。•由于不能增加延迟，需要改发送结构，集中发给多个地址的UDP包统一发送。这对可维护性上是比较大的影响。|1379548|还有一种优化是GSO，延迟分包。我们调研过UDP/GSO[31]，比sendmmsg提升还要大一些，它的前提是：|1379549|•和sendmmsg一样，只有当UDP相关函数成为perf的热点，优化才有效。•GSO只能对一个客户端的包延迟组包，所以他的作用取决于要发给某个客户端的包数目，由于RTC的实时性要求，一般2到3个比较常见。|1379551|1379553|Note:+从上图可见，开启Padding后，UDP组包效能可以提升10%25左右。GSO虽然不能减少实际网络上UDP包的数目，但是可以让内核延迟到最后才组UDP包，可以把GSO发送的多个包认为是一个包，相当于减少了发送UDP包的次数。|1379554|还有一种优化的可能，就是ZERO_COPY，其实TCP的零拷贝支持得比较早，但是UDP的支持得比较晚一些。收发数据时，需要从用户空间到内核空间不断拷贝，不过之前测试没有明显收益，参考ZERO-COPY[32]。|1379555|多线程|1379556|文章开头我们提到，第三代高并发架构，将是隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[33]。|1379557|我们也调研过SRS可能的多线程架构，参考#2188[34]。和Envoy不同，SRS涉及到了TCP和UDP，API和媒体服务，级联和QoS等问题，可能的架构也比较多。|1379558|SRS+1/2/3/4一直都是单线程（第二代架构），如下图所示：|1379560|1379562|Note：这个架构的风险一直都存在，写磁盘可能是阻塞的，DNS解析可能是阻塞的，RTC无法使用多CPU的能力（直播可以用集群或REUSE_PORT扩展多核能力）。|1379563|很显然，写磁盘应该由单独线程完成，可以避免阻塞，这就是SRS+5.0使用的架构：|1379565|1379567|Note:+其实DVR和HLS也是写磁盘操作，未来也会由写磁盘的线程实现，目前还没有实现。|1379568|Note:+DNS解析也是阻塞的，和写磁盘不同，DNS解析本质上是UDP请求，是可以自己实现协议解析，不需要用多线程做。|1379569|针对RTC的多核扩展能力，有一种很自然（也是改动较小）的思路，就是将更多的能力拆分到线程中。比如SRTP加解密，占用了30%25的CPU，如果能拆分到独立线程肯定对并发能力有提升。比如UDP收发也可以放到独立线程，也可以避免内核UDP收发效率不高的问题。如下图所示：|1379571|1379573|Note:+这个架构是被标记为废弃，原因就是SRTP和UDP确实效率不高，但是Hybrid里面的QoS算法是瓶颈所在，而这部分不方便拆分多线程。|1379574|Note:+另外，就算QoS拆分成多线程，这个架构最多用到大约3～4CPU，并不能用到32或64核CPU，也就是并发能力还是受限。|1379575|Note:+最后，这种多线程架构，线程之间交互较多，所以会有锁的开销，也不算第三代服务器架构。|1379576|最终的多线程架构，是能水平扩展的多线程架构，实现的原型参考feature/threads[35]分支，如下图所示：|1379578|1379580|Note:+我们实现的一个版本是多端口模型，通过端口分割不同的Hybrid线程，Hybrid线程之间独立不需要交互。实际上多线程之间也是可以复用同样端口的，只是切网时需要考虑新五元组的绑定。|1379581|Note:+这个架构完全解决了水平扩展的问题，也避免了线程之间需要交互数据，压测在32核C5机器上，能跑到10K左右并发（可以在更多核的机器上扩展）。|1379582|当然，最后这个架构也并非没有问题，目前看还需要解决以下问题，才能在线上使用：|1379583|•API必须非常简单，如果是Janus那种复杂的API，就无法使用这种结构。SRS目前的API是比较合适实现这种架构。API实际上承担了调度的能力。•直播需要改进，适配这种多线程结构。直播Edge相对比较容易改造，可以用REUSE_PORT，相当于多个进程。而直播Origin改造比较麻烦。•统计和API需要改造，系统的CPU使用率，告警和水位统计，限流策略，都会因为多线程有所不同。比如在线人数，需要汇总每个线程的连接数。•全局变量和局部静态变量，必须仔细Check，保障是线程安全(thread-safe)，或者是线程局部(thread-local)，虽然我们在原型中已经改造得差不多，但还是需要更多确认。|1379584|由于多线程本质上和集群的能力是有一部分重合的，只是多线程的效率更高。比如直播其实可以用多个Edge部署在一台机器上（Edge后面挂一堆Edge），实现多核的扩展。RTC如果实现了级联，也一样是可以扩展多核能力，比如单核支持800个并发，每个SRS跑在一个Pod中，也可以用级联扩展能力（当然会造成进程之间的带宽比多线程要高，多线程是不走带宽）。|1379585|硬件加速|1379586|SRS没有使用硬件加速，但这个是一个很不错的思路，包括：|1379587|•CPU指令集优化：加解密和编解码的算法，有些可以用到CPU的特殊指令，增加批处理的能力，比如AVX512[36]。•专用加解密硬件卡，加解密是比较通用的算法，有专门硬件，可以调研看看。•UDP收发优化，不经过内核协议栈，直接从用户空间和网卡交互：DPDK[37]。|1379588|总结|1379589|性能优化，是全面的和持续的工程能力，涉及到了对系统的理解、对业务的认知、对编程语言的熟悉、对硬件和软件框架的挖掘、性能分析工具链的使用，心肝脾肺肾只有全面提升，最终才能获得性能的提升。|1379590|References|header-three|1379591|[1] C10K: http://www.kegel.com/c10k.html\n[2] Adobe+AMS: https://helpx.adobe.com/adobe-media-server/tech-overview/introduction-ams.html\n[3] Apache+HTTP+Server: https://httpd.apache.org/\n[4] Janus+WebRTC+Server: https://github.com/meetecho/janus-gateway\n[5] Nginx: https://nginx.org/\n[6] SRS: https://github.com/ossrs/srs\n[7] MediaSoup: https://github.com/versatica/mediasoup\n[8] 异步回调问题: http://callbackhell.com/\n[9] Envoy线程模型: https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310\n[10] Envoy: https://www.loggly.com/blog/benchmarking-5-popular-load-balancers-nginx-haproxy-envoy-traefik-and-alb/\n[11] 完全非阻塞: https://dropbox.tech/infrastructure/how-we-migrated-dropbox-from-nginx-to-envoy\n[12] #2188: https://github.com/ossrs/srs/issues/2188\n[13] feature/threads: https://github.com/winlinvip/srs/tree/feature/threads\n[14] ECS/G5-2.5GHZ(SkyLake): https://help.aliyun.com/document_detail/25378.html\n[15] SRS/v4.0.105: https://github.com/ossrs/srs/commit/2ad24b2313e88a85801deaea370204f225555939\n[16] NginxRTMP/v1.2.1: https://github.com/arut/nginx-rtmp-module/releases/tag/v1.2.1\n[17] srs-bench: https://github.com/ossrs/srs-bench/tree/feature/rtc#usage\n[18] 网卡队列缓冲区: https://www.jianshu.com/p/6d4a89359352\n[19] 网卡队列缓冲区: https://www.jianshu.com/p/6d4a89359352\n[20] webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13: http://localhost/players/rtc_player.html?autostart=true&api=1985&eip=8.126.115.13&server=8.126.115.13&vhost=8.126.115.13&stream=livestream100\n[21] srs-bench: https://github.com/ossrs/srs-bench/tree/feature/rtc#usage\n[22] SRS性能(CPU)、内存优化工具用法: https://www.jianshu.com/p/6d4a89359352\n[23] ECS+ecs.c5.large: https://help.aliyun.com/document_detail/25378.html#c5\n[24] ECS+ecs.c5.xlarge: https://help.aliyun.com/document_detail/25378.html#c5\n[25] ECS+ecs.c5.2xlarge: https://help.aliyun.com/document_detail/25378.html#c5\n[26] G5: https://help.aliyun.com/document_detail/25378.html#g5\n[27] R5: https://help.aliyun.com/document_detail/25378.html#r5\n[28] UDP/sendmmsg: https://github.com/ossrs/srs/issues/307#issuecomment-609020985\n[29] UDP/GSO: https://github.com/ossrs/srs/issues/307#issuecomment-612953502\n[30] UDP/sendmmsg: https://github.com/ossrs/srs/issues/307#issuecomment-609020985\n[31] UDP/GSO: https://github.com/ossrs/srs/issues/307#issuecomment-612953502\n[32] ZERO-COPY: https://github.com/ossrs/srs/issues/307#issuecomment-615884074\n[33] Envoy线程模型: https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310\n[34] #2188: https://github.com/ossrs/srs/issues/2188\n[35] feature/threads: https://github.com/winlinvip/srs/tree/feature/threads\n[36] AVX512: https://zhuanlan.zhihu.com/p/83399457\n[37] DPDK: https://www.dpdk.org/|ITALIC|IMAGE|mutability|IMMUTABLE|imageUrl|https://ask.qcloudimg.com/http-save/8722662/64de5c86c154afa7dda1880494189bc4.png|imageAlt|https://ask.qcloudimg.com/http-save/8722662/bc60db00c82d9b63b2cb3a4b96222eb9.jpeg|https://ask.qcloudimg.com/http-save/8722662/f384f7c60b4839f8529094462fb66cb8.jpeg|https://ask.qcloudimg.com/http-save/8722662/0f44a5cdb994e379898ed61534af6e5c.jpeg|https://ask.qcloudimg.com/http-save/8722662/b096a1900bdf04179aba2152ee831fbe.png|https://ask.qcloudimg.com/http-save/8722662/e4018665c7ca57220560ff6b4295e89a.png|LINK|MUTABLE|url|https://mp.weixin.qq.com/s?__biz=MzA4NTQ3MzQ5OA==&mid=2649003831&idx=1&sn=6626766960d3edd930af0eef5321e416&scene=21#wechat_redirect|https://ask.qcloudimg.com/http-save/8722662/9cf41b6aad1303bd0310ee18c9516817.png|https://ask.qcloudimg.com/http-save/8722662/e9037161161b0c73a50180f56d400780.png|https://ask.qcloudimg.com/http-save/8722662/0ce825559c0265e733eb2ffa23fc3f9f.png^0|0|1|0|0|0|0|0|0|0|0|0|1|1|0|0|0|0|0|G|9|0|0|0|0|0|7|3|0|0|0|1|2|0|0|H|T|3J|5|50|I|5L|8|7Q|1H|BC|V|0|16|B|21|J|0|0|1C|5|1Q|4|22|3|0|0|1|6|R|A|1P|7|0|0|0|8|G|0|0|I|6|1D|6|1X|4|2F|A|0|0|D|8|0|0|0|0|0|1|3|0|5|7|0|0|K|2|18|C|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|A|B|10|7|29|7|0|1O|7|0|0|P|I|0|0|0|0|0|0|0|0|0|0|0|0|29|I|0|B|I|0|S|K|21|O|2Q|O|0|0|0|0|0|B|6|0|H|6|T|5|13|8|1H|6|0|0|Y|8|0|2|8|0|0|1|4|0|0|0|0|0|0|0|0|1|5|0|1O|J|6|0|0|0|1|7|0|0|0|0|0|1|8|0|F|2|0|0|0|0|0|1|9|0|0|0|0|0|0|0|0|0|0|0|0|A|0|0|3|15|3|3R|3|55|3|70|3|7U|3|8W|3|AE|3|BF|3|DK|4|GR|4|JB|4|KS|4|MW|4|P4|4|RS|4|U5|4|W7|4|XO|4|Z5|4|150|4|172|4|18V|4|1B0|4|1D6|4|1FD|4|1H4|4|1IV|4|1L5|4|1NA|4|1PK|4|1RP|4|1TW|4|1W2|4|1XJ|4|1ZN|4|212|4|A|U|1K|26|4F|P|5U|15|7B|I|83|S|9B|12|AQ|O|BU|1P|DW|2U|H3|27|JN|14|LE|1H|NP|1E|PN|24|SF|1P|UL|1L|WL|12|Y2|12|112|3X|15G|1L|17S|12|19I|1H|1BO|1H|1DV|1H|1FM|1H|1HD|1H|1JE|1Q|1LJ|1Q|1NT|1Q|1PY|1Q|1S5|1Q|1UC|1P|1WE|14|1Y5|1H|200|11|21D|L^^$0|@$1|2|3|4|5|6|7|FJ|8|@]|9|@$A|FK|B|FL|1|FM]]|C|@]]|$1|D|3|E|5|F|7|FN|8|@]|9|@]|C|@]]|$1|G|3|H|5|F|7|FO|8|@]|9|@]|C|@]]|$1|I|3|J|5|F|7|FP|8|@]|9|@]|C|@]]|$1|K|3|L|5|F|7|FQ|8|@]|9|@]|C|@]]|$1|M|3|N|5|F|7|FR|8|@]|9|@]|C|@]]|$1|O|3|P|5|F|7|FS|8|@]|9|@]|C|@]]|$1|Q|3|4|5|6|7|FT|8|@]|9|@$A|FU|B|FV|1|FW]]|C|@]]|$1|R|3|S|5|F|7|FX|8|@]|9|@]|C|@]]|$1|T|3|U|5|V|7|FY|8|@]|9|@]|C|$W|@$1|X|Y|Z]|$1|10|Y|Z]|$1|11|Y|Z]|$1|12|Y|Z]|$1|13|Y|Z]|$1|14|Y|Z]]|15|@$1|16|17|@$1|18|19|$0|@$1|1A|5|F|3|1B|8|@]|9|@]]]|1C|@]]]|$1|1D|19|$0|@$1|1E|5|F|3|1F|8|@]|9|@]]]|1C|@]]]|$1|1G|19|$0|@$1|1H|5|F|3|1I|8|@]|9|@]]]|1C|@]]]|$1|1J|19|$0|@$1|1K|5|F|3|1L|8|@]|9|@]]]|1C|@]]]|$1|1M|19|$0|@$1|1N|5|F|3|1O|8|@]|9|@]]]|1C|@]]]|$1|1P|19|$0|@$1|1Q|5|F|3|1R|8|@]|9|@]]]|1C|@]]]]]|$1|1S|17|@$1|1T|19|$0|@$1|1U|5|F|3|1V|8|@]|9|@]]]|1C|@]]]|$1|1W|19|$0|@$1|1X|5|F|3|1Y|8|@]|9|@]]]|1C|@]]]|$1|1Z|19|$0|@$1|20|5|F|3|21|8|@]|9|@]]]|1C|@]]]|$1|22|19|$0|@$1|23|5|F|3|24|8|@]|9|@]]]|1C|@]]]|$1|25|19|$0|@$1|26|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|28|19|$0|@$1|29|5|F|3|2A|8|@]|9|@]]]|1C|@]]]]]|$1|2B|17|@$1|2C|19|$0|@$1|2D|5|F|3|2E|8|@]|9|@]]]|1C|@]]]|$1|2F|19|$0|@$1|2G|5|F|3|2H|8|@]|9|@]]]|1C|@]]]|$1|2I|19|$0|@$1|2J|5|F|3|2K|8|@]|9|@]]]|1C|@]]]|$1|2L|19|$0|@$1|2M|5|F|3|2N|8|@]|9|@]]]|1C|@]]]|$1|2O|19|$0|@$1|2P|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|2Q|19|$0|@$1|2R|5|F|3|2S|8|@]|9|@]]]|1C|@]]]]]|$1|2T|17|@$1|2U|19|$0|@$1|2V|5|F|3|1V|8|@]|9|@]]]|1C|@]]]|$1|2W|19|$0|@$1|2X|5|F|3|2Y|8|@]|9|@]]]|1C|@]]]|$1|2Z|19|$0|@$1|30|5|F|3|31|8|@]|9|@]]]|1C|@]]]|$1|32|19|$0|@$1|33|5|F|3|34|8|@]|9|@]]]|1C|@]]]|$1|35|19|$0|@$1|36|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|37|19|$0|@$1|38|5|F|3|39|8|@]|9|@]]]|1C|@]]]]]|$1|3A|17|@$1|3B|19|$0|@$1|3C|5|F|3|2E|8|@]|9|@]]]|1C|@]]]|$1|3D|19|$0|@$1|3E|5|F|3|3F|8|@]|9|@]]]|1C|@]]]|$1|3G|19|$0|@$1|3H|5|F|3|3I|8|@]|9|@]]]|1C|@]]]|$1|3J|19|$0|@$1|3K|5|F|3|3L|8|@]|9|@]]]|1C|@]]]|$1|3M|19|$0|@$1|3N|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|3O|19|$0|@$1|3P|5|F|3|3Q|8|@]|9|@]]]|1C|@]]]]]]]]|$1|3R|3|3S|5|V|7|FZ|8|@]|9|@]|C|$W|@$1|3T|Y|Z]|$1|3U|Y|Z]|$1|3V|Y|Z]|$1|3W|Y|Z]|$1|3X|Y|Z]|$1|3Y|Y|Z]]|15|@$1|3Z|17|@$1|40|19|$0|@$1|41|5|F|3|1B|8|@]|9|@]]]|1C|@]]]|$1|42|19|$0|@$1|43|5|F|3|1F|8|@]|9|@]]]|1C|@]]]|$1|44|19|$0|@$1|45|5|F|3|1I|8|@]|9|@]]]|1C|@]]]|$1|46|19|$0|@$1|47|5|F|3|1L|8|@]|9|@]]]|1C|@]]]|$1|48|19|$0|@$1|49|5|F|3|1O|8|@]|9|@]]]|1C|@]]]|$1|4A|19|$0|@$1|4B|5|F|3|1R|8|@]|9|@]]]|1C|@]]]]]|$1|4C|17|@$1|4D|19|$0|@$1|4E|5|F|3|1V|8|@]|9|@]]]|1C|@]]]|$1|4F|19|$0|@$1|4G|5|F|3|4H|8|@]|9|@]]]|1C|@]]]|$1|4I|19|$0|@$1|4J|5|F|3|4K|8|@]|9|@]]]|1C|@]]]|$1|4L|19|$0|@$1|4M|5|F|3|4N|8|@]|9|@]]]|1C|@]]]|$1|4O|19|$0|@$1|4P|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|4Q|19|$0|@$1|4R|5|F|3|4S|8|@]|9|@]]]|1C|@]]]]]|$1|4T|17|@$1|4U|19|$0|@$1|4V|5|F|3|4W|8|@]|9|@]]]|1C|@]]]|$1|4X|19|$0|@$1|4Y|5|F|3|4Z|8|@]|9|@]]]|1C|@]]]|$1|50|19|$0|@$1|51|5|F|3|52|8|@]|9|@]]]|1C|@]]]|$1|53|19|$0|@$1|54|5|F|3|55|8|@]|9|@]]]|1C|@]]]|$1|56|19|$0|@$1|57|5|F|3|58|8|@]|9|@]]]|1C|@]]]|$1|59|19|$0|@$1|5A|5|F|3|5B|8|@]|9|@]]]|1C|@]]]]]|$1|5C|17|@$1|5D|19|$0|@$1|5E|5|F|3|1V|8|@]|9|@]]]|1C|@]]]|$1|5F|19|$0|@$1|5G|5|F|3|5H|8|@]|9|@]]]|1C|@]]]|$1|5I|19|$0|@$1|5J|5|F|3|5K|8|@]|9|@]]]|1C|@]]]|$1|5L|19|$0|@$1|5M|5|F|3|5N|8|@]|9|@]]]|1C|@]]]|$1|5O|19|$0|@$1|5P|5|F|3|27|8|@]|9|@]]]|1C|@]]]|$1|5Q|19|$0|@$1|5R|5|F|3|5S|8|@]|9|@]]]|1C|@]]]]]|$1|5T|17|@$1|5U|19|$0|@$1|5V|5|F|3|4W|8|@]|9|@]]]|1C|@]]]|$1|5W|19|$0|@$1|5X|5|F|3|5Y|8|@]|9|@]]]|1C|@]]]|$1|5Z|19|$0|@$1|60|5|F|3|61|8|@]|9|@]]]|1C|@]]]|$1|62|19|$0|@$1|63|5|F|3|64|8|@]|9|@]]]|1C|@]]]|$1|65|19|$0|@$1|66|5|F|3|67|8|@]|9|@]]]|1C|@]]]|$1|68|19|$0|@$1|69|5|F|3|6A|8|@]|9|@]]]|1C|@]]]]]]]]|$1|6B|3|6C|5|6D|7|G0|8|@]|9|@]|C|@]]|$1|6E|3|6F|5|F|7|G1|8|@$A|G2|B|G3|6G|6H]]|9|@]|C|@]]|$1|6I|3|6J|5|V|7|G4|8|@]|9|@]|C|$W|@$1|6K|Y|Z]|$1|6L|Y|Z]|$1|6M|Y|Z]|$1|6N|Y|Z]|$1|6O|Y|Z]|$1|6P|Y|Z]]|15|@$1|6Q|17|@$1|6R|19|$0|@$1|6S|5|F|3|1V|8|@]|9|@]]]|1C|@]]]|$1|6T|19|$0|@$1|6U|5|F|3|6V|8|@]|9|@]]]|1C|@]]]|$1|6W|19|$0|@$1|6X|5|F|3|6Y|8|@]|9|@]]]|1C|@]]]|$1|6Z|19|$0|@$1|70|5|F|3|71|8|@]|9|@]]]|1C|@]]]|$1|72|19|$0|@$1|73|5|F|3|74|8|@]|9|@]]]|1C|@]]]|$1|75|19|$0|@$1|76|5|F|3|77|8|@]|9|@]]]|1C|@]]]]]|$1|78|17|@$1|79|19|$0|@$1|7A|5|F|3|7B|8|@]|9|@]]]|1C|@]]]|$1|7C|19|$0|@$1|7D|5|F|3|7E|8|@]|9|@]]]|1C|@]]]|$1|7F|19|$0|@$1|7G|5|F|3|7H|8|@]|9|@]]]|1C|@]]]|$1|7I|19|$0|@$1|7J|5|F|3|7K|8|@]|9|@]]]|1C|@]]]|$1|7L|19|$0|@$1|7M|5|F|3|7N|8|@]|9|@]]]|1C|@]]]|$1|7O|19|$0|@$1|7P|5|F|3|7Q|8|@]|9|@]]]|1C|@]]]]]|$1|7R|17|@$1|7S|19|$0|@$1|7T|5|F|3|7U|8|@]|9|@]]]|1C|@]]]|$1|7V|19|$0|@$1|7W|5|F|3|7E|8|@]|9|@]]]|1C|@]]]|$1|7X|19|$0|@$1|7Y|5|F|3|7H|8|@]|9|@]]]|1C|@]]]|$1|7Z|19|$0|@$1|80|5|F|3|7K|8|@]|9|@]]]|1C|@]]]|$1|81|19|$0|@$1|82|5|F|3|83|8|@]|9|@]]]|1C|@]]]|$1|84|19|$0|@$1|85|5|F|3|86|8|@]|9|@]]]|1C|@]]]]]|$1|87|17|@$1|88|19|$0|@$1|89|5|F|3|8A|8|@]|9|@]]]|1C|@]]]|$1|8B|19|$0|@$1|8C|5|F|3|7E|8|@]|9|@]]]|1C|@]]]|$1|8D|19|$0|@$1|8E|5|F|3|7K|8|@]|9|@]]]|1C|@]]]|$1|8F|19|$0|@$1|8G|5|F|3|7K|8|@]|9|@]]]|1C|@]]]|$1|8H|19|$0|@$1|8I|5|F|3|86|8|@]|9|@]]]|1C|@]]]|$1|8J|19|$0|@$1|8K|5|F|3|8L|8|@]|9|@]]]|1C|@]]]]]|$1|8M|17|@$1|8N|19|$0|@$1|8O|5|F|3|8P|8|@]|9|@]]]|1C|@]]]|$1|8Q|19|$0|@$1|8R|5|F|3|8S|8|@]|9|@]]]|1C|@]]]|$1|8T|19|$0|@$1|8U|5|F|3|8V|8|@]|9|@]]]|1C|@]]]|$1|8W|19|$0|@$1|8X|5|F|3|8Y|8|@]|9|@]]]|1C|@]]]|$1|8Z|19|$0|@$1|90|5|F|3|8V|8|@]|9|@]]]|1C|@]]]|$1|91|19|$0|@$1|92|5|F|3|8V|8|@]|9|@]]]|1C|@]]]]]]]]|$1|93|3|94|5|6D|7|G5|8|@]|9|@]|C|@]]|$1|95|3|96|5|97|7|G6|8|@]|9|@]|C|@]]|$1|98|3|99|5|F|7|G7|8|@]|9|@]|C|@]]|$1|9A|3|9B|5|F|7|G8|8|@$A|G9|B|GA|6G|6H]]|9|@]|C|@]]|$1|9C|3|9D|5|F|7|GB|8|@]|9|@]|C|@]]|$1|9E|3|4|5|6|7|GC|8|@]|9|@$A|GD|B|GE|1|GF]]|C|@]]|$1|9F|3|9G|5|F|7|GG|8|@]|9|@]|C|@]]|$1|9H|3|9I|5|F|7|GH|8|@$A|GI|B|GJ|6G|9J]|$A|GK|B|GL|6G|9J]|$A|GM|B|GN|6G|9J]|$A|GO|B|GP|6G|9J]|$A|GQ|B|GR|6G|9J]|$A|GS|B|GT|6G|9J]]|9|@]|C|@]]|$1|9K|3|9L|5|6D|7|GU|8|@$A|GV|B|GW|6G|9J]|$A|GX|B|GY|6G|9J]]|9|@]|C|@]]|$1|9M|3|9N|5|97|7|GZ|8|@]|9|@]|C|@]]|$1|9O|3|9P|5|F|7|H0|8|@$A|H1|B|H2|6G|9J]|$A|H3|B|H4|6G|9J]|$A|H5|B|H6|6G|9J]]|9|@]|C|@]]|$1|9Q|3|9R|5|F|7|H7|8|@]|9|@]|C|@]]|$1|9S|3|9T|5|F|7|H8|8|@$A|H9|B|HA|6G|9J]|$A|HB|B|HC|6G|9J]|$A|HD|B|HE|6G|9J]]|9|@]|C|@]]|$1|9U|3|9V|5|F|7|HF|8|@]|9|@]|C|@]]|$1|9W|3|9X|5|9Y|7|HG|8|@]|9|@]|C|$9Z|A0]]|$1|A1|3|A2|5|F|7|HH|8|@$A|HI|B|HJ|6G|9J]]|9|@]|C|@]]|$1|A3|3|A4|5|9Y|7|HK|8|@]|9|@]|C|$9Z|A0]]|$1|A5|3|A6|5|F|7|HL|8|@$A|HM|B|HN|6G|9J]|$A|HO|B|HP|6G|9J]|$A|HQ|B|HR|6G|9J]|$A|HS|B|HT|6G|9J]]|9|@]|C|@]]|$1|A7|3|A8|5|9Y|7|HU|8|@]|9|@]|C|$9Z|A0]]|$1|A9|3|AA|5|F|7|HV|8|@$A|HW|B|HX|6G|9J]]|9|@]|C|@]]|$1|AB|3|AC|5|9Y|7|HY|8|@]|9|@]|C|$9Z|A0]]|$1|AD|3|AE|5|F|7|HZ|8|@]|9|@]|C|@]]|$1|AF|3|AG|5|9Y|7|I0|8|@]|9|@]|C|$9Z|A0]]|$1|AH|3|4|5|6|7|I1|8|@]|9|@$A|I2|B|I3|1|I4]]|C|@]]|$1|AI|3|AJ|5|F|7|I5|8|@$A|I6|B|I7|6G|9J]]|9|@]|C|@]]|$1|AK|3|AL|5|9Y|7|I8|8|@]|9|@]|C|$9Z|A0]]|$1|AM|3|AN|5|6D|7|I9|8|@$A|IA|B|IB|6G|9J]|$A|IC|B|ID|6G|9J]]|9|@]|C|@]]|$1|AO|3|AP|5|97|7|IE|8|@]|9|@]|C|@]]|$1|AQ|3|AR|5|F|7|IF|8|@]|9|@]|C|@]]|$1|AS|3|AT|5|F|7|IG|8|@]|9|@]|C|@]]|$1|AU|3|AV|5|F|7|IH|8|@]|9|@]|C|@]]|$1|AW|3|AX|5|F|7|II|8|@]|9|@]|C|@]]|$1|AY|3|AZ|5|F|7|IJ|8|@]|9|@]|C|@]]|$1|B0|3|B1|5|9Y|7|IK|8|@]|9|@]|C|$9Z|A0]]|$1|B2|3|B3|5|F|7|IL|8|@]|9|@]|C|@]]|$1|B4|3|B5|5|9Y|7|IM|8|@]|9|@]|C|$9Z|A0]]|$1|B6|3|B7|5|F|7|IN|8|@]|9|@]|C|@]]|$1|B8|3|B9|5|F|7|IO|8|@]|9|@]|C|@]]|$1|BA|3|BB|5|F|7|IP|8|@]|9|@]|C|@]]|$1|BC|3|BD|5|6D|7|IQ|8|@]|9|@]|C|@]]|$1|BE|3|BF|5|6D|7|IR|8|@]|9|@]|C|@]]|$1|BG|3|BH|5|97|7|IS|8|@]|9|@]|C|@]]|$1|BI|3|BJ|5|F|7|IT|8|@]|9|@]|C|@]]|$1|BK|3|BL|5|F|7|IU|8|@]|9|@]|C|@]]|$1|BM|3|BN|5|F|7|IV|8|@]|9|@]|C|@]]|$1|BO|3|BP|5|F|7|IW|8|@]|9|@]|C|@]]|$1|BQ|3|BR|5|9Y|7|IX|8|@]|9|@]|C|$9Z|A0]]|$1|BS|3|BT|5|F|7|IY|8|@]|9|@]|C|@]]|$1|BU|3|BV|5|F|7|IZ|8|@$A|J0|B|J1|6G|9J]|$A|J2|B|J3|6G|9J]|$A|J4|B|J5|6G|9J]]|9|@]|C|@]]|$1|BW|3|BX|5|F|7|J6|8|@$A|J7|B|J8|6G|9J]]|9|@]|C|@]]|$1|BY|3|BZ|5|9Y|7|J9|8|@]|9|@]|C|$9Z|A0]]|$1|C0|3|C1|5|F|7|JA|8|@$A|JB|B|JC|6G|9J]]|9|@]|C|@]]|$1|C2|3|C3|5|9Y|7|JD|8|@]|9|@]|C|$9Z|A0]]|$1|C4|3|C5|5|6D|7|JE|8|@]|9|@]|C|@]]|$1|C6|3|C7|5|F|7|JF|8|@]|9|@]|C|@]]|$1|C8|3|C9|5|F|7|JG|8|@]|9|@]|C|@]]|$1|CA|3|CB|5|97|7|JH|8|@]|9|@]|C|@]]|$1|CC|3|CD|5|F|7|JI|8|@]|9|@]|C|@]]|$1|CE|3|CF|5|9Y|7|JJ|8|@]|9|@]|C|$9Z|A0]]|$1|CG|3|CH|5|F|7|JK|8|@]|9|@]|C|@]]|$1|CI|3|CJ|5|6D|7|JL|8|@]|9|@]|C|@]]|$1|CK|3|CL|5|F|7|JM|8|@]|9|@]|C|@]]|$1|CM|3|CN|5|9Y|7|JN|8|@]|9|@]|C|$9Z|A0]]|$1|CO|3|CP|5|F|7|JO|8|@$A|JP|B|JQ|6G|9J]]|9|@]|C|@]]|$1|CQ|3|CR|5|F|7|JR|8|@$A|JS|B|JT|6G|9J]]|9|@]|C|@]]|$1|CS|3|CT|5|F|7|JU|8|@$A|JV|B|JW|6G|9J]|$A|JX|B|JY|6G|9J]|$A|JZ|B|K0|6G|9J]]|9|@]|C|@]]|$1|CU|3|CV|5|F|7|K1|8|@]|9|@]|C|@]]|$1|CW|3|CX|5|9Y|7|K2|8|@]|9|@]|C|$9Z|A0]]|$1|CY|3|CZ|5|F|7|K3|8|@]|9|@]|C|@]]|$1|D0|3|D1|5|97|7|K4|8|@]|9|@]|C|@]]|$1|D2|3|D3|5|F|7|K5|8|@$A|K6|B|K7|6G|9J]]|9|@]|C|@]]|$1|D4|3|D5|5|F|7|K8|8|@$A|K9|B|KA|6G|9J]|$A|KB|B|KC|6G|9J]|$A|KD|B|KE|6G|9J]|$A|KF|B|KG|6G|9J]]|9|@]|C|@]]|$1|D6|3|D7|5|F|7|KH|8|@]|9|@]|C|@]]|$1|D8|3|D9|5|F|7|KI|8|@$A|KJ|B|KK|6G|9J]]|9|@]|C|@]]|$1|DA|3|DB|5|F|7|KL|8|@$A|KM|B|KN|6G|9J]]|9|@]|C|@]]|$1|DC|3|4|5|6|7|KO|8|@]|9|@$A|KP|B|KQ|1|KR]]|C|@]]|$1|DD|3|DE|5|6D|7|KS|8|@]|9|@]|C|@]]|$1|DF|3|DG|5|F|7|KT|8|@]|9|@]|C|@]]|$1|DH|3|DI|5|97|7|KU|8|@]|9|@]|C|@]]|$1|DJ|3|DK|5|F|7|KV|8|@]|9|@]|C|@]]|$1|DL|3|DM|5|F|7|KW|8|@]|9|@]|C|@]]|$1|DN|3|DO|5|F|7|KX|8|@]|9|@]|C|@]]|$1|DP|3|4|5|6|7|KY|8|@]|9|@$A|KZ|B|L0|1|L1]]|C|@]]|$1|DQ|3|DR|5|6D|7|L2|8|@]|9|@$A|L3|B|L4|1|L5]]|C|@]]|$1|DS|3|DT|5|F|7|L6|8|@]|9|@]|C|@]]|$1|DU|3|4|5|6|7|L7|8|@]|9|@$A|L8|B|L9|1|LA]]|C|@]]|$1|DV|3|DW|5|6D|7|LB|8|@]|9|@]|C|@]]|$1|DX|3|DY|5|6D|7|LC|8|@]|9|@]|C|@]]|$1|DZ|3|E0|5|F|7|LD|8|@]|9|@]|C|@]]|$1|E1|3|4|5|6|7|LE|8|@]|9|@$A|LF|B|LG|1|LH]]|C|@]]|$1|E2|3|E3|5|6D|7|LI|8|@$A|LJ|B|LK|6G|9J]]|9|@]|C|@]]|$1|E4|3|E5|5|6D|7|LL|8|@]|9|@]|C|@]]|$1|E6|3|E7|5|6D|7|LM|8|@]|9|@]|C|@]]|$1|E8|3|E9|5|F|7|LN|8|@]|9|@]|C|@]]|$1|EA|3|4|5|6|7|LO|8|@]|9|@$A|LP|B|LQ|1|LR]]|C|@]]|$1|EB|3|EC|5|6D|7|LS|8|@]|9|@]|C|@]]|$1|ED|3|EE|5|6D|7|LT|8|@]|9|@]|C|@]]|$1|EF|3|EG|5|F|7|LU|8|@]|9|@]|C|@]]|$1|EH|3|EI|5|F|7|LV|8|@]|9|@]|C|@]]|$1|EJ|3|EK|5|F|7|LW|8|@]|9|@]|C|@]]|$1|EL|3|EM|5|97|7|LX|8|@]|9|@]|C|@]]|$1|EN|3|EO|5|F|7|LY|8|@]|9|@]|C|@]]|$1|EP|3|EQ|5|F|7|LZ|8|@]|9|@]|C|@]]|$1|ER|3|ES|5|97|7|M0|8|@]|9|@]|C|@]]|$1|ET|3|EU|5|F|7|M1|8|@]|9|@]|C|@]]|$1|EV|3|EW|5|EX|7|M2|8|@$A|M3|B|M4|6G|6H]]|9|@]|C|@]]|$1|EY|3|EZ|5|F|7|M5|8|@$A|M6|B|M7|6G|9J]|$A|M8|B|M9|6G|9J]|$A|MA|B|MB|6G|9J]|$A|MC|B|MD|6G|9J]|$A|ME|B|MF|6G|9J]|$A|MG|B|MH|6G|9J]|$A|MI|B|MJ|6G|9J]|$A|MK|B|ML|6G|9J]|$A|MM|B|MN|6G|9J]|$A|MO|B|MP|6G|9J]|$A|MQ|B|MR|6G|9J]|$A|MS|B|MT|6G|9J]|$A|MU|B|MV|6G|9J]|$A|MW|B|MX|6G|9J]|$A|MY|B|MZ|6G|9J]|$A|N0|B|N1|6G|9J]|$A|N2|B|N3|6G|9J]|$A|N4|B|N5|6G|9J]|$A|N6|B|N7|6G|9J]|$A|N8|B|N9|6G|9J]|$A|NA|B|NB|6G|9J]|$A|NC|B|ND|6G|9J]|$A|NE|B|NF|6G|9J]|$A|NG|B|NH|6G|9J]|$A|NI|B|NJ|6G|9J]|$A|NK|B|NL|6G|9J]|$A|NM|B|NN|6G|9J]|$A|NO|B|NP|6G|9J]|$A|NQ|B|NR|6G|9J]|$A|NS|B|NT|6G|9J]|$A|NU|B|NV|6G|9J]|$A|NW|B|NX|6G|9J]|$A|NY|B|NZ|6G|9J]|$A|O0|B|O1|6G|9J]|$A|O2|B|O3|6G|9J]|$A|O4|B|O5|6G|9J]|$A|O6|B|O7|6G|9J]|$A|O8|B|O9|6G|F0]|$A|OA|B|OB|6G|F0]|$A|OC|B|OD|6G|F0]|$A|OE|B|OF|6G|F0]|$A|OG|B|OH|6G|F0]|$A|OI|B|OJ|6G|F0]|$A|OK|B|OL|6G|F0]|$A|OM|B|ON|6G|F0]|$A|OO|B|OP|6G|F0]|$A|OQ|B|OR|6G|F0]|$A|OS|B|OT|6G|F0]|$A|OU|B|OV|6G|F0]|$A|OW|B|OX|6G|F0]|$A|OY|B|OZ|6G|F0]|$A|P0|B|P1|6G|F0]|$A|P2|B|P3|6G|F0]|$A|P4|B|P5|6G|F0]|$A|P6|B|P7|6G|F0]|$A|P8|B|P9|6G|F0]|$A|PA|B|PB|6G|F0]|$A|PC|B|PD|6G|F0]|$A|PE|B|PF|6G|F0]|$A|PG|B|PH|6G|F0]|$A|PI|B|PJ|6G|F0]|$A|PK|B|PL|6G|F0]|$A|PM|B|PN|6G|F0]|$A|PO|B|PP|6G|F0]|$A|PQ|B|PR|6G|F0]|$A|PS|B|PT|6G|F0]|$A|PU|B|PV|6G|F0]|$A|PW|B|PX|6G|F0]|$A|PY|B|PZ|6G|F0]|$A|Q0|B|Q1|6G|F0]|$A|Q2|B|Q3|6G|F0]|$A|Q4|B|Q5|6G|F0]|$A|Q6|B|Q7|6G|F0]|$A|Q8|B|Q9|6G|F0]]|9|@]|C|@]]]|1C|@$5|F1|F2|F3|C|$F4|F5|F6|-4]]|$5|F1|F2|F3|C|$F4|F7|F6|-4]]|$5|F1|F2|F3|C|$F4|F8|F6|-4]]|$5|F1|F2|F3|C|$F4|F9|F6|-4]]|$5|F1|F2|F3|C|$F4|FA|F6|-4]]|$5|F1|F2|F3|C|$F4|FB|F6|-4]]|$5|FC|F2|FD|C|$FE|FF]]|$5|F1|F2|F3|C|$F4|FG|F6|-4]]|$5|F1|F2|F3|C|$F4|FH|F6|-4]]|$5|F1|F2|F3|C|$F4|FI|F6|-4]]]]","plain":"📷\n性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战的难点。\n为何性能很重要？完备的功能需要用性能交换，安全性需要用性能交换，成本需要用性能交换，产品体验需要用性能交换，甚至系统弹性都需要性能交换。有了基础性能，就有了竞争力的资本；基础性能若有问题，举步维艰，想要干点啥都不容易，就像天生羸弱的身子板。\nSRS虽然是单进程单线程模型，性能一直都很高，比如：\n•单进程能跑满千兆或万兆网卡，一般的场景完全能覆盖。•性能是NginxRTMP或Janus的三倍左右，目前还没有更高性能的开源同类产品。•提供集群能力，水平扩展性能，在开源项目中也不多见。\n这并不是终点，这个性能基准只够5年左右，随着业务发展一定会有更高性能的需求。目前服务器属于第二代高并发架构，也就是单线程架构：\n•第一代高并发架构，1990～2010年，多线程架构，一般比较老的服务器都是这种架构，一般无法解决C10K[1]问题，比如Adobe AMS[2]，Apache HTTP Server[3]，Janus WebRTC Server[4]。核心问题是多线程的水平扩展性问题，并发越多，线程之间的同步和竞争开销就越大（这个问题也是现代语言Go在性能方面的硬伤，特别是在超多CPU比如64核或128核时，多线程的损耗会更大）。•第二代高并发架构，2010～2020年，单线程架构，多进程或单进程单线程都是这种架构，C10K问题得到比较好的解决，比如Nginx[5]，SRS[6]，MediaSoup[7]。核心问题是单线程引入的异步回调问题[8]，新的语言比如Go引入轻量线程goroutine（协程）解决这个问题，老的语言比如C++20、JS await等都有对应的机制。另外多进程的进程间通信也会引入额外复杂性，比如直播和RTC的流的跨进程回源和拉流问题。•第三代高并发架构，隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[9]，还有比Nginx更高性能的反向代理么，这就是Envoy[10]了，如下图所示。其实Envoy和Nginx都是事件驱动，但是Envoy是完全非阻塞[11]。而Envoy的多线程实际上和第一代的多线程也不同，线程之间几乎没有交互，可以看作是隔离的进程。由于是线程，所以它们之间的（少量）通信也很容易。同样，多线程也可以和轻量线程结合使用。\n📷\nSRS目前还属于第二代架构，第三代架构验证过是可行的(#2188[12])，由于目前SRS性能还不是短板，所以没有合并到主干分支，有需要可以自己合并feature/threads[13]。目前SRS的性能数据如下：\nSFU\tClients\tCPU\tMemory\t线程\tVM\nSRS\t4000 players\t~94% x1\t419MB\t1\tG5 8CPU\nNginxRTMP\t2400 players\t~92% x1\t173MB\t1\tG5 8CPU\nSRS\t2300 publishers\t~89% x1\t1.1GB\t1\tG5 8CPU\nNginxRTMP\t1300 publishers\t~84% x1\t198MB\t1\tG5 8CPU\n\nSFU\tClients\tCPU\tMemory\t线程\tVM\nSRS\t1000 players\t~90% x1\t180MB\t1\tG5 2CPU\nJanus\t700 players\t~93% x2\t430MB\t24\tG5 2CPU\nSRS\t950 publishers\t~92% x1\t132MB\t1\tG5 2CPU\nJanus\t350 publishers\t~93% x2\t405MB\t23\tG5 2CPU\n\nNote: CentOS7, 600Kbps, ECS/G5-2.5GHZ(SkyLake)[14], SRS/v4.0.105[15], NginxRTMP/v1.2.1[16]。虽然系统有8CPU但只能使用单个CPU，选择8CPU是因为只有8CPU的内网带宽才能到10Gbps。\n当我们提到性能，一般隐含条件是“满足业务场景的体验”下的性能优化，比如直播要求卡顿率低、延迟在3秒之内，比如WebRTC要求端到端延迟400ms之内（服务器0延迟），一般现在服务器的内存可以是4GB、8GB、16GB、32GB或64GB，这意味着我们可以尽量用内存Cache来降低CPU运算。\nSRS\tProtocol\tVP6\tH.264\tVP6+MP3\tH.264+MP3\n2.0.72\tRTMP\t0.1s\t0.4s\t0.8s\t0.6s\n2.0.70\tRTMP\t0.1s\t0.4s\t1.0s\t0.9s\n1.0.10\tRTMP\t0.4s\t0.4s\t0.9s\t1.2s\n4.0.87\tWebRTC\tx\t80ms\tx\tx\n\nNote: 在音视频服务器的性能优化中，延迟是必须要考虑的一个因素，特别是在RTC服务器，性能优化不能以增大延迟为方法。\n性能基准\n如果没有压测能力，就无法优化性能。\nSRS的基准是并发流，比如使用srs-bench[17]推流可以获得支持的最高推流（发布）并发，和最高拉流（播放）并发。压测工具一般读取文件，可以选择典型的业务场景，录制成样本文件，这样压测可以尽量模拟线上场景。\n性能优化前，必须使用压测获得目前的性能基准，分析目前的性能瓶颈和优化思路，然后修改代码获得新的性能基准，如此反复不断提升性能。如下图所示：\n📷\n上图就是性能分析的主面板，左三右二加一个浏览器：\n•左上：服务器的top图，命令是 top -H -p $(cat objs/srs.pid) ，看CPU和内存。还有每个CPU的消耗情况（进入top后按数字1），比如us是用户空间函数，sy是内核函数，si是网卡软中断。•左中：系统的网络带宽图，命令是 dstat ，看出入口带宽。比如视频平均码率是600kbps，那么900个推流时，网卡的recv流量应该是600*900/8000.0KBps也就是67.5MBps，如果网卡吞吐率达不到预期，那么肯定会出现卡顿等问题，比如可能是系统的网卡队列缓冲区[18]太小导致丢包。•左下：服务器关键日志，命令是 tail -f objs/srs.log |grep -e 'RTC: Server' -e Hybrid ，查看RTC的连接数和关键日志，以及进程的CPU等信息。如果连接数达不到预期，或者CPU接近100%，也是有问题的。•右上：服务器热点函数列表，命令是 perf top -p $(cat objs/srs.pid) ，可以看到当前主要的热点函数列表，以及每个函数所占用的百分比。性能优化一般的思路，就是根据这个表，优化掉排名在前面的热点函数。•右下：压测客户端的top图，如果压测服务器的CPU满载，也一样达不到预期，会出现卡顿等情况。同样也需要先检查系统的网卡队列缓冲区[19]，避免系统丢包。•浏览器：在浏览器中播放流，比如webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13[20]，可以通过eip指定外网ip，这样压测工具可以推内网地址，而浏览器观看可以看外网的地址。浏览器观看可以随机抽查某个流，判断是否播放流畅，声音和画面是否正常等。\nNote: 我们在左上的图中，截图时加上了标注，可以更快的看出这个性能图的摘要，比如ECS/C5 2CPU说明是ECS的C5机型一共是2个CPU，900 publish streams是RTC推流一共900个并发流。\n工具链\n没有工具链就无法做性能优化，前一章我们分享了压测工具srs-bench[21]，查看网络带宽工具dstat，查看热点函数工具perf，查看CPU工具top。\n还有一些工具链，总结在SRS性能(CPU)、内存优化工具用法[22]，我们挑一些和性能优化相关的工具重点介绍。包括：\n•sysctl：修改内核UDP缓冲区，防止内核丢包。•GPERF: GCP：使用GCP分析热点函数的调用链，图形化展示。•taskset：进程绑核后，避免软中断干扰，便于查看数据。\n对于RTC，很重要的是需要把内核协议栈的缓冲区改大，默认只有200KB，必须改成16MB以上，否则会导致丢包：\nsysctl net.core.rmem_max=16777216\nsysctl net.core.rmem_default=16777216\nsysctl net.core.wmem_max=16777216\nsysctl net.core.wmem_default=16777216\n可以直接修改文件/etc/sysctl.conf，重启也能生效：\n# vi /etc/sysctl.conf\nnet.core.rmem_max=16777216\nnet.core.rmem_default=16777216\nnet.core.wmem_max=16777216\nnet.core.wmem_default=16777216\n如果perf热点函数比较通用，比如是malloc，那我们可能需要分析调用链路，看是哪个执行分支导致malloc热点，由于SRS使用的协程，perf无法正确获取堆栈，我们可以用GPERF: GCP工具：\n# Build SRS with GCP\n./configure --with-gperf --with-gcp && make\n\n# Start SRS with GCP\n./objs/srs -c conf/console.conf\n\n# Or CTRL+C to stop GCP\nkillall -2 srs\n\n# To analysis cpu profile\n./objs/pprof --text objs/srs gperf.srs.gcp*\n图形化展示时，需要安装依赖graphviz：\nyum install -y graphviz\n然后就可以生成SVG图，用浏览器打开就可以看了：\n./objs/pprof --svg ./objs/srs gperf.srs.gcp \u003Et.svg\n📷\n还可以使用taskset绑定进程到某个核，这样避免在不同的核跳动，和软中断跑在一个核后干扰性能，比如一般软中断会在CPU0，我们绑定SRS到CPU1：\ntaskset -pc 1 $(cat objs/srs.pid)\nNote：如果是多线程模式，可以增加参数-a绑定所有线程到某个核，或者在配置文件中，配置cpu_affinity指定线程的核。\n内存交换性能\n现代服务器的内存都很大，平均每个核有2GB内存，比如：\n•ECS ecs.c5.large[23], 2CPU 4GB 内存，1Gbps内网带宽。•ECS ecs.c5.xlarge[24], 4CPU 8GB 内存，1.5Gbps内网带宽。•ECS ecs.c5.2xlarge[25], 8CPU 16GB 内存，2.5Gbps内网带宽。\n还有其他型号的，比如G5[26]每个核是4GB内存，比如R5[27]更是每个核高达8GB内存。这么多内存，对于无磁盘缓存型的网络服务器，直播转发或者SFU转发，一般内存是用不了这么多的，收包然后转发，几乎不需要缓存很久的数据。\n因此，线上的视频服务器一般内存都是很充足的，有些情况下可以用内存来优化性能的地方，就可以果断的上内存缓存（Cache）策略。\n比如，在直播播放时，SRS有个配置项叫合并写入（发送）：\nvhost __defaultVhost__ {\n    play {\n        # Set the MW(merged-write) min messages.\n        # default: 0 (For Real-Time, min_latency on)\n        # default: 1 (For WebRTC, min_latency off)\n        # default: 8 (For RTMP/HTTP-FLV, min_latency off).\n        mw_msgs         8;\n    }\n}\n如果是非低延迟（默认）模式是8，也就是收到了8个音视频包后，才会转发给播放器。关键代码如下：\nsrs_error_t SrsRtmpConn::do_playing(SrsLiveSource* source, SrsLiveConsumer* consumer, SrsQueueRecvThread* rtrd)\n{\n    mw_msgs = _srs_config-\u003Eget_mw_msgs(req-\u003Evhost, realtime);\n    mw_sleep = _srs_config-\u003Eget_mw_sleep(req-\u003Evhost);\n\n    while (true) {\n        consumer-\u003Ewait(mw_msgs, mw_sleep);\n\n        if ((err = consumer-\u003Edump_packets(&msgs, count)) != srs_success) {\n            return srs_error_wrap(err, \"rtmp: consumer dump packets\");\n        }\n\n        if (count \u003E 0 && (err = rtmp-\u003Esend_and_free_messages(msgs.msgs, count, info-\u003Eres-\u003Estream_id)) != srs_success) {\n            return srs_error_wrap(err, \"rtmp: send %d messages\", count);\n        }\n如果是25fps，那么8个包大约是在320ms，考虑音频包大约是160ms延迟，这个队列的额外延迟在直播中也是可以接受的。\n如果是8个包一次发送，按照平均码率1Mbps，差不多是300Mb也就是40KB的数据。如果按照峰值5Mbps码率计算，那就是一次发送200KB的数据。我们可以用writev一次发送这些数据，就可以极大的提高分发的性能了。\n每个连接我们需要的内存按照1MB来计算，那么4000个连接需要4GB内存。如果是7000个连接，需要7GB的内存。可以认为直播分发的性能优化，是典型的内存（加少量延迟）来换更低的CPU使用。\nNote: 当然服务器引入额外的160ms延迟对于RTC场景就是不可以接受的，只能在直播中使用这种优化。\nNote: RTC的UDP发送是否能使用类似的优化？我们调研过UDP/sendmmsg[28]和UDP/GSO[29]是可以提升一部分，但是由于UDP每个连接可合并发送的数据很少，目前压测分析热点也不在这里，所以优化有限，目前SRS并没有做这两个优化。\n查找优化\nSTL的vector和map的查找算法，已经优化得很好了，实际上还是会成为性能瓶颈。\n比如，RTC由于实现了端口复用，需要根据每个UDP包的五元组（或其他信息），查找到对应的Session处理包；Session需要根据SSRC找到对应的track，让track处理这个包。\n比如，SRS的日志是可追溯的，打印时会打印出上下文ID，可以将多个会话的日志分离。这个Context ID是存储在全局的map中的，每次切换上下文需要根据协程ID查找出对应的上下文ID。\n如果每个包都需要这么运算一次，那开销也是相当可观的。考虑根据UDP包查找Session，如下图：\nint SrsUdpMuxSocket::recvfrom(srs_utime_t timeout)\n{\n    nread = srs_recvfrom(lfd, buf, nb_buf, (sockaddr*)&from, &fromlen, timeout);\n    getnameinfo((sockaddr*)&from, fromlen,  (char*)&address_string, 64, (char*)&port_string\n    peer_ip = std::string(address_string);\n    peer_port = atoi(port_string); \n\nsrs_error_t SrsUdpMuxListener::cycle()\n{\n    while (true) {\n        SrsUdpMuxSocket skt(lfd);\n        int nread = skt.recvfrom(SRS_UTIME_NO_TIMEOUT);\n        err = handler-\u003Eon_udp_packet(&skt);\n\nsrs_error_t SrsRtcServer::on_udp_packet(SrsUdpMuxSocket* skt)\n{\n    string peer_id = skt-\u003Epeer_id();\n    ISrsResource* conn = _srs_rtc_manager-\u003Efind_by_id(peer_id);\n    session = dynamic_cast\u003CSrsRtcConnection*\u003E(conn);\n\nISrsResource* SrsResourceManager::find_by_id(std::string id)\n{\n    map\u003Cstring, ISrsResource*\u003E::iterator it = conns_id_.find(id);\n    return (it != conns_id_.end())? it-\u003Esecond : NULL;\n}\n这个逻辑有几个地方会有热点，通过压测可以在perf上看到：\n•每个UDP包都调用getnameinfo将sockaddr转成字符串的ip:port，也就是地址标识，会有大量的string开辟和释放。•每个UDP包都需要根据ip:port，在map中查找出对应的Session（Resource或Conneciton），字符串查找的速度是很慢的。\n改进其实也容易，查找时不转成string，而是生成uint64_t的地址，目前支持的是IPv4地址只需要6字节就可以表达ip:port（如果是IPv6则需要两个uint64_t），如下所示：\nint SrsUdpMuxSocket::recvfrom(srs_utime_t timeout)\n{\n    nread = srs_recvfrom(lfd, buf, nb_buf, (sockaddr*)&from, &fromlen, timeout);\n    sockaddr_in* addr = (sockaddr_in*)&from;\n    fast_id_ = uint64_t(addr-\u003Esin_port)\u003C\u003C48 | uint64_t(addr-\u003Esin_addr.s_addr);\n\nsrs_error_t SrsRtcServer::on_udp_packet(SrsUdpMuxSocket* skt)\n{\n    uint64_t fast_id = skt-\u003Efast_id();\n    session = (SrsRtcConnection*)_srs_rtc_manager-\u003Efind_by_fast_id(fast_id);\n虽然解决了string查找的热点，随着并发的提升，map\u003Ckey: uint64_t\u003E的查找也变成了热点，在perf上可以看到map的不断平衡，我们还可以改成vector查找：\nISrsResource* SrsResourceManager::find_by_fast_id(uint64_t id)\n{\n    SrsResourceFastIdItem* item = &conns_level0_cache_[(id | id\u003E\u003E32) % nn_level0_cache_];\n    if (item-\u003Eavailable && item-\u003Efast_id == id) {\n        return item-\u003Eimpl;\n    }\n\n    map\u003Cuint64_t, ISrsResource*\u003E::iterator it = conns_fast_id_.find(id);\n    return (it != conns_fast_id_.end())? it-\u003Esecond : NULL;\n}\nNote: 首先我们在vector中取余查找，如果取余碰撞了（两个不同id但是取余后一样，比如1001%1000和2001%1000是一样的），那么就用map查找。\n通过不同的查找方式，string变uint64_t优化了查找速度，而更快的优化是不用map查找，直接使用数组取余就是无查找了。\n当然，这样的优化，让逻辑变得复杂了。\n无代码优化\n当我们优化完明显的热点，优化完头部热点，会发现perf显示已经没有明显的热点，有时候有些不太明显的函数也会排在前头，比如拷贝RTP Packet：\nSrsRtpPacket* SrsRtpPacket::copy()\n{\n    SrsRtpPacket* cp = new SrsRtpPacket();\n\n    cp-\u003Eheader = header;\n    cp-\u003Epayload_ = payload_? payload_-\u003Ecopy():NULL;\n    cp-\u003Epayload_type_ = payload_type_;\n\n    cp-\u003Enalu_type = nalu_type;\n    cp-\u003Eshared_buffer_ = shared_buffer_? shared_buffer_-\u003Ecopy2() : NULL;\n    cp-\u003Eactual_buffer_size_ = actual_buffer_size_;\n    cp-\u003Eframe_type = frame_type;\n\n    cp-\u003Ecached_payload_size = cached_payload_size;\n    // For performance issue, do not copy the unused field.\n    cp-\u003Edecode_handler = decode_handler;\n\n    return cp;\n}\n这个函数有啥可以优化的么？没有什么可以优化的，全都是赋值和拷贝（无深拷贝），但是在perf上它就是排名在前头。\nNote: 这时候千万别怀疑perf有问题，确实热点是这个拷贝是没有错的，perf不会出错，perf不会出错，perf不会出错，千万不要把焦点挪开去优化其他函数。\n并不是函数性能高，就不会成为瓶颈，有个公式如下：\n性能热点 = 函数执行效率 x 函数执行次数\n一般我们会优先优化函数执行效率，让函数更高效。但是我们也不能忽略了函数的执行次数，如果一个高效的函数被反复的执行，一样也会变成性能热点。这时候我们的优化思路就是：如何让代码不执行，或明显减少执行次数。\n通过分析可以发现，这个SrsRtpPacket::copy调用点有：\n•从Publisher拷贝到每个Consumer，函数是SrsRtcSource::on_rtp。•包发送后，放到Track的NACK队列，函数是SrsRtcRecvTrack::on_nack和SrsRtcSendTrack::on_nack。\n上面第二个拷贝可以省略，由于每个Player都有NACK，所以可以减少一倍的调用，优化后这个热点也就不排在前头了：\nsrs_error_t SrsRtcRecvTrack::on_nack(SrsRtpPacket** ppkt)\n{\n    rtp_queue_-\u003Eset(seq, pkt);\n    *ppkt = NULL;\n同样的，这个优化的代价就是增加了风险，参数也从指针，变成了指针的指针，一路都改成了指针的指针，可以犯错的概率就大太多了。\nUDP协议栈\n在直播优化中，我们使用writev一次写入大量的数据，大幅提高了播放的性能。\n其实UDP也有类似的函数，UDP的sendto对应TCP的write，UDP的sendmmsg对应TCP的writev，我们调研过UDP/sendmmsg[30]是可以提升一部分性能，不过它的前提是：\n•在Perf中必须看到UDP的相关函数成为热点，如果有其他的热点比UDP更耗性能，那么上sendmmsg也不会有改善。•一般并发要到2000以上，UDP协议栈才可能出现在perf的热点，较低并发时收发的包，还不足以让UDP的函数成为热点。•由于不能增加延迟，需要改发送结构，集中发给多个地址的UDP包统一发送。这对可维护性上是比较大的影响。\n还有一种优化是GSO，延迟分包。我们调研过UDP/GSO[31]，比sendmmsg提升还要大一些，它的前提是：\n•和sendmmsg一样，只有当UDP相关函数成为perf的热点，优化才有效。•GSO只能对一个客户端的包延迟组包，所以他的作用取决于要发给某个客户端的包数目，由于RTC的实时性要求，一般2到3个比较常见。\n📷\nNote: 从上图可见，开启Padding后，UDP组包效能可以提升10%左右。GSO虽然不能减少实际网络上UDP包的数目，但是可以让内核延迟到最后才组UDP包，可以把GSO发送的多个包认为是一个包，相当于减少了发送UDP包的次数。\n还有一种优化的可能，就是ZERO_COPY，其实TCP的零拷贝支持得比较早，但是UDP的支持得比较晚一些。收发数据时，需要从用户空间到内核空间不断拷贝，不过之前测试没有明显收益，参考ZERO-COPY[32]。\n多线程\n文章开头我们提到，第三代高并发架构，将是隔离的多线程架构，比如云原生的数据面反向代理Envoy线程模型[33]。\n我们也调研过SRS可能的多线程架构，参考#2188[34]。和Envoy不同，SRS涉及到了TCP和UDP，API和媒体服务，级联和QoS等问题，可能的架构也比较多。\nSRS 1/2/3/4一直都是单线程（第二代架构），如下图所示：\n📷\nNote：这个架构的风险一直都存在，写磁盘可能是阻塞的，DNS解析可能是阻塞的，RTC无法使用多CPU的能力（直播可以用集群或REUSE_PORT扩展多核能力）。\n很显然，写磁盘应该由单独线程完成，可以避免阻塞，这就是SRS 5.0使用的架构：\n📷\nNote: 其实DVR和HLS也是写磁盘操作，未来也会由写磁盘的线程实现，目前还没有实现。\nNote: DNS解析也是阻塞的，和写磁盘不同，DNS解析本质上是UDP请求，是可以自己实现协议解析，不需要用多线程做。\n针对RTC的多核扩展能力，有一种很自然（也是改动较小）的思路，就是将更多的能力拆分到线程中。比如SRTP加解密，占用了30%的CPU，如果能拆分到独立线程肯定对并发能力有提升。比如UDP收发也可以放到独立线程，也可以避免内核UDP收发效率不高的问题。如下图所示：\n📷\nNote: 这个架构是被标记为废弃，原因就是SRTP和UDP确实效率不高，但是Hybrid里面的QoS算法是瓶颈所在，而这部分不方便拆分多线程。\nNote: 另外，就算QoS拆分成多线程，这个架构最多用到大约3～4CPU，并不能用到32或64核CPU，也就是并发能力还是受限。\nNote: 最后，这种多线程架构，线程之间交互较多，所以会有锁的开销，也不算第三代服务器架构。\n最终的多线程架构，是能水平扩展的多线程架构，实现的原型参考feature/threads[35]分支，如下图所示：\n📷\nNote: 我们实现的一个版本是多端口模型，通过端口分割不同的Hybrid线程，Hybrid线程之间独立不需要交互。实际上多线程之间也是可以复用同样端口的，只是切网时需要考虑新五元组的绑定。\nNote: 这个架构完全解决了水平扩展的问题，也避免了线程之间需要交互数据，压测在32核C5机器上，能跑到10K左右并发（可以在更多核的机器上扩展）。\n当然，最后这个架构也并非没有问题，目前看还需要解决以下问题，才能在线上使用：\n•API必须非常简单，如果是Janus那种复杂的API，就无法使用这种结构。SRS目前的API是比较合适实现这种架构。API实际上承担了调度的能力。•直播需要改进，适配这种多线程结构。直播Edge相对比较容易改造，可以用REUSE_PORT，相当于多个进程。而直播Origin改造比较麻烦。•统计和API需要改造，系统的CPU使用率，告警和水位统计，限流策略，都会因为多线程有所不同。比如在线人数，需要汇总每个线程的连接数。•全局变量和局部静态变量，必须仔细Check，保障是线程安全(thread-safe)，或者是线程局部(thread-local)，虽然我们在原型中已经改造得差不多，但还是需要更多确认。\n由于多线程本质上和集群的能力是有一部分重合的，只是多线程的效率更高。比如直播其实可以用多个Edge部署在一台机器上（Edge后面挂一堆Edge），实现多核的扩展。RTC如果实现了级联，也一样是可以扩展多核能力，比如单核支持800个并发，每个SRS跑在一个Pod中，也可以用级联扩展能力（当然会造成进程之间的带宽比多线程要高，多线程是不走带宽）。\n硬件加速\nSRS没有使用硬件加速，但这个是一个很不错的思路，包括：\n•CPU指令集优化：加解密和编解码的算法，有些可以用到CPU的特殊指令，增加批处理的能力，比如AVX512[36]。•专用加解密硬件卡，加解密是比较通用的算法，有专门硬件，可以调研看看。•UDP收发优化，不经过内核协议栈，直接从用户空间和网卡交互：DPDK[37]。\n总结\n性能优化，是全面的和持续的工程能力，涉及到了对系统的理解、对业务的认知、对编程语言的熟悉、对硬件和软件框架的挖掘、性能分析工具链的使用，心肝脾肺肾只有全面提升，最终才能获得性能的提升。\nReferences\n[1] C10K: http://www.kegel.com/c10k.html\n[2] Adobe AMS: https://helpx.adobe.com/adobe-media-server/tech-overview/introduction-ams.html\n[3] Apache HTTP Server: https://httpd.apache.org/\n[4] Janus WebRTC Server: https://github.com/meetecho/janus-gateway\n[5] Nginx: https://nginx.org/\n[6] SRS: https://github.com/ossrs/srs\n[7] MediaSoup: https://github.com/versatica/mediasoup\n[8] 异步回调问题: http://callbackhell.com/\n[9] Envoy线程模型: https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310\n[10] Envoy: https://www.loggly.com/blog/benchmarking-5-popular-load-balancers-nginx-haproxy-envoy-traefik-and-alb/\n[11] 完全非阻塞: https://dropbox.tech/infrastructure/how-we-migrated-dropbox-from-nginx-to-envoy\n[12] #2188: https://github.com/ossrs/srs/issues/2188\n[13] feature/threads: https://github.com/winlinvip/srs/tree/feature/threads\n[14] ECS/G5-2.5GHZ(SkyLake): https://help.aliyun.com/document_detail/25378.html\n[15] SRS/v4.0.105: https://github.com/ossrs/srs/commit/2ad24b2313e88a85801deaea370204f225555939\n[16] NginxRTMP/v1.2.1: https://github.com/arut/nginx-rtmp-module/releases/tag/v1.2.1\n[17] srs-bench: https://github.com/ossrs/srs-bench/tree/feature/rtc#usage\n[18] 网卡队列缓冲区: https://www.jianshu.com/p/6d4a89359352\n[19] 网卡队列缓冲区: https://www.jianshu.com/p/6d4a89359352\n[20] webrtc://8.126.115.13:1985/live/livestream100?eip=8.126.115.13: http://localhost/players/rtc_player.html?autostart=true&api=1985&eip=8.126.115.13&server=8.126.115.13&vhost=8.126.115.13&stream=livestream100\n[21] srs-bench: https://github.com/ossrs/srs-bench/tree/feature/rtc#usage\n[22] SRS性能(CPU)、内存优化工具用法: https://www.jianshu.com/p/6d4a89359352\n[23] ECS ecs.c5.large: https://help.aliyun.com/document_detail/25378.html#c5\n[24] ECS ecs.c5.xlarge: https://help.aliyun.com/document_detail/25378.html#c5\n[25] ECS ecs.c5.2xlarge: https://help.aliyun.com/document_detail/25378.html#c5\n[26] G5: https://help.aliyun.com/document_detail/25378.html#g5\n[27] R5: https://help.aliyun.com/document_detail/25378.html#r5\n[28] UDP/sendmmsg: https://github.com/ossrs/srs/issues/307#issuecomment-609020985\n[29] UDP/GSO: https://github.com/ossrs/srs/issues/307#issuecomment-612953502\n[30] UDP/sendmmsg: https://github.com/ossrs/srs/issues/307#issuecomment-609020985\n[31] UDP/GSO: https://github.com/ossrs/srs/issues/307#issuecomment-612953502\n[32] ZERO-COPY: https://github.com/ossrs/srs/issues/307#issuecomment-615884074\n[33] Envoy线程模型: https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310\n[34] #2188: https://github.com/ossrs/srs/issues/2188\n[35] feature/threads: https://github.com/winlinvip/srs/tree/feature/threads\n[36] AVX512: https://zhuanlan.zhihu.com/p/83399457\n[37] DPDK: https://www.dpdk.org/","brief":"📷\n性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有...","summary":"性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战...","abstract":"性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战...","posterSummary":"性能无疑是服务器的核心能力，几乎每个开源服务器的介绍都是”高性能XXX服务器“。视频服务器由于业务的超复杂度，特别是WebRTC服务器，要做到高性能是非常有挑战的难点。 为何性能很重要？完备的功能需要用性能交换，安全性需要用性能交换，成本需要用性能交换，产品体验需要用性能交换，甚至系统弹性都需要性能交换。有了基础性能，就有了竞争力的资本；基础性能若有问题，举步维艰，想要干点啥都不容易，就像天生羸弱...","description":"","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":4,"channelDetail":{"source":"wechat","originalTime":"2021-05-26","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":1647594795,"updateTime":1647594795,"viewCount":207,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"keywords":[],"focusRead":false,"publishTime":1647594795,"editTime":0,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true,"badgeInfo":{},"statInfo":{"articleCount":99,"validArticleCount":99,"joinedColumnCount":1,"followColumnCount":4,"uid":8722662,"beLikeNum":197,"articleReadNum":20795,"articleRecommNum":0,"answerRecommNum":0,"contribNum":0,"createTime":"2022-03-18 17:13:35","articleCommentNum":0,"articleFavNum":1,"yesterdayBeLikeNum":197,"yesterdayArticleReadNum":20779,"yesterdayArticleRecommNum":0,"yesterdayAnswerRecommNum":0,"yesterdayContribNum":0,"yesterdayArticleCommentNum":0,"yesterdayArticleFavNum":1},"rank":4098,"userTeams":[],"fromInfo":{}},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062,"creator":{"8722662":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true}}},"translator":{},"textLinks":[{"text":"服务器","link":"https://cloud.tencent.com/product/cvm","mark":"375_1958592"},{"text":"直播","link":"https://cloud.tencent.com/product/css","mark":"850_1958592"},{"text":"直播分发","link":"https://cloud.tencent.com/product/lvb","mark":"855_1958592"}]},"articleAuditInfo":null,"commentsData":{"fetchStatus":"none","pageNumber":1,"pageSize":10,"total":0,"list":[]},"hotArticleList":[{"id":121888,"weight":1660213239,"type":8,"detail":{"abstract":"首先感谢主办方提供这次活动，依旧是不收一分钱外加顺丰特快包邮，这条件甚至要优于自己上大学的时候，毕竟那时候学习在用的开发板还都是自己买的呢……虽然报名的晚，但是汪总还是给通过了，再次感谢下，其实报名晚的其中一个原因是在想要做的方向，所以没有着急填表，结果没想到就鸽到了最后……","articleId":2070217,"coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-226318/e08e4157ab91f1724b894d02697e015f.png","weight":1660213239,"avatar":"https://ask.qcloudimg.com/http-save/yehe-226318/e08e4157ab91f1724b894d02697e015f.png","author":{"id":226318,"name":"远哥制造","label":"得之坦然，失之淡然，顺其自然，争其必然！","avatar":"https://ask.qcloudimg.com/http-save/yehe-226318/kholkg4xex.jpeg","company":"思科技术服务(大连)","title":"后端开发工程师","isProfessionVerified":true},"authorBadgeInfo":{}},"createTime":1660213239,"objId":2070217,"entry":0,"readNum":84,"showReadNum":189,"abstract":"首先感谢主办方提供这次活动，依旧是不收一分钱外加顺丰特快包邮，这条件甚至要优于自己上大学的时候，毕竟那时候学习在用的开发板还都是自己买的呢……虽然报名的晚，但是汪总还是给通过了，再次感谢下，其实报名晚的其中一个原因是在想要做的方向，所以没有着急填表，结果没想到就鸽到了最后……","articleId":2070217,"coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-226318/e08e4157ab91f1724b894d02697e015f.png","avatar":"https://ask.qcloudimg.com/http-save/yehe-226318/e08e4157ab91f1724b894d02697e015f.png","title":"开发者成长激励计划-基于 TencentOS Tiny 的 Smart RGB Light DIY 之路","writeTime":1660146995,"tags":[{"tagId":11050,"tagName":"TencentOS Tiny"}],"picture":"https://ask.qcloudimg.com/http-save/yehe-226318/e08e4157ab91f1724b894d02697e015f.png","author":{"id":226318,"name":"远哥制造","avatar":"https://ask.qcloudimg.com/http-save/yehe-226318/kholkg4xex.jpeg"}},{"id":121886,"weight":1660213237,"type":8,"detail":{"abstract":"Techo Youth 系列直播已经完美收官啦！直播第三期，我们邀请了腾讯TAPD产品解决方案架构师鞠武军老师，以及众言科技SPSSPro产品&运营总监魏陆炀，与我们一起深度探讨了，「职场预习课：开发者如何高效协同？」如果错过了上期的直播，今天的直播精华总结可千万不要错过哦！","articleId":2070566,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/khaoago8j5.jpg","weight":1660213237,"avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/khaoago8j5.jpg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","label":"腾讯云HiFlow场景连接器，你的应用连接自动化助手！","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/iahfcf4485.jpg","company":"腾讯云","title":"产品运营","isProfessionVerified":true},"authorBadgeInfo":{}},"createTime":1660213237,"objId":2070566,"entry":0,"readNum":6,"showReadNum":29,"abstract":"Techo Youth 系列直播已经完美收官啦！直播第三期，我们邀请了腾讯TAPD产品解决方案架构师鞠武军老师，以及众言科技SPSSPro产品&运营总监魏陆炀，与我们一起深度探讨了，「职场预习课：开发者如何高效协同？」如果错过了上期的直播，今天的直播精华总结可千万不要错过哦！","articleId":2070566,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/khaoago8j5.jpg","avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/khaoago8j5.jpg","title":"B端增长黑客：如何打造百万用户？","writeTime":1660203606,"tags":[{"tagId":11066,"tagName":"腾讯云HiFlow场景连接器"}],"picture":"https://ask.qcloudimg.com/article-cover-image/9261854/khaoago8j5.jpg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/iahfcf4485.jpg"}},{"id":121884,"weight":1660213226,"type":8,"detail":{"abstract":"深度神经网络（Deep Neural Networks，DNN）可以理解为有很多隐藏层的神经网络，又被称为深度前馈网络，多层感知机。","articleId":2068480,"coverImageUrl":"https://share-10039692.file.myqcloud.com/lab/a17bac8dbb/image/jsaj98sn35/neural_network.png","weight":1660213226,"avatar":"https://share-10039692.file.myqcloud.com/lab/a17bac8dbb/image/jsaj98sn35/neural_network.png","author":{"id":7922550,"name":"SimpleAstronaut","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/efb2e90e364896399bb3e59e39b723d5.jpeg","company":"简单设计","title":"","isProfessionVerified":false},"authorBadgeInfo":{}},"createTime":1660213226,"objId":2068480,"entry":0,"readNum":17,"showReadNum":84,"abstract":"深度神经网络（Deep Neural Networks，DNN）可以理解为有很多隐藏层的神经网络，又被称为深度前馈网络，多层感知机。","articleId":2068480,"coverImageUrl":"https://share-10039692.file.myqcloud.com/lab/a17bac8dbb/image/jsaj98sn35/neural_network.png","avatar":"https://share-10039692.file.myqcloud.com/lab/a17bac8dbb/image/jsaj98sn35/neural_network.png","title":"TensorFlow实现深层神经网络","writeTime":1660009182,"tags":[],"picture":"https://share-10039692.file.myqcloud.com/lab/a17bac8dbb/image/jsaj98sn35/neural_network.png","author":{"id":7922550,"name":"SimpleAstronaut","avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/efb2e90e364896399bb3e59e39b723d5.jpeg"}},{"id":121882,"weight":1660213224,"type":8,"detail":{"abstract":"检索式增强在各种自然语言处理任务中被广泛应用，其主要目的是基于一定的检索范式来利用现存数据，影响模型最终得到的结果，从而降低模型参数的负担。之前澜舟公众号已经发布了一篇相关的论文领读《别再第四范式：看看新热点检索增强怎么做文本生成！》对检索增强的任务进行了概述。本文我们聚焦在机器翻译领域，介绍在机器翻译中最新的利用检索来进行增强的范式！","articleId":2066867,"coverImageUrl":"https://ask.qcloudimg.com/http-save/9823107/1cc33b99d12549b0b7d9a6e356a1ef66.png","weight":1660213224,"avatar":"https://ask.qcloudimg.com/http-save/9823107/1cc33b99d12549b0b7d9a6e356a1ef66.png","author":{"id":9823107,"name":"澜舟科技","label":"澜舟科技是一家认知智能公司，针对商业场景数字化转型、以自然语言处理为基础提供商业洞见类产品。","avatar":"https://ask.qcloudimg.com/http-save/yehe-9823107/5d0dd16a18f9ced0189fe475367110bf.jpeg","company":"langboat.com","title":"","isProfessionVerified":false},"authorBadgeInfo":{}},"createTime":1660213224,"objId":2066867,"entry":0,"readNum":12,"showReadNum":84,"abstract":"检索式增强在各种自然语言处理任务中被广泛应用，其主要目的是基于一定的检索范式来利用现存数据，影响模型最终得到的结果，从而降低模型参数的负担。之前澜舟公众号已经发布了一篇相关的论文领读《别再第四范式：看看新热点检索增强怎么做文本生成！》对检索增强的任务进行了概述。本文我们聚焦在机器翻译领域，介绍在机器翻译中最新的利用检索来进行增强的范式！","articleId":2066867,"coverImageUrl":"https://ask.qcloudimg.com/http-save/9823107/1cc33b99d12549b0b7d9a6e356a1ef66.png","avatar":"https://ask.qcloudimg.com/http-save/9823107/1cc33b99d12549b0b7d9a6e356a1ef66.png","title":"NLP 论文领读｜无参数机器翻译遇上对比学习：效率和性能我全都要！","writeTime":1659679477,"tags":[{"tagId":10146,"tagName":"自然语言处理"},{"tagId":10468,"tagName":"机器翻译"},{"tagId":10149,"tagName":"机器学习"},{"tagId":10333,"tagName":"深度学习"},{"tagId":10539,"tagName":"AI 人工智能"}],"picture":"https://ask.qcloudimg.com/http-save/9823107/1cc33b99d12549b0b7d9a6e356a1ef66.png","author":{"id":9823107,"name":"澜舟科技","avatar":"https://ask.qcloudimg.com/http-save/yehe-9823107/5d0dd16a18f9ced0189fe475367110bf.jpeg"}},{"id":121880,"weight":1660198286,"type":8,"detail":{"abstract":"为了给大家提供更好的文档服务，我们诚邀您参加2022年腾讯云产品文档满意度调查，将您的使用感受和建议告诉我们，您的意见将用于文档体验改进。","articleId":2070334,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/1000244/ryus7fckdp.jpg","weight":1660198286,"avatar":"https://ask.qcloudimg.com/article-cover-image/1000244/ryus7fckdp.jpg","author":{"id":1000244,"name":"腾讯云文档","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-1000244/cqq6tnzeh3.jpeg","company":"腾讯计算机系统有限公司","title":"","isProfessionVerified":false},"authorBadgeInfo":{}},"createTime":1660198286,"objId":2070334,"entry":0,"readNum":18,"showReadNum":53,"abstract":"为了给大家提供更好的文档服务，我们诚邀您参加2022年腾讯云产品文档满意度调查，将您的使用感受和建议告诉我们，您的意见将用于文档体验改进。","articleId":2070334,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/1000244/ryus7fckdp.jpg","avatar":"https://ask.qcloudimg.com/article-cover-image/1000244/ryus7fckdp.jpg","title":"【有奖】腾讯云产品文档满意度调研","writeTime":1660189612,"tags":[{"tagId":137,"tagName":"官方文档"}],"picture":"https://ask.qcloudimg.com/article-cover-image/1000244/ryus7fckdp.jpg","author":{"id":1000244,"name":"腾讯云文档","avatar":"https://ask.qcloudimg.com/http-save/yehe-1000244/cqq6tnzeh3.jpeg"}},{"id":121878,"weight":1660198285,"type":8,"detail":{"abstract":"众所周知，Redis是一款性能强悍的中间件。那么它的性能到底多强，大家也是只拿到的是官方给到的数据，那么真实情况是否真的是这样? 带着这个疑问，挑选了Redis单机与集群做压测，得到性能数据，并分析两者性能的关系是否是线性的。","articleId":2070322,"coverImageUrl":"https://ask.qcloudimg.com/http-save/9927536/6243c59d200c7d5e7eb89073c3bc018a.jpeg","weight":1660198285,"avatar":"https://ask.qcloudimg.com/http-save/9927536/6243c59d200c7d5e7eb89073c3bc018a.jpeg","author":{"id":9927536,"name":"得物技术","label":"「公众号 @ 得物技术」","avatar":"https://ask.qcloudimg.com/http-save/yehe-9927536/dce841bebb4590591822b4495407f2bf.jpeg","company":"得物App","title":"技术运营","isProfessionVerified":true},"authorBadgeInfo":{}},"createTime":1660198285,"objId":2070322,"entry":0,"readNum":9,"showReadNum":48,"abstract":"众所周知，Redis是一款性能强悍的中间件。那么它的性能到底多强，大家也是只拿到的是官方给到的数据，那么真实情况是否真的是这样? 带着这个疑问，挑选了Redis单机与集群做压测，得到性能数据，并分析两者性能的关系是否是线性的。","articleId":2070322,"coverImageUrl":"https://ask.qcloudimg.com/http-save/9927536/6243c59d200c7d5e7eb89073c3bc018a.jpeg","avatar":"https://ask.qcloudimg.com/http-save/9927536/6243c59d200c7d5e7eb89073c3bc018a.jpeg","title":"Redis常用集群以及性能压测实战","writeTime":1660187659,"tags":[{"tagId":10249,"tagName":"Redis"}],"picture":"https://ask.qcloudimg.com/http-save/9927536/6243c59d200c7d5e7eb89073c3bc018a.jpeg","author":{"id":9927536,"name":"得物技术","avatar":"https://ask.qcloudimg.com/http-save/yehe-9927536/dce841bebb4590591822b4495407f2bf.jpeg"}},{"id":121876,"weight":1660198283,"type":8,"detail":{"abstract":"频道机器人是基于QQ开放生态的高级扩展服务，通过开放的接口，能够与QQ频道用户实现交互形式丰富的互动。","articleId":2068473,"coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-7922550/4a39b0f3208032b70000e282aecc9536.png","weight":1660198283,"avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/4a39b0f3208032b70000e282aecc9536.png","author":{"id":7922550,"name":"SimpleAstronaut","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/efb2e90e364896399bb3e59e39b723d5.jpeg","company":"简单设计","title":"","isProfessionVerified":false},"authorBadgeInfo":{}},"createTime":1660198283,"objId":2068473,"entry":0,"readNum":15,"showReadNum":79,"abstract":"频道机器人是基于QQ开放生态的高级扩展服务，通过开放的接口，能够与QQ频道用户实现交互形式丰富的互动。","articleId":2068473,"coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-7922550/4a39b0f3208032b70000e282aecc9536.png","avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/4a39b0f3208032b70000e282aecc9536.png","title":"python实现qq频道机器人开发","writeTime":1660008662,"tags":[],"picture":"https://ask.qcloudimg.com/http-save/yehe-7922550/4a39b0f3208032b70000e282aecc9536.png","author":{"id":7922550,"name":"SimpleAstronaut","avatar":"https://ask.qcloudimg.com/http-save/yehe-7922550/efb2e90e364896399bb3e59e39b723d5.jpeg"}},{"id":121874,"weight":1660198282,"type":8,"detail":{"abstract":"弹性容器服务（Elastic Kubernetes Service，EKS）是腾讯云容器服务推出的无须用户购买节点即可部署工作负载的服务模式。弹性容器服务 EKS 完全兼容原生 Kubernetes，支持使用原生方式购买及管理资源，按照容器真实使用的资源量计费。弹性容器服务 EKS 还扩展支持腾讯云的存储及网络等产品，同时确保用户容器的安全隔离，开箱即用。","articleId":2070407,"coverImageUrl":"","weight":1660198282,"avatar":"//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":5954574,"name":"聂伟星","label":"主要从事公有云运维工作","avatar":"https://ask.qcloudimg.com/http-save/yehe-5954574/tiyzxdudvz.jpeg","company":"腾云悦智","title":"公有云运维","isProfessionVerified":true},"authorBadgeInfo":{}},"createTime":1660198282,"objId":2070407,"entry":0,"readNum":9,"showReadNum":38,"abstract":"弹性容器服务（Elastic Kubernetes Service，EKS）是腾讯云容器服务推出的无须用户购买节点即可部署工作负载的服务模式。弹性容器服务 EKS 完全兼容原生 Kubernetes，支持使用原生方式购买及管理资源，按照容器真实使用的资源量计费。弹性容器服务 EKS 还扩展支持腾讯云的存储及网络等产品，同时确保用户容器的安全隔离，开箱即用。","articleId":2070407,"coverImageUrl":"","avatar":"//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"EKS集群如何部署docker客户端工具","writeTime":1660196456,"tags":[],"picture":"","author":{"id":5954574,"name":"聂伟星","avatar":"https://ask.qcloudimg.com/http-save/yehe-5954574/tiyzxdudvz.jpeg"}},{"id":121872,"weight":1660198272,"type":8,"detail":{"abstract":"为了更好地进行解释，我创建了一个存储引擎为InnoDB的表user_innodb，并批量初始化了500W+条数据。包含主键id、姓名字段（name）、性别字段（gender，用0，1表示不同性别）、手机号字段（phone），并为name和phone字段创建了联合索引。","articleId":2070223,"coverImageUrl":"https://ask.qcloudimg.com/http-save/8139881/59c78abd7dea89abcdda84d1911fb96a.png","weight":1660198272,"avatar":"https://ask.qcloudimg.com/http-save/8139881/59c78abd7dea89abcdda84d1911fb96a.png","author":{"id":8139881,"name":"蝉沐风","label":"公众号@蝉沐风","avatar":"https://ask.qcloudimg.com/http-save/yehe-8139881/97dfa65199223864737da7602366f315.jpeg","company":"","title":"","isProfessionVerified":false},"authorBadgeInfo":{}},"createTime":1660198272,"objId":2070223,"entry":0,"readNum":21,"showReadNum":28,"abstract":"为了更好地进行解释，我创建了一个存储引擎为InnoDB的表user_innodb，并批量初始化了500W+条数据。包含主键id、姓名字段（name）、性别字段（gender，用0，1表示不同性别）、手机号字段（phone），并为name和phone字段创建了联合索引。","articleId":2070223,"coverImageUrl":"https://ask.qcloudimg.com/http-save/8139881/59c78abd7dea89abcdda84d1911fb96a.png","avatar":"https://ask.qcloudimg.com/http-save/8139881/59c78abd7dea89abcdda84d1911fb96a.png","title":"你必须懂的一些MySQL索引技巧","writeTime":1660175176,"tags":[{"tagId":10245,"tagName":"MySQL"}],"picture":"https://ask.qcloudimg.com/http-save/8139881/59c78abd7dea89abcdda84d1911fb96a.png","author":{"id":8139881,"name":"蝉沐风","avatar":"https://ask.qcloudimg.com/http-save/yehe-8139881/97dfa65199223864737da7602366f315.jpeg"}},{"id":121870,"weight":1660198269,"type":8,"detail":{"abstract":"可能有些小伙伴已经留意到了，最近腾讯文档新推出了一个“智能表”的功能，在“在线表格”的左下角，点击“新建空白智能表”，你就可以获得一个全新的腾讯文档智能表啦！那腾讯文档智能表和普通的工作表又有什么不同呢？","articleId":2070149,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/actdw10lna.jpeg","weight":1660198269,"avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/actdw10lna.jpeg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","label":"腾讯云HiFlow场景连接器，你的应用连接自动化助手！","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/iahfcf4485.jpg","company":"腾讯云","title":"产品运营","isProfessionVerified":true},"authorBadgeInfo":{}},"createTime":1660198269,"objId":2070149,"entry":0,"readNum":27,"showReadNum":79,"abstract":"可能有些小伙伴已经留意到了，最近腾讯文档新推出了一个“智能表”的功能，在“在线表格”的左下角，点击“新建空白智能表”，你就可以获得一个全新的腾讯文档智能表啦！那腾讯文档智能表和普通的工作表又有什么不同呢？","articleId":2070149,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/actdw10lna.jpeg","avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/actdw10lna.jpeg","title":"腾讯文档智能表格定时自动提醒如何设置？","writeTime":1660136176,"tags":[{"tagId":11066,"tagName":"腾讯云HiFlow场景连接器"}],"picture":"https://ask.qcloudimg.com/article-cover-image/9261854/actdw10lna.jpeg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/iahfcf4485.jpg"}}],"relatedArticles":[{"id":1958540,"articleId":1958540,"title":"比nginx-rtmp高三倍性能的SRS的高性能是个什么球？","content":"","plain":"","brief":"","summary":"SRS单进程能支持9000并发，nginx-rtmp单进程最多支持3000个，单进程的性能SRS是nginx-rtmp的三倍。SRS单进程性能如何做到nginx...","abstract":"SRS单进程能支持9000并发，nginx-rtmp单进程最多支持3000个，单进程的性能SRS是nginx-rtmp的三倍。SRS单进程性能如何做到nginx...","posterSummary":"SRS单进程能支持9000并发，nginx-rtmp单进程最多支持3000个，单进程的性能SRS是nginx-rtmp的三倍。SRS单进程性能如何做到nginx-rtmp的三倍的？SRS哪几个结构极大提升了性能？ 先来看看我们遇到的问题，RTMP协议和HTTP协议是又很大不同的。nginx在分发HLS，即m3u8文本文件和ts视频文件时，对所有连接发送的都是同一个内容，甚至可以调用sendfile...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2015-03-19","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"winlin"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":100,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1871237,"articleId":1871237,"title":"开源圆桌 Q&A 集锦","content":"","plain":"","brief":"","summary":" 段维伟-使用 Flutter 2.0 开发多平台 VOIP/WebRTC 客户端 \n","abstract":" 段维伟-使用 Flutter 2.0 开发多平台 VOIP/WebRTC 客户端 \n","posterSummary":"","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-5720403/2924892d2d1002308fccb6aea086710d.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-5720403/2924892d2d1002308fccb6aea086710d.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-05-29","author":"LiveVideoStack","nickName":"LiveVideoStack","userName":"gh_85fd67a0b081","alias":"livevideostack","authorName":"LiveVideoStack"},"authorId":5720403,"columnId":78213,"writeTime":0,"updateTime":0,"viewCount":100,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":5720403,"name":"LiveVideoStack","label":"专注在音视频领域的技术社区，推动相关开源项目与最佳实践普及和传播，帮助技术人成长，解决企业技术难点。","avatar":"https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg","company":"","title":"","isProfessionVerified":false},"column":{"id":78213,"name":"音视频技术","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png","background":"","status":2,"creatorId":5720403,"memberCount":1,"articleCount":972,"followCount":257,"createdTime":1561704143}},{"id":1958583,"articleId":1958583,"title":"LVS分享SRS：从开源到商业服务的万水千山","content":"","plain":"","brief":"","summary":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？\n  个人...","abstract":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？\n  个人...","posterSummary":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？\n  个人介绍 大家好，我是杨成立（忘篱），目前在阿里云负责RTC的传输网络，之前在蓝汛CDN负责直播的传输网络，这十年左右一直在做视频的后端服务，也是开源视频服务器SRS的作者，SRS目前是全球Top1的开源视频服务器。 后端服务都架构在云上，CD...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-04-17","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":148,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1871245,"articleId":1871245,"title":"RTC服务架构演进——边缘云原生方向","content":"","plain":"","brief":"","summary":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？本次Liv...","abstract":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？本次Liv...","posterSummary":"音视频服务器要解决的核心问题是一样的，因此无论哪个公司的服务，都不会从0开始码代码，都会基于开源项目改。那么从开源到能提供商业服务，到底有哪些路要走？本次LiveVideoStackCon 2021 上海站中，我们邀请到了阿里云RTC传输网络负责人杨成立（忘篱）为我们从边缘云原生的角度详细解析RTC服务架构的演进。","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-5720403/bfe59d54da878b3f5d4b4285ad605415.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-5720403/bfe59d54da878b3f5d4b4285ad605415.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-05-15","author":"LiveVideoStack","nickName":"LiveVideoStack","userName":"gh_85fd67a0b081","alias":"livevideostack","authorName":"ossrs"},"authorId":5720403,"columnId":78213,"writeTime":0,"updateTime":0,"viewCount":254,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":5720403,"name":"LiveVideoStack","label":"专注在音视频领域的技术社区，推动相关开源项目与最佳实践普及和传播，帮助技术人成长，解决企业技术难点。","avatar":"https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg","company":"","title":"","isProfessionVerified":false},"column":{"id":78213,"name":"音视频技术","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png","background":"","status":2,"creatorId":5720403,"memberCount":1,"articleCount":972,"followCount":257,"createdTime":1561704143}},{"id":1958544,"articleId":1958544,"title":"在HLS上花10倍的代码，SRS值得个球吗？","content":"","plain":"","brief":"","summary":"移动端发展速度已经不用科普了，移动端的流媒体用什么分发？SRS为何要重写HLS和HTTP？为什么说SRS才是标准移动端的流媒体服务器？ 移动端是个可以好好装逼的...","abstract":"移动端发展速度已经不用科普了，移动端的流媒体用什么分发？SRS为何要重写HLS和HTTP？为什么说SRS才是标准移动端的流媒体服务器？ 移动端是个可以好好装逼的...","posterSummary":"移动端发展速度已经不用科普了，移动端的流媒体用什么分发？SRS为何要重写HLS和HTTP？为什么说SRS才是标准移动端的流媒体服务器？ 移动端是个可以好好装逼的领域，对于移动端流媒体更加是可以一装再装逼。这篇逼只是一个开头，这篇专门讲讲移动端会有哪些球会推出来。 接下来可能会陆续的装如下的逼： M3U8/TS到底有什么难的？坑有多大，坑里有多少个球？ 除HLS外，HTTP-FLV/MP3也是移动端...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2015-03-26","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"winlin"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":97,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958556,"articleId":1958556,"title":"SRS3 Release experimental MPEG-DASH","content":"","plain":"","brief":"","summary":"SRS3从2017.01月春节开始支持MPEG-DASH，2月份后支持了DVR MP4，3月份支持了MPD和init.mp4，5月份支持了MP4 Parser ...","abstract":"SRS3从2017.01月春节开始支持MPEG-DASH，2月份后支持了DVR MP4，3月份支持了MPD和init.mp4，5月份支持了MP4 Parser ...","posterSummary":"SRS3从2017.01月春节开始支持MPEG-DASH，2月份后支持了DVR MP4，3月份支持了MPD和init.mp4，5月份支持了MP4 Parser CLI，6月份支持了fMP4切片，可惜最终没有和JS播放器调通以实验性功能发布。 MPEG-DASH在国外用来替代HLS和RTMP，当然也用来替代HTTP-FLV，比如YouTube就有DASH的播放器，实际上DASH在Chrome中是属于...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2017-06-04","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"winlin"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":64,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958615,"articleId":1958615,"title":"SRS的2021，盐碱地里种西瓜的王婆","content":"","plain":"","brief":"","summary":"本来写了20380个字的年终总结，后来画了一张图差不多就说清楚了，压缩到了4131字，是下图大图哈，不是上面小图哈哈哈：  Note: 我本来准备了一堆的具体数...","abstract":"本来写了20380个字的年终总结，后来画了一张图差不多就说清楚了，压缩到了4131字，是下图大图哈，不是上面小图哈哈哈：  Note: 我本来准备了一堆的具体数...","posterSummary":"本来写了20380个字的年终总结，后来画了一张图差不多就说清楚了，压缩到了4131字，是下图大图哈，不是上面小图哈哈哈：  Note: 我本来准备了一堆的具体数字，后来我仔细想了想，数字似乎看起来挺有说服力，可惜不能证伪，所以并没有实际价值，干脆用这张定性的图更好点。 •伸手党：不能自理的用户，往往可能不是水平差，而是不想自己花时间，不看文档就提问，抓住一个人溺水式提问——问死你，伸手党是绝对的贬...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-12-31","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":85,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":2039719,"articleId":2039719,"title":"SRS5第一大炮：如何实现SRT协程化","content":"","plain":"","brief":"","summary":"Coroutine Native SRT\nWritten by John[1], Winlin[2]\n协程是现代服务器的核心技术，能极大简化逻辑和提升维护性；S...","abstract":"Coroutine Native SRT\nWritten by John[1], Winlin[2]\n协程是现代服务器的核心技术，能极大简化逻辑和提升维护性；S...","posterSummary":"Coroutine Native SRT\nWritten by John[1], Winlin[2]\n协程是现代服务器的核心技术，能极大简化逻辑和提升维护性；SRT是逐渐在取代RTMP推流的新协议，但它有自己的IO框架；只有实现了SRT的协程化，才能成为SRS的核心的成熟的协议，这是SRS 5.0迈出的第一步，也是至关重要的一步。\nSRS 5.0从2022年初启动以来，经过摸索和探讨，确定了以媒体...","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-8722662/b2bfdc31032f2f2b955d4ac90291bb44.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-8722662/b2bfdc31032f2f2b955d4ac90291bb44.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2022-07-03","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"John"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":118,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958593,"articleId":1958593,"title":"如何选择音视频开源项目，避坑指南，入坑躺平","content":"","plain":"","brief":"","summary":"音视频业务的繁荣，必定造就开源项目的繁荣，反过来说也是一样的，互相成就。遍地都是开源的轮子，如何选择？提供一个有效的角度，可作为避坑指南。如果已经入坑了，您躺平...","abstract":"音视频业务的繁荣，必定造就开源项目的繁荣，反过来说也是一样的，互相成就。遍地都是开源的轮子，如何选择？提供一个有效的角度，可作为避坑指南。如果已经入坑了，您躺平...","posterSummary":"音视频业务的繁荣，必定造就开源项目的繁荣，反过来说也是一样的，互相成就。遍地都是开源的轮子，如何选择？提供一个有效的角度，可作为避坑指南。如果已经入坑了，您躺平就好，入坑就已经有了门户之见，死生有命富贵在天。 活跃程度 活跃程度，就是项目的年龄和更新频率。 活得久就活得越久，一般活几年的项目谁不遇到点问题，要死早死了，几年还没死那可能后面死的概率也小了。 不更新的项目就是坑了，没有哪个开源项目拿来...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-06-02","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":108,"likeCount":4,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958545,"articleId":1958545,"title":"SRS的Simple架构，如何简化N个数量级？","content":"","plain":"","brief":"","summary":"SRS最关键是Simple，最简单的方案就是最佳方案；这个文章记录了SRS关键的Simple方案，也就是50%代码完成200%功能，100%代码完成400%功能...","abstract":"SRS最关键是Simple，最简单的方案就是最佳方案；这个文章记录了SRS关键的Simple方案，也就是50%代码完成200%功能，100%代码完成400%功能...","posterSummary":"SRS最关键是Simple，最简单的方案就是最佳方案；这个文章记录了SRS关键的Simple方案，也就是50%代码完成200%功能，100%代码完成400%功能的要点。 State Threads ST带来的问题简化，在一个状态空间时至少一个数量级；多个状态空间时就是百个数量级，譬如edge回源，http-flv和hstrs。在网络服务器中st的思路是与众不同，也是很巧妙的思路。 SRS是单进程使...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2015-04-01","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"winlin"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":122,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":2010293,"articleId":2010293,"title":"SRS：流媒体服务器如何实现负载均衡","content":"","plain":"","brief":"","summary":" 点击上方“LiveVideoStack”关注我们\n作者：Winlin、Azusachino、Benjamin\n编辑：Alex\n\n▲扫描图中二维码或点击阅读原文...","abstract":" 点击上方“LiveVideoStack”关注我们\n作者：Winlin、Azusachino、Benjamin\n编辑：Alex\n\n▲扫描图中二维码或点击阅读原文...","posterSummary":" 点击上方“LiveVideoStack”关注我们\n作者：Winlin、Azusachino、Benjamin\n编辑：Alex\n\n▲扫描图中二维码或点击阅读原文▲\n\n了解音视频技术大会更多信息\n----\n当我们的业务超过单台流媒体服务器的承受能力，就会遇到负载均衡问题，一般我们会在集群中提供这种能力，但实际上集群并非是唯一的实现方式。有时候负载均衡还会和服务发现等时髦词汇联系起来，而云服务的Loa...","description":"","picture":"https://ask.qcloudimg.com/http-save/5720403/5ac19b382790691990d92e065d882e84.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/5720403/5ac19b382790691990d92e065d882e84.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2022-05-24","author":"LiveVideoStack","nickName":"LiveVideoStack","userName":"gh_85fd67a0b081","alias":"livevideostack","authorName":"Winlin"},"authorId":5720403,"columnId":78213,"writeTime":0,"updateTime":0,"viewCount":153,"likeCount":4,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":5720403,"name":"LiveVideoStack","label":"专注在音视频领域的技术社区，推动相关开源项目与最佳实践普及和传播，帮助技术人成长，解决企业技术难点。","avatar":"https://ask.qcloudimg.com/custom-avatar/5720403/q27qk5olw.jpg","company":"","title":"","isProfessionVerified":false},"column":{"id":78213,"name":"音视频技术","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png","background":"","status":2,"creatorId":5720403,"memberCount":1,"articleCount":972,"followCount":257,"createdTime":1561704143}},{"id":1958546,"articleId":1958546,"title":"深入浅出看流媒体前世今生，分分钟二逼变牛逼","content":"","plain":"","brief":"","summary":"CDN这几年爆炸式增长，带宽提速是根源，而HTTP始终还是那个屌样，因此目前CDN大多是资本性行业，不用多少知识就能干了；直到流媒体粗现，直播咋这么难搞呢？因为...","abstract":"CDN这几年爆炸式增长，带宽提速是根源，而HTTP始终还是那个屌样，因此目前CDN大多是资本性行业，不用多少知识就能干了；直到流媒体粗现，直播咋这么难搞呢？因为...","posterSummary":"CDN这几年爆炸式增长，带宽提速是根源，而HTTP始终还是那个屌样，因此目前CDN大多是资本性行业，不用多少知识就能干了；直到流媒体粗现，直播咋这么难搞呢？因为它是流媒体，让我带你深入浅出看流媒体前世今生，分分钟二逼变牛逼。 流媒体分为点播和直播，点播已经堕落为HTTP文件了，直播永远不可能只用HTTP就OK，这是他们的业务差异导致的。流媒体本质上是：现实的图像，经过编码器压缩，持久化为点播文件或...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2015-04-18","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"winlin"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":113,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958625,"articleId":1958625,"title":"云SRS：直播转发多平台","content":"","plain":"","brief":"","summary":"在多个平台做直播是一个常用的功能，也有不少平台支持这个功能，体验过一些还是不太好用。简单易用，开箱即用，还是要看SRS云服务器的。 Why 为何要推流到多个直播...","abstract":"在多个平台做直播是一个常用的功能，也有不少平台支持这个功能，体验过一些还是不太好用。简单易用，开箱即用，还是要看SRS云服务器的。 Why 为何要推流到多个直播...","posterSummary":"在多个平台做直播是一个常用的功能，也有不少平台支持这个功能，体验过一些还是不太好用。简单易用，开箱即用，还是要看SRS云服务器的。 Why 为何要推流到多个直播平台？因为直播的内容往往需要在多个渠道传播，比如： •在不同的直播平台直播，视频号直播，B站直播，快手和抖音直播，同样的内容，在多个平台一起播出，观看的人会更多。•在一个平台的不同账号直播，比如视频号直播，可能会有不同的账号，不同的主体或者...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2022-03-05","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":358,"likeCount":2,"commentCount":0,"favorCount":1,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1958586,"articleId":1958586,"title":"劳动节之一：SRS中RTC基于流的场景应用，RTC和RTMP流互相转换","content":"","plain":"","brief":"","summary":"大约在一年前，SRS开始支持了WebRTC，这一年一直在持续的更新和收集大家的反馈，终于目前达到了基本可以的里程碑了，是时候总结下使用方法，更新Wiki和DEM...","abstract":"大约在一年前，SRS开始支持了WebRTC，这一年一直在持续的更新和收集大家的反馈，终于目前达到了基本可以的里程碑了，是时候总结下使用方法，更新Wiki和DEM...","posterSummary":"大约在一年前，SRS开始支持了WebRTC，这一年一直在持续的更新和收集大家的反馈，终于目前达到了基本可以的里程碑了，是时候总结下使用方法，更新Wiki和DEMO，方便大家用起来了。 SRS的RTC有很多种应用场景，这篇是基于流的场景的应用，后续会推出更多的场景。流是服务器最基本也是最基础的逻辑，是其他场景的基础。基础不牢，地动山摇，大家走过路过不要错过。 RTC的Wiki请点文末阅读原文，我们在...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-05-01","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":353,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1786233,"articleId":1786233,"title":"SRS、EasyDarwin、ZLMediaKit、Monibuca对比分析","content":"","plain":"","brief":"","summary":"目前市面上有很多开源的流媒体服务器解决方案，常见的有SRS、EasyDarwin、ZLMediaKit和Monibuca等，我们应该怎么选择呢？","abstract":"目前市面上有很多开源的流媒体服务器解决方案，常见的有SRS、EasyDarwin、ZLMediaKit和Monibuca等，我们应该怎么选择呢？","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1678204,"columnId":90963,"writeTime":0,"updateTime":0,"viewCount":8892,"likeCount":6,"commentCount":0,"favorCount":3,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":1678204,"name":"liuzhen007","label":"本人一直从事音视频相关工作，拥有在传统广电巨头和互联网音视频公司工作的经历，具有丰富的音视频直播和点播相关经验，对WebRTC、FFmpeg和Electron有非常深入的了解。在CSDN上推出了很多音视频相关的技术专栏，累计产出了500余篇原创作品。同时，荣获了CSDN 2020年博客专家荣誉勋章和CSDN 2020年博客之星Top39荣誉称号。","avatar":"https://ask.qcloudimg.com/http-save/yehe-1678204/qqpdn3sxy4.jpeg","company":"百家云","title":"流媒体研发工程师","isProfessionVerified":true},"column":{"id":90963,"name":"流媒体音视频","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/3.png","background":"","status":2,"creatorId":1678204,"memberCount":1,"articleCount":41,"followCount":21,"createdTime":1612065530}},{"id":2001762,"articleId":2001762,"title":"SRS学习路径","content":"","plain":"","brief":"","summary":"新同学专用的学习路径，请一定按照文档操作。\n文章中有较多的链接，链接地址是在文末尾的。也可以点文末尾的阅读原文，查看本文在简书上的版本。\n快速预览\n先过第一个门...","abstract":"新同学专用的学习路径，请一定按照文档操作。\n文章中有较多的链接，链接地址是在文末尾的。也可以点文末尾的阅读原文，查看本文在简书上的版本。\n快速预览\n先过第一个门...","posterSummary":"新同学专用的学习路径，请一定按照文档操作。\n文章中有较多的链接，链接地址是在文末尾的。也可以点文末尾的阅读原文，查看本文在简书上的版本。\n快速预览\n先过第一个门槛：看到直播和WebRTC长什么样子，能跑出来下图的效果，需要5～15分钟左右。\n\nNote: 这个看似很容易，甚至直接在SRS官网[1]中就能点开两个页面，但是一定要自己用SRS搭建出来才算，而不是直接打开线上的演示网页。\n具体怎么做呢？...","description":"","picture":"https://ask.qcloudimg.com/http-save/8722662/feadd14720d36eb74223d7bcc694283f.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/8722662/feadd14720d36eb74223d7bcc694283f.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2022-05-12","author":"SRS开源服务器","nickName":"SRS开源服务器","userName":"gh_0fe2793e1d87","alias":"srs-server","authorName":"ossrs"},"authorId":8722662,"columnId":94785,"writeTime":0,"updateTime":0,"viewCount":123,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":8722662,"name":"Winlin","label":"我就是一个码农","avatar":"https://ask.qcloudimg.com/http-save/yehe-8722662/76a435c05b7e404349257e5c6c5e301d.jpeg","company":"腾讯云","title":"工程师","isProfessionVerified":true},"column":{"id":94785,"name":"SRS开源服务器","desc":"SRS is a simple, high efficiency and realtime video server, supports RTMP, WebRTC, HLS, HTTP-FLV and","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"","status":2,"creatorId":8722662,"memberCount":1,"articleCount":99,"followCount":17,"createdTime":1647588062}},{"id":1775831,"articleId":1775831,"title":"目前直播技术汇总及低延时直播的方案汇总","content":"","plain":"","brief":"","summary":"HLS：延迟主要来自编码解码时产生延迟、网络延迟、CDN 分发延迟。由于它是切片协议，延迟分两大块，一个是服务端有切片缓冲延迟，另一个是在播放端防抖缓冲会有延迟...","abstract":"HLS：延迟主要来自编码解码时产生延迟、网络延迟、CDN 分发延迟。由于它是切片协议，延迟分两大块，一个是服务端有切片缓冲延迟，另一个是在播放端防抖缓冲会有延迟...","posterSummary":"HLS：延迟主要来自编码解码时产生延迟、网络延迟、CDN 分发延迟。由于它是切片协议，延迟分两大块，一个是服务端有切片缓冲延迟，另一个是在播放端防抖缓冲会有延迟。切片的大小和数量都会 HLS 影响延迟大小，一般在十秒以上。","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-4140184/kdlht9zbrs.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-4140184/kdlht9zbrs.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"psvmc","originalTime":"2021-01-16"},"authorId":4140184,"columnId":82090,"writeTime":0,"updateTime":0,"viewCount":1960,"likeCount":1,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":4140184,"name":"剑行者","label":"","avatar":"https://ask.qcloudimg.com/custom-avatar/4140184/8t56vpcuxe.jpg","company":"","title":"","isProfessionVerified":false},"column":{"id":82090,"name":"码客","desc":"我是码客，我是全栈工程师，我为自己代言。","icon":"https://ask.qcloudimg.com/column-icons/82090/4140184/qbgw6q3l2y.jpg","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/2.svg","status":2,"creatorId":4140184,"memberCount":1,"articleCount":550,"followCount":47,"createdTime":1571379834}},{"id":1198404,"articleId":1198404,"title":"技术福利：最全实时音视频开发要用到的开源工程汇总","content":"","plain":"","brief":"","summary":"实时音视频的开发学习有很多可以参考的开源项目。一个实时音视频应用共包括几个环节：采集、编码、前后处理、传输、解码、缓冲、渲染等很多环节。每一个细分环节，还有更细...","abstract":"实时音视频的开发学习有很多可以参考的开源项目。一个实时音视频应用共包括几个环节：采集、编码、前后处理、传输、解码、缓冲、渲染等很多环节。每一个细分环节，还有更细...","posterSummary":"实时音视频的开发学习有很多可以参考的开源项目。一个实时音视频应用共包括几个环节：采集、编码、前后处理、传输、解码、缓冲、渲染等很多环节。每一个细分环节，还有更细分的技术模块。比如，前后处理环节有美颜、滤镜、回声消除、噪声抑制等，采集有麦克风阵列等，编解码有VP8、VP9、H.264、H.265等。 ","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"jianshu","originalTime":"2018.02.07 14:26"},"authorId":1037212,"columnId":4874,"writeTime":0,"updateTime":0,"viewCount":3686,"likeCount":4,"commentCount":1,"favorCount":2,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":1037212,"name":"JackJiang","label":"开源IM通信层中台MobileIMSDK的作者、即时通讯网站长，致力于即时通讯技术知识的分享和传播。","avatar":"https://ask.qcloudimg.com/http-save/yehe-1037212/j9twhirvmn.jpeg","company":"","title":"","isProfessionVerified":false},"column":{"id":4874,"name":"即时通讯技术","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/10.png","background":"","status":2,"creatorId":1037212,"memberCount":1,"articleCount":401,"followCount":127,"createdTime":1533983170}},{"id":1588116,"articleId":1588116,"title":"在家办公心不慌，运维请收好这几个远程管理软件","content":"","plain":"","brief":"","summary":"分享@央视新闻制作的新型肺炎疫情防护措施线路图。宅在家里，上班路上，返程路上，这些防护措施请牢记↓↓↓","abstract":"分享@央视新闻制作的新型肺炎疫情防护措施线路图。宅在家里，上班路上，返程路上，这些防护措施请牢记↓↓↓","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2020-02-04","author":"CU技术社区","nickName":"CU技术社区","userName":"gh_8bf9f56e5acf","alias":"ChinaUnix2013","authorName":"戴尔易安信"},"authorId":6543014,"columnId":82391,"writeTime":0,"updateTime":0,"viewCount":303,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"author":{"id":6543014,"name":"用户6543014","label":"","avatar":"https://ask.qcloudimg.com/random-avatar/6543014/0ncw5gwv5a.png","company":"","title":"","isProfessionVerified":false},"column":{"id":82391,"name":"CU技术社区","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/15.png","background":"","status":2,"creatorId":6543014,"memberCount":1,"articleCount":407,"followCount":34,"createdTime":1571903151}}],"anchorToCommentsArea":false,"isFromOriginalSharing":false,"isCampusAmabassdor":false,"relatedInventoryData":{"list":[],"total":0},"myInventoryData":{"fetchStatus":"loaded","pageNumber":2,"pageSize":20,"done":false},"hasColumnArticleRecommendRight":false,"hasColumnArticleDeletedRight":false,"isFollowing":false,"moduleStoredKeyMap":{"mod-article-handpicked-special-topic":"COLUMN_article_handpicked_special_topic","mod-article-handpicked-activity":"COLUMN_article_handpicked_activity"},"moduleDataMap":{"mod-article-handpicked-special-topic":[{"id":"pRQeBt-T8","url":"https://cloud.tencent.com/developer/special/TencentCloudNative","title":"腾讯云原生专题","subTitle":"云原生技术干货，业务实践落地。","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/k8pfdhqi7p.jpg"}],"mod-article-handpicked-activity":[{"id":"_2oAP_Fw6","url":"https://cloud.tencent.com/developer/special/developerclass","title":"视频公开课上线啦","subTitle":"Vite学习指南，基于腾讯云Webify部署项目","btnText":"立即查看","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/l7paq6x0qv.jpg"},{"id":"es8bcjiiD","url":"https://cloud.tencent.com/developer/support-plan","title":"腾讯云自媒体分享计划","subTitle":"入驻云加社区，共享百万资源包。","btnText":"立即入驻","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/8rzvh0nm9n.jpg"}]},"developerSpreadBanner":{"id":175,"imageUrl":"https://ask.qcloudimg.com/raw/yehe-fbd3d4418/tcvok1oxop.png","mImgUrl":"https://ask.qcloudimg.com/raw/yehe-fbd3d4418/stch9wfxrl.png","title":"内容分发网络CDN专场特惠，流量包0.06元/GB起","desc":"","buttonText":"立即抢购","spreadUrl":"https://cloud.tencent.com/act/pro/CDN-?from=11855"},"env":"production","documentBaseTitle":"腾讯云开发者社区-腾讯云","cdnDomain":"cloudcache.tencent-cloud.cn","cssDomain":"cloudcache.tencent-cloud.cn","qcloudDomain":"cloud.tencent.com","consoleDomain":"console.cloud.tencent.com","session":{"isLogined":false,"isQcloudUser":false,"isOwner":false,"nickname":"","accountInfoCompleted":false,"phoneCompleted":false,"profile":{},"contactPhoneCompleted":false,"userInfo":{}},"fromMiniProgram":false,"route":{"url":"/developer/article/1958592","path":"/developer/article/1958592","pathname":"/developer/article/1958592","search":null,"query":{},"segments":["developer","article","1958592"]}});
</script><script>
					if (!Element.prototype.matches)
	Element.prototype.matches = Element.prototype.msMatchesSelector ||
															Element.prototype.webkitMatchesSelector;
	if (!Element.prototype.closest)
		Element.prototype.closest = function(s) {
				var el = this;
				if (!document.documentElement.contains(el)) return null;
				do {
						if (el.matches(s)) return el;
						el = el.parentElement;
				} while (el !== null);
				return null;
		};
					 window.addEventListener('mouseover', function(evt) {
    const target = evt.target;
    if (!target) {
      return;
    }
    const aEle = target.closest('a');
    if (!aEle) {
      return;
    }
    let href = aEle.getAttribute('href');
    if (!href) {
      return;
    }
    href = href.replace(/cloud.tencent.com.cn|cloud.tencent.com|cloud.tencent.cn/g, 'cloud.tencent.com');
    aEle.setAttribute('href', href);
  }, true);
  
					</script><script src="./性能优化：SRS为何能做到同类的三倍 - 腾讯云开发者社区-腾讯云_files/qcloudStatApi.js.下载" defer=""></script><div class="xl-chrome-ext-bar" id="xl_chrome_ext_{4DB361DE-01F7-4376-B494-639E489D19ED}" style="display: none;">
      <div class="xl-chrome-ext-bar__logo"></div>

      <a id="xl_chrome_ext_download" href="javascript:;" class="xl-chrome-ext-bar__option">下载视频</a>
      <a id="xl_chrome_ext_close" href="javascript:;" class="xl-chrome-ext-bar__close"></a>
    </div></body></html>